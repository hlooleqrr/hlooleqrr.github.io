<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: #f4f6f8;
      margin: 0;
      text-align: center;
      font-size: 32px;
    }
    header {
      background: #005c48;
      color: #fff;
      padding: 25px;
      font-size: 34px;
    }
    .container {
      max-width: 650px;
      margin: 25px auto;
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,.1);
    }
    input, select, button {
      width: 92%;
      padding: 20px;
      margin: 18px 0;
      font-size: 32px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    select option { font-size: 30px; }
    button {
      background: #00796b;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:hover { background: #004d40; }
    .small-reset {
      font-size: 28px;
      padding: 12px 20px;
      margin-top: 22px;
      background: #e3f2fd;
      color: #1565c0;
      border: none;
      cursor: pointer;
      border-radius: 15px;
    }
    .small-reset:hover { background: #bbdefb; }
    footer {
      font-size: 26px;
      color: #666;
      margin-top: 40px;
      padding: 15px;
    }
    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInMove .6s forwards;
    }
    @keyframes fadeInMove {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .result p {
      margin: 12px 0;
      font-size: 30px;
      line-height: 1.6;
    }
    .result h2, .result h3 {
      font-size: 34px;
    }
    .highlight {
      font-size: 36px;
      font-weight: bold;
      color: #004d40;
    }
  </style>
</head>
<body>
<header>
  <h1>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h1>
  <p>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©</p>
</header>

<div class="container" id="form-container">
  <div id="question"></div>

  <!-- Ø²Ø± Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø¨Ø© -->
  <button id="mainButton" onclick="handleStartOrReset()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø¨Ø©</button>

  <!-- Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ -->
  <div id="nextContainer" style="display:none">
    <button onclick="nextQuestion()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
  </div>

  <!-- Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø© -->
  <div id="resetButtonContainer" style="display:none">
    <button class="small-reset" onclick="resetCalc()">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø©</button>
  </div>
</div>

<script>
let answers = { commitments: [] }, step = 0, commitmentStep = 0, currentCommitment = {};
let hasStarted = false;
const currentHijriYear = 1446;

const generalQuestions = [
  { id: 'financeType', label: 'Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ØªØ±ÙŠØ¯ Ø­Ø³Ø¨ØªÙ‡:', type: 'select', options: ['ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ Ø£Ùˆ ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ', 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ'] },
  { id: 'clientName', label: 'Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…', type: 'text' },
  { id: 'jobType', label: 'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ©', type: 'select', options: ['Ø¹Ø³ÙƒØ±ÙŠ', 'Ù…Ø¯Ù†ÙŠ (Ù‚Ø·Ø§Ø¹ Ø­ÙƒÙˆÙ…ÙŠ)', 'Ø®Ø§Øµ (Ø´Ø¨Ù‡ Ø­ÙƒÙˆÙ…ÙŠ)', 'Ø®Ø§Øµ (Ø´Ø±ÙƒØ© Ù…Ø¹ØªÙ…Ø¯Ø©)', 'Ø®Ø§Øµ (Ø´Ø±ÙƒØ© ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯Ø©)'] },
  { id: 'birthDay', label: 'Ø§Ø®ØªØ± ÙŠÙˆÙ… Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:', type: 'select', options: Array.from({ length: 30 }, (_, i) => i + 1), default: 1 },
  { id: 'birthMonth', label: 'Ø§Ø®ØªØ± Ø´Ù‡Ø± Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:', type: 'select', options: Array.from({ length: 12 }, (_, i) => i + 1), default: 1 },
  { id: 'birthYear', label: 'Ø§Ø®ØªØ± Ø³Ù†Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:', type: 'select', options: Array.from({ length: 61 }, (_, i) => 1370 + i), default: 1412 },
  { id: 'militaryRank', label: 'Ø§Ø°ÙƒØ± Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©', type: 'select', options: ['Ø¬Ù†Ø¯ÙŠ', 'Ø¹Ø±ÙŠÙ', 'Ø±Ù‚ÙŠØ¨', 'Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡', 'Ù†Ù‚ÙŠØ¨', 'Ø±Ø§Ø¦Ø¯', 'Ù…Ù‚Ø¯Ù…', 'Ø¹Ù‚ÙŠØ¯', 'Ø¹Ù…ÙŠØ¯', 'Ù„ÙˆØ§Ø¡'], show: a => a.jobType === 'Ø¹Ø³ÙƒØ±ÙŠ' },

  // Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ù…ØªØ¯ ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ + Ø§Ù„Ø±ØªØ¨Ø© + Ø¥Ø°Ø§ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø£Ù‚Ù„ Ù…Ù† 25 Ø³Ù†Ø©
  {
    id: 'extendedCalc',
    type: 'select',
    label: 'ØªÙ‚Ø§Ø¹Ø¯Ùƒ Ù‚Ø±ÙŠØ¨ØŒ Ù‡Ù„ ØªØ±ØºØ¨ Ø¨Ø§Ù„Ø­Ø³Ø¨Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ (Ø§Ù„Ù…Ù…ØªØ¯Ø©)ØŸ',
    options: ['Ù†Ø¹Ù…', 'Ù„Ø§'],
    show: a => {
      if (a.jobType !== 'Ø¹Ø³ÙƒØ±ÙŠ' || !a.militaryRank || !a.birthYear) return false;
      const rankAge = getRetirementAge(a.militaryRank);
      const clientAge = currentHijriYear - parseInt(a.birthYear);
      return rankAge - clientAge < 25;
    }
  },

  // Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ù…ØªØ¯ ÙÙ‚Ø· Ø¥Ø°Ø§ Ø£Ø¬Ø§Ø¨ "Ù†Ø¹Ù…"
  { id: 'basicSalary', type: 'number', label: 'Ø§Ø°ÙƒØ± Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ', show: a => a.extendedCalc === 'Ù†Ø¹Ù…' },
  { id: 'hiringDay', label: 'ÙŠÙˆÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ† (Ù‡Ø¬Ø±ÙŠ)', type: 'select', options: Array.from({ length: 30 }, (_, i) => i + 1), default: 1, show: a => a.extendedCalc === 'Ù†Ø¹Ù…' },
  { id: 'hiringMonth', label: 'Ø´Ù‡Ø± Ø§Ù„ØªØ¹ÙŠÙŠÙ† (Ù‡Ø¬Ø±ÙŠ)', type: 'select', options: Array.from({ length: 12 }, (_, i) => i + 1), default: 1, show: a => a.extendedCalc === 'Ù†Ø¹Ù…' },
  { id: 'hiringYear', label: 'Ø³Ù†Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† (Ù‡Ø¬Ø±ÙŠ)', type: 'select', options: Array.from({ length: 36 }, (_, i) => (1447 - i).toString()), default: 1420, show: a => a.extendedCalc === 'Ù†Ø¹Ù…' },
  { id: 'netSalaryBeforeRetire', type: 'number', label: 'Ø§Ø°ÙƒØ± Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ', show: a => a.extendedCalc === 'Ù†Ø¹Ù…' },

  // Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠ ÙÙ‚Ø·
  { id: 'supported', label: 'Ù‡Ù„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…ØŸ', type: 'select', options: ['Ù…Ø¯Ø¹ÙˆÙ…', 'ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…'], show: a => a.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' },
  { id: 'bundle', label: 'Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø³ÙƒÙ†ÙŠØŸ', type: 'select', options: ['Ù†Ø¹Ù…', 'Ù„Ø§'], show: a => a.supported === 'Ù…Ø¯Ø¹ÙˆÙ…' },

  // Ø§Ù„Ø±Ø§ØªØ¨ ÙÙ‚Ø· Ø¥Ø°Ø§ Ù…Ø§ ÙƒØ§Ù† Ù…Ù…ØªØ¯
  { id: 'salary', label: 'ÙƒÙ… Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„ØµØ§ÙÙŠØŸ', type: 'number', show: a => a.extendedCalc !== 'Ù†Ø¹Ù…' },

  { id: 'months', label: 'Ø¹Ù„Ù‰ ÙƒÙ… Ø´Ù‡Ø± ØªØ±ÙŠØ¯ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ØŸ', type: 'select', options: [], dynamic: true },
  { id: 'profitMargin', label: 'Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ (%)ØŸ', type: 'number' },
  { id: 'hasCommitments', label: 'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ', type: 'select', options: ['Ù†Ø¹Ù…', 'Ù„Ø§'] }
];

const commitmentQuestions = [
  { id: 'type', label: 'Ù†ÙˆØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…', type: 'select', options: ['Ù‚Ø±Ø¶ Ø´Ø®ØµÙŠ', 'Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©', 'Ù‚Ø±Ø¶ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ', 'Ù‚Ø±Ø¶ Ø¹Ù‚Ø§Ø±ÙŠ'] },
  { id: 'amount', label: 'ÙƒÙ… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠØŸ', type: 'number' },
  { id: 'months', label: 'ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©ØŸ', type: 'select', options: [], dynamic: true },
  { id: 'balloon', label: 'Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø¯ÙØ¹Ø© Ø£Ø®ÙŠØ±Ø© (Ù„Ø³ÙŠØ§Ø±Ø©)ØŸ', type: 'select', options: ['Ù†Ø¹Ù…', 'Ù„Ø§'], show: c => c.type === 'Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' },
  { id: 'balloonAmount', label: 'ÙƒÙ… Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©ØŸ', type: 'number', show: c => c.balloon === 'Ù†Ø¹Ù…' },
  { id: 'more', label: 'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ø£Ø®Ø±Ù‰ØŸ', type: 'select', options: ['Ù†Ø¹Ù…', 'Ù„Ø§'] }
];

function getRetirementAge(rank){
  return {
    'Ø¬Ù†Ø¯ÙŠ':44,'Ø¹Ø±ÙŠÙ':46,'Ø±Ù‚ÙŠØ¨':48,'Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡':50,'Ù†Ù‚ÙŠØ¨':52,
    'Ø±Ø§Ø¦Ø¯':54,'Ù…Ù‚Ø¯Ù…':55,'Ø¹Ù‚ÙŠØ¯':56,'Ø¹Ù…ÙŠØ¯':57,'Ù„ÙˆØ§Ø¡':58
  }[rank] || 44;
}
</script><script>
// Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„ØªØ±ØªÙŠØ¨
function showQuestion(){
  const cont = document.getElementById('question');
  cont.innerHTML = '';
  document.getElementById('nextContainer').style.display = 'block';

  let q;
  if(step < generalQuestions.length){
    q = generalQuestions[step];
    if(q.show && !q.show(answers)){ step++; showQuestion(); return; }
  }else if(answers.hasCommitments === 'Ù†Ø¹Ù…'){
    q = commitmentQuestions[commitmentStep];
    if(q.show && !q.show(currentCommitment)){ commitmentStep++; showQuestion(); return; }
  }else{
    document.getElementById('nextContainer').style.display = 'none';
    calculate(); return;
  }

  const div = document.createElement('div'); div.classList.add('fade-in');
  div.innerHTML = `<label>${q.label}</label><br>`;

  if(q.type==='select'){
    const sel = document.createElement('select'); sel.id = q.id;
    sel.innerHTML = '<option value="">Ø§Ø®ØªØ±...</option>';
    if(q.dynamic && q.id==='months'){
      const max = getMaxAllowedMonths();
      for(let i=1;i<=max;i++) sel.innerHTML += `<option value="${i}">${i} Ø´Ù‡Ø±</option>`;
    }else{
      q.options.forEach(opt=>{ sel.innerHTML += `<option value="${opt}">${opt}</option>`; });
    }
    div.appendChild(sel);
  }else{
    div.innerHTML += `<input type="${q.type}" id="${q.id}" ${q.default ? `value="${q.default}"` : ''}>`;
  }
  cont.appendChild(div);
}

// Ø§Ù„ØªØ§Ù„ÙŠ
function nextQuestion(){
  const q = step < generalQuestions.length ? generalQuestions[step] : commitmentQuestions[commitmentStep];
  const el = document.getElementById(q.id);
  const val = el?.value;
  if(!val){ alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©'); return; }

  if(step < generalQuestions.length){
    answers[q.id] = val;
    step++;
  }else{
    if(q.id==='months') currentCommitment[q.id] = parseInt(val);
    else if(q.id==='amount' || q.id==='balloonAmount') currentCommitment[q.id] = parseFloat(val);
    else currentCommitment[q.id] = val;

    if(q.id==='more'){
      answers.commitments.push(currentCommitment);
      currentCommitment = {};
      if(val==='Ù†Ø¹Ù…'){ commitmentStep = 0; showQuestion(); return; }
      else{ document.getElementById('nextContainer').style.display='none'; calculate(); return; }
    }
    commitmentStep++;
  }
  showQuestion();
}

// Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù…Ù† Ø§Ù„Ø£Ø´Ù‡Ø± Ø­Ø³Ø¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯
function getMaxAllowedMonths(){
  const birthYear = parseInt(answers.birthYear);
  const birthMonth = parseInt(answers.birthMonth);
  const birthDay = parseInt(answers.birthDay);
  const ageHijri = currentHijriYear - birthYear;

  if(answers.jobType === 'Ø¹Ø³ÙƒØ±ÙŠ'){
    const rank = answers.militaryRank;
    const retireAge = getRetirementAge(rank);
    const monthsLeft = (retireAge - ageHijri) * 12;
    return Math.min(monthsLeft, answers.financeType.includes('Ø´Ø®ØµÙŠ') ? 60 : 360);
  }else{
    const monthsLeft = (60 - ageHijri) * 12;
    return Math.min(monthsLeft, answers.financeType.includes('Ø´Ø®ØµÙŠ') ? 60 : 360);
  }
}

// Ø§Ø¨Ø¯Ø£ Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø©
function handleStartOrReset(){
  if(!hasStarted){
    hasStarted = true;
    document.getElementById('mainButton').style.display = 'none';
    document.getElementById('resetButtonContainer').style.display = 'block';
    showQuestion();
  }else{ resetCalc(); }
}

function resetCalc(){
  answers = { commitments: [] };
  step = 0;
  commitmentStep = 0;
  currentCommitment = {};
  hasStarted = false;
  document.getElementById('mainButton').style.display = 'block';
  document.getElementById('resetButtonContainer').style.display = 'none';
  document.getElementById('question').innerHTML = '';
}

// Ø­Ø³Ø¨Ø© ÙˆÙ‡Ù…ÙŠØ© Ù…Ø¤Ù‚ØªØ© ÙÙ‚Ø· Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
function calculate(){
  const name = answers.clientName || 'Ø§Ù„Ø¹Ù…ÙŠÙ„';
  const months = parseInt(answers.months) || 0;
  const durationText = months + ' Ø´Ù‡Ø±';

  let html = `<div class="result"><h2>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø¨Ø© (Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©):</h2>`;
  html += `<p style="color:#1565c0; font-size:36px;"><strong>Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙˆÙ…Ø³Ù‡Ù„Ø§ ÙŠØ§ ${name}</strong></p>`;
  html += `<p style="font-size:32px;">Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„: <strong>${durationText}</strong></p>`;
  html += `<p style="color: green; font-size: 44px; font-weight: bold;"> Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: 450,000 Ø±ÙŠØ§Ù„</p>`;
  html += `<p style="color: red; font-size: 42px;"><strong>Ø§Ù„Ø±Ø¨Ø­ Ù…Ø¹ Ø§Ù„Ø±Ø³ÙˆÙ…:</strong> 89,000 Ø±ÙŠØ§Ù„</p>`;
  html += `<p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</strong> 539,000 Ø±ÙŠØ§Ù„</p>`;
  html += `<h3 style="margin-top:30px;"> Ø®Ø° Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø© ÙˆØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§: ğŸ“0506214458  Ø²ÙˆØ±Ùˆ Ù…ÙˆÙ‚Ø¹Ù†Ø§: hlooleqrr.com</h3></div>`;
  document.getElementById('question').innerHTML = html;
}
</script>

<footer>
  <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ© - <span id="datetime"></span></p>
</footer>
<script>
function updateDateTime(){
  const n = new Date();
  document.getElementById('datetime').innerText =
    `${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,'0')}-${String(n.getDate()).padStart(2,'0')} `+
    `${String(n.getHours()).padStart(2,'0')}:${String(n.getMinutes()).padStart(2,'0')}:${String(n.getSeconds()).padStart(2,'0')}`;
}
setInterval(updateDateTime, 1000); updateDateTime();
</script>
</body>
</html>