<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>سرعة تملك العقار – حاسبة التمويل</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Tajawal',sans-serif;background:#f4f6f8;margin:0;text-align:center}
    header{background:#005c48;color:#fff;padding:20px}
    .container{max-width:650px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 15px rgba(0,0,0,.1)}
    input,select,button{width:90%;padding:10px;margin:10px 0;font-size:16px;border-radius:5px;border:1px solid #ccc}
    button{background:#00796b;color:#fff;border:0;cursor:pointer}button:hover{background:#004d40}
    footer{font-size:12px;color:#666;margin-top:40px;padding:10px}
    .fade-in{opacity:0;transform:translateY(20px);animation:fade .6s forwards}@keyframes fade{to{opacity:1;transform:none}}
  </style>
</head>
<body>

<header>
  <h1>سرعة تملك العقار والحلول التمويلية – الحاسبة التقريبية</h1>
  <p>نقدّم أفضل الحلول التمويلية المتكاملة</p>
</header>

<div class="container" id="form-container">
  <div id="question"></div>
  <button onclick="nextQuestion()">ابدأ الحسبة</button>
</div>

<script>
/* ---------- أسئلة الحاسبة ---------- */
const questions=[
  {label:'نوع التمويل؟',id:'financeType',type:'select',options:['تمويل عقاري','تمويل شخصي']},
  {label:'هل التمويل مدعوم؟',id:'supported',type:'select',options:['مدعوم','غير مدعوم'],showIf:a=>a.financeType==='تمويل عقاري'},
  {label:'هل ترغب في الحصول على الباقة المقدّمة (دفعة أولى)؟',id:'bundle',type:'select',options:['نعم','لا'],showIf:a=>a.supported==='مدعوم'},
  {label:'الراتب الشهري (ريال):',id:'salary',type:'number'},
  {label:'حدد المدة:',id:'tenure',type:'range',min:1,max:30,value:20}, /* يتغيّر ديناميكياً */
  {label:'هامش الربح السنوي (%) :',id:'profitMargin',type:'number'},
  {label:'هل لديك التزامات؟',id:'hasCommitments',type:'select',options:['نعم','لا']},
  {label:'نوع الالتزام:',id:'commitmentType',type:'select',options:['قرض شخصي','قرض سيارة','قرض استهلاكي'],showIf:a=>a.hasCommitments==='نعم'},
  {label:'قسط الالتزام الشهري (ريال):',id:'commitmentPayment',type:'number',showIf:a=>a.hasCommitments==='نعم'},
  {label:'الأشهر المتبقية للالتزام:',id:'commitmentMonths',type:'number',showIf:a=>a.hasCommitments==='نعم'},
  {label:'(للقرض السيارة) الدفعة الأخيرة (ريال):',id:'lastPayment',type:'number',showIf:a=>a.hasCommitments==='نعم'&&a.commitmentType==='قرض سيارة'}
];

let answers={},current=0;

/* ---------- عرض سؤال ---------- */
function showQuestion(i){
  const box=document.getElementById('question');box.innerHTML='';
  if(i>=questions.length){calculateResult();document.querySelector('button').style.display='none';return;}
  const q=questions[i];if(q.showIf&&!q.showIf(answers)){current++;showQuestion(current);return;}

  const div=document.createElement('div');div.className='fade-in';
  const lab=document.createElement('label');lab.textContent=q.label;div.appendChild(lab);div.appendChild(document.createElement('br'));

  if(q.type==='select'){
    const sel=document.createElement('select');sel.id=q.id;
    sel.onchange=()=>{if(q.id==='financeType')updateTenureSlider();};
    q.options.forEach(o=>{const op=document.createElement('option');op.value=o;op.textContent=o;sel.appendChild(op);});
    div.appendChild(sel);

  }else if(q.type==='range'){
    const inpt=document.createElement('input');inpt.type='range';inpt.id=q.id;updateTenureProps(inpt);
    inpt.oninput=()=>document.getElementById(q.id+'Val').textContent=inpt.value;
    div.appendChild(inpt);div.appendChild(document.createElement('br'));
    const span=document.createElement('span');span.id=q.id+'Val';span.textContent=inpt.value;div.appendChild(span);
    div.appendChild(document.createTextNode(' '));const unit=document.createElement('span');unit.id=q.id+'Unit';unit.textContent='سنة';div.appendChild(unit);

  }else{
    const inpt=document.createElement('input');inpt.type=q.type;inpt.id=q.id;div.appendChild(inpt);
  }
  box.appendChild(div);
}

/* ---------- خصائص شريط المدة ---------- */
function updateTenureProps(slider){
  const personal=answers.financeType==='تمويل شخصي';slider.min=1;slider.max=personal?60:30;slider.value=personal?12:20;
}
function updateTenureSlider(){
  const s=document.getElementById('tenure'),u=document.getElementById('tenureUnit');
  if(s){updateTenureProps(s);document.getElementById('tenureVal').textContent=s.value;}
  if(u)u.textContent=answers.financeType==='تمويل شخصي'?'شهر':'سنة';
}

/* ---------- التالي ---------- */
function nextQuestion(){
  if(current>0){const prev=questions[current-1],inp=document.getElementById(prev.id);if(inp)answers[prev.id]=inp.value;}
  showQuestion(current);current++;
}

/* ---------- الحسبة ---------- */
function calculateResult(){
  const type=answers.financeType,tenure=parseFloat(answers.tenure)||0,
        salary=parseFloat(answers.salary)||0,profit=parseFloat(answers.profitMargin)||0;

  /* الدعم ونسبة الاستقطاع */
  let deductionRate=0,extraSupport=0,addCommodityFee=false;
  if(type==='تمويل شخصي'){deductionRate=33.33;addCommodityFee=true;}
  else{
    const sal=salary;
    if(answers.supported==='مدعوم'){
      if(answers.bundle==='نعم'){
        extraSupport=sal<10000?150000:100000;
        deductionRate=sal<15000?55:65;
      }else deductionRate=sal<15000?55:65;
    }else deductionRate=sal<15000?55:65;
  }

  /* الالتزامات */
  const hasCom=answers.hasCommitments==='نعم',
        comPay=parseFloat(answers.commitmentPayment)||0,
        comMonths=parseFloat(answers.commitmentMonths)||0,
        lastPay=parseFloat(answers.lastPayment)||0,
        comType=answers.commitmentType;

  /* المدة بالأشهر والسنوات */
  const months=type==='تمويل شخصي'?tenure:tenure*12,
        years=months/12;

  /* القسط المتاح */
  const allowed=salary*deductionRate/100;
  let avail=allowed;if(hasCom)avail-=comPay;
  if(avail<=0){document.getElementById('question').innerHTML='<h2>عذرًا</h2><p>لا يمكنك الحصول على تمويل حاليًا بسبب الالتزامات.</p>';return;}

  /* الأقساط */
  let extraMonthly=0,balloonMonths=0,totalInstallments;
  if(hasCom){
    const withCom=avail*comMonths;
    if(comType==='قرض سيارة'&&lastPay>0){balloonMonths=24;extraMonthly=lastPay/24;}
    const withBalloon=(allowed-extraMonthly)*balloonMonths;
    const afterCom=allowed*(months-comMonths-balloonMonths);
    totalInstallments=withCom+withBalloon+afterCom;
  }else totalInstallments=allowed*months;

  /* الأرباح والرسوم */
  const profitFactor=years*profit/100+1,
        netFinance=totalInstallments/profitFactor;

  /* سقف الرسوم 5000 + 750 ضريبة */
  let adminFee=netFinance*0.01,vat=adminFee*0.15;
  if(adminFee>5000){adminFee=5000;vat=750;}
  const commodityFee=addCommodityFee?netFinance*0.01:0,
        finalNet=netFinance-adminFee-vat-commodityFee,
        totalProfit=totalInstallments-netFinance;

  /* النتيجة */
  const box=document.getElementById('question');
  box.innerHTML=`
    <h2>نتيجة الحاسبة</h2>
    <p><strong>قسطك خلال أول ${comMonths} شهر (مع الالتزام):</strong> ${avail.toFixed(0)} </p>
    ${balloonMonths?`<p><strong>قسطك خلال ${balloonMonths} شهر بعد توزيع دفعة السيارة:</strong> ${(allowed-extraMonthly).toFixed(0)} </p>`:''}
    <p><strong>قسطك بعد انتهاء الالتزامات:</strong> ${allowed.toFixed(0)} </p>
    <hr>
    <p><strong>التمويل الصافي قبل خصم الرسوم:</strong> ${netFinance.toFixed(0)} </p>
    <p><strong>التمويل الصافي النهائي بعد خصم الرسوم:</strong> ${finalNet.toFixed(0)} </p>
    ${extraSupport?`<p><strong>دعم حكومي مضاف:</strong> ${extraSupport.toLocaleString()} </p>`:''}
    <hr>
    <p><strong>الأرباح الإجمالية:</strong> ${totalProfit.toFixed(0)} </p>
    <p>معامل الربح: ${profitFactor.toFixed(3)}</p>
    <p>الرسوم الإدارية: ${adminFee.toFixed(0)} .</p>
    <p>ضريبة الرسوم: ${vat.toFixed(0)} .</p>
    ${addCommodityFee?`<p>رسوم السلع: ${commodityFee.toFixed(0)} </p>`:''}
    <p><strong>إجمالي الأقساط مع الأرباح:</strong> ${totalInstallments.toFixed(0)} </p>
    <hr>
    خذ لقطة لشاشة 
    <p>للتواصل مع سرعة تملك العقار والحلول التمويلية اتصل: 0506214458 | او زورونا hlooleqrr.com</p>
  `;box.classList.add('fade-in');
}

/* ---------- ساعة أسفل الصفحة ---------- */
function updateTime(){document.getElementById('datetime').textContent=new Date().toLocaleString('ar-EG');}
setInterval(updateTime,1000);updateTime();

/* ---------- إطلاق أول سؤال ---------- */
showQuestion(0);
</script>

<footer>
  <p>© سرعة تملك العقار والحلول التمويلية  – <span id="datetime"></span></p>
</footer>
</body>
</html>