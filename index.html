<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>سرعة تملك العقار والحلول التمويلية</title>
  <style>
    body { font-family: 'Tajawal', sans-serif; background: #f4f6f8; margin:0; text-align:center; font-size:32px; }
    header { background:#005c48; color:#fff; padding:25px; font-size:40px; }
    h2 { font-size:32px; margin:10px 0 20px; }
    .container { max-width:650px; margin:0 auto 25px; background:#fff; padding:25px; border-radius:10px; box-shadow:0 0 15px rgba(0,0,0,.1); }
    input, select, button { width:92%; padding:20px; margin:18px 0; font-size:32px; border-radius:5px; border:1px solid #ccc; box-sizing:border-box; }
    .result p { margin:12px 0; text-align:right; }
    .highlight { color:#2e7d32; font-size:36px; }

    /* زر إعادة الحسبة بخلفية أزرق باهت وحجم صغير */
    #resetButtonContainer {
      position:fixed; bottom:15px; left:50%; transform:translateX(-50%); z-index:1000;
      display:none; background:#e3f2fd; padding:4px 8px; border-radius:5px;
    }
    #resetButtonContainer button {
      background:transparent; border:none; color:#005c48; font-size:16px; cursor:pointer;
    }

    footer { margin-top:40px; font-size:24px; color:#555; }
  </style>
</head>
<body>
  <header>سرعة تملك العقار والحلول التمويلية</header>
  <h2>حاسبة التمويل التقريبية</h2>
  <div class="container">
    <div id="question"></div>
    <button id="mainButton" onclick="handleStart()">ابدأ الحسبة</button>
    <div id="nextContainer" style="display:none;">
      <button onclick="nextQuestion()">التالي</button>
    </div>
  </div>
  <div id="resetButtonContainer">
    <button onclick="handleReset()">إعادة الحسبة 🔁</button>
  </div>

  <footer>
    <p id="datetimeFooter">جميع الحقوق محفوظة - سرعة تملك العقار والحلول التمويلية</p>
  </footer>

  <script>
    // تحديث التاريخ والوقت كل ثانية
    function updateDateTime() {
      document.getElementById('datetimeFooter').innerText =
        `جميع الحقوق محفوظة - سرعة تملك العقار - التاريخ الهجري: 1446/12/21 - الميلادي: 2025/06/27 - الوقت: 12:44`;
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // الأسئلة والمنطق
    let hasStarted = false, step = 0, commitmentStep = 0;
    let answers = { commitments: [] }, currentCommitment = {};

    const generalQuestions = [
      { id:'financeType',   label:'اختر نوع التمويل تريد حسبته:',       type:'select', options:['تمويل عقاري','تمويل شخصي أو استهلاكي'] },
      { id:'clientName',    label:'الاسم الكريم:',                       type:'text' },
      { id:'birthHijri',    label:'تاريخ الميلاد (هجري):',              type:'dateHijri' },
      { id:'jobType',       label:'نوع الوظيفة:',                       type:'select', options:['عسكري','مدني','خاص شبه حكومي','خاص معتمد','خاص غير معتمد'] },
      { show:a=>a.jobType==='عسكري',
        id:'rank',         label:'حدد رتبتك العسكرية:',                 type:'select',
        options:['جندي','جندي أول','عريف','وكيل رقيب','رقيب','رقيب أول','رئيس رقباء','ملازم','ملازم أول','نقيب','رائد','مقدم','عقيد','عميد','لواء']
      },
      { show:()=>answers.jobType==='عسكري' && getRetirementMonths()<25*12,
        id:'extended',     label:'هل تريد الحسبة ممتدة بعد التقاعد؟',  type:'select', options:['نعم','لا'] },
      { show:a=>a.extended==='نعم',
        id:'basicSalary',  label:'الراتب الأساسي (بدون بدلات، ريال):',  type:'number' },
      { show:a=>a.extended==='نعم',
        id:'appointHijri', label:'تاريخ التعيين (هجري):',               type:'dateHijri' },
      { id:'salary',       label:'الراتب الشهري الحالي (ريال):',         type:'number' },
      { id:'profitMargin', label:'هامش الربح (%):',                     type:'number', default:'4.5' },
      { id:'months',       label:'عدد أشهر التمويل:',                    type:'select', dynamic:true },
      { id:'hasCommitments', label:'هل لديك التزامات مالية؟',           type:'select', options:['نعم','لا'] }
    ];

    const commitmentQuestions = [
      { id:'type',    label:'نوع الالتزام:',           type:'select', options:['قرض سيارة','قرض شخصي','قرض استهلاكي'] },
      { id:'amount',  label:'القسط الشهري (ريال):',     type:'number' },
      { id:'months',  label:'أشهر الالتزام المتبقية:',  type:'select', dynamic:true },
      { id:'balloon', label:'هل لديك دفعة أخيرة؟',      type:'select', options:['نعم','لا'] },
      { show:c=>c.balloon==='نعم', id:'balloonAmount', label:'مبلغ الدفعة الأخيرة (ريال):', type:'number' },
      { id:'more',    label:'هل لديك التزام آخر؟',      type:'select', options:['نعم','لا'] }
    ];

    function getRetirementMonths(){
      const cur=1446, birth=parseInt(answers.birthHijriYear)||cur, age=cur-birth;
      const ranks={جندي:44,'جندي أول':44,عريف:46,'وكيل رقيب':46,رقيب:48,'رقيب أول':50,'رئيس رقباء':52,
                   ملازم:48,'ملازم أول':50,نقيب:52,رائد:54,مقدم:56,عقيد:58,عميد:60,لواء:60};
      const retireAge = answers.jobType==='عسكري' ? (ranks[answers.rank]||60) : 60;
      return Math.max(0, (retireAge - age) * 12);
    }

    function getMaxAllowedMonths(){
      const cur=1446, birth=parseInt(answers.birthHijriYear)||cur, age=cur-birth;
      const until60 = (60 - age) * 12;
      const baseLimit = (answers.financeType||'').includes('شخصي')|| (answers.financeType||'').includes('استهلاكي') ? 60 : 360;
      if(answers.extended==='نعم') return Math.min(until60, baseLimit);
      return Math.min(getRetirementMonths(), baseLimit);
    }

    function describeMonths(m){
      const y = Math.floor(m/12), mm = m % 12;
      let t = `${m} شهر`;
      if (y || mm) {
        t += ' (';
        if (y) {
          if      (y === 2) t += 'سنتان';
          else if (y === 3) t += 'ثلاث سنوات';
          else if (y === 4) t += 'أربع سنوات';
          else if (y === 5) t += 'خمس سنوات';
          else              t += `${y} سنوات`;
        }
        if (y && mm) t += ' و';
        if (mm) {
          if (mm === 1)      t += 'شهر';
          else if (mm === 2) t += 'شهران';
          else                t += `${mm} أشهر`;
        }
        t += ')';
      }
      return t;
    }

    function handleStart(){
      hasStarted = true;
      document.getElementById('mainButton').style.display = 'none';
      document.getElementById('resetButtonContainer').style.display = 'block';
      showQuestion();
    }

    function handleReset(){
      answers = { commitments: [] };
      step = commitmentStep = 0;
      currentCommitment = {};
      hasStarted = true;
      document.getElementById('mainButton').style.display = 'none';
      document.getElementById('nextContainer').style.display = 'block';
      showQuestion();
    }

    function showQuestion(){
      const cont=document.getElementById('question');
      cont.innerHTML='';
      document.getElementById('nextContainer').style.display='block';
      let q;
      if(step<generalQuestions.length){
        q=generalQuestions[step];
        if(q.show && !q.show(answers)){ step++; return showQuestion(); }
      } else if(answers.hasCommitments==='نعم'){
        q=commitmentQuestions[commitmentStep];
        if(q.show && !q.show(currentCommitment)){ commitmentStep++; return showQuestion(); }
      } else {
        document.getElementById('nextContainer').style.display='none';
        return calculate();
      }

      if(q.type==='dateHijri'){
        const div=document.createElement('div'); div.classList.add('fade-in');
        div.innerHTML=`
          <label>${q.label}</label><br>
          <select id="${q.id}Day"><option value="">اليوم</option>${
            Array.from({length:30},(_,i)=>`<option value="${i+1}">${i+1}</option>`).join('')
          }</select>
          <select id="${q.id}Month"><option value="">الشهر</option>${
            Array.from({length:12},(_,i)=>`<option value="${i+1}">${i+1}</option>`).join('')
          }</select>
          <select id="${q.id}Year"><option value="">السنة</option>${
            Array.from({length:(1447-1370+1)},(_,i)=>`<option value="${1370+i}">${1370+i}</option>`).join('')
          }</select>`;
        cont.appendChild(div);
        return;
      }

      const div=document.createElement('div'); div.classList.add('fade-in');
      div.innerHTML=`<label>${q.label}</label><br>`;
      if(q.type==='select'){
        const sel=document.createElement('select'); sel.id=q.id;
        sel.innerHTML='<option value="">اختر...</option>';
        if(q.dynamic){
          for(let i=1;i<=getMaxAllowedMonths();i++){
            sel.innerHTML+=`<option value="${i}">${describeMonths(i)}</option>`;
          }
        } else {
          q.options.forEach(o=> sel.innerHTML+=`<option value="${o}">${o}</option>`);
        }
        div.appendChild(sel);
      } else {
        div.innerHTML+=`<input type="${q.type}" id="${q.id}" ${q.default?`value="${q.default}"`:''}>`;
      }
      cont.appendChild(div);
    }

    function nextQuestion(){
      let q = step<generalQuestions.length ? generalQuestions[step] : commitmentQuestions[commitmentStep];

      if(q.id==='hasCommitments'){
        const val=document.getElementById(q.id).value;
        answers[q.id]=val;
        if(val==='لا') return calculate();
        step++; return showQuestion();
      }

      if(q.type==='dateHijri'){
        const d=document.getElementById(q.id+'Day').value,
              m=document.getElementById(q.id+'Month').value,
              y=document.getElementById(q.id+'Year').value;
        if(!d||!m||!y){ alert('يرجى تعبئة التاريخ كاملاً'); return; }
        answers[q.id+'Day']=d;
        answers[q.id+'Month']=m;
        answers[q.id+'Year']=y;
        step++; return showQuestion();
      }

      const el=document.getElementById(q.id), val=el.value;
      if(!val){ alert('يرجى تعبئة الحقل قبل المتابعة'); return; }

      if(step<generalQuestions.length){
        answers[q.id]=val;
        step++;
      } else {
        if(q.id==='months') currentCommitment.months=parseInt(val);
        else if(['amount','balloonAmount'].includes(q.id)) currentCommitment[q.id]=parseFloat(val);
        else currentCommitment[q.id]=val;

        if(q.id==='more'){
          if(val==='لا'){
            answers.commitments.push(currentCommitment);
            return calculate();
          }
          answers.commitments.push(currentCommitment);
          currentCommitment={};
          commitmentStep=0;
          return showQuestion();
        }
        commitmentStep++;
      }
      showQuestion();
    }

    // <!-- هنا ألصق دالة calculate() الأصلية الخاصة بك حرفياً -->
    function calculate(){
      // … أدرج كود الحسابات النهائي كما في نسختك الأصلية دون أي تغيير …
    }
  </script>
</body>
</html>