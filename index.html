<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ÙŠ Ù„Ù„Ø¹Ø³ÙƒØ±ÙŠÙŠÙ†</title>
<style>
  body {
    font-family: 'Tajawal', sans-serif;
    background: #e8f5f2;
    margin: 0; padding: 20px;
    color: #012a26;
  }
  #app {
    max-width: 720px;
    margin: auto;
    background: white;
    padding: 30px 40px;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
  }
  h2 {
    text-align: center;
    color: #004d40;
    margin-bottom: 30px;
  }
  label {
    display: block;
    margin: 20px 0 8px;
    font-weight: 700;
    font-size: 18px;
  }
  select, button {
    width: 100%;
    padding: 12px;
    font-size: 18px;
    border-radius: 7px;
    border: 1.5px solid #004d40;
    background: #f0f9f8;
    cursor: pointer;
  }
  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  #result {
    margin-top: 40px;
    font-size: 22px;
    line-height: 1.6;
    color: #00695c;
  }
  footer {
    margin-top: 50px;
    text-align: center;
    color: gray;
    font-size: 16px;
  }
</style>
</head>
<body>

<div id="app">

  <h2>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ÙŠ Ù„Ù„Ø¹Ø³ÙƒØ±ÙŠÙŠÙ†</h2>

  <label for="rank">ğŸ–ï¸ Ø§Ø®ØªØ± Ø±ØªØ¨ØªÙƒ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©:</label>
  <select id="rank" required>
    <option value="">-- Ø§Ø®ØªØ± Ø±ØªØ¨Ø© --</option>
    <option value="Ø¬Ù†Ø¯ÙŠ">Ø¬Ù†Ø¯ÙŠ</option>
    <option value="Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„">Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„</option>
    <option value="Ø¹Ø±ÙŠÙ">Ø¹Ø±ÙŠÙ</option>
    <option value="ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨">ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨</option>
    <option value="Ø±Ù‚ÙŠØ¨">Ø±Ù‚ÙŠØ¨</option>
    <option value="Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„">Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„</option>
    <option value="Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡">Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡</option>
    <option value="Ù…Ù„Ø§Ø²Ù…">Ù…Ù„Ø§Ø²Ù…</option>
    <option value="Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„">Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„</option>
    <option value="Ù†Ù‚ÙŠØ¨">Ù†Ù‚ÙŠØ¨</option>
    <option value="Ø±Ø§Ø¦Ø¯">Ø±Ø§Ø¦Ø¯</option>
    <option value="Ù…Ù‚Ø¯Ù…">Ù…Ù‚Ø¯Ù…</option>
    <option value="Ø¹Ù‚ÙŠØ¯">Ø¹Ù‚ÙŠØ¯</option>
    <option value="Ø¹Ù…ÙŠØ¯">Ø¹Ù…ÙŠØ¯</option>
    <option value="Ù„ÙˆØ§Ø¡">Ù„ÙˆØ§Ø¡</option>
  </select>

  <label>ğŸ“… Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯Ùƒ (Ù‡Ø¬Ø±ÙŠ):</label>
  <select id="birthDay"></select>
  <select id="birthMonth"></select>
  <select id="birthYear"></select>

  <label>ğŸ“… Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® ØªØ¹ÙŠÙŠÙ†Ùƒ (Ù‡Ø¬Ø±ÙŠ):</label>
  <select id="hireDay"></select>
  <select id="hireMonth"></select>
  <select id="hireYear"></select>

  <button id="calculateBtn" style="margin-top:30px;">Ø§Ø­Ø³Ø¨</button>

  <div id="result"></div>

</div>

<footer id="footer"></footer>

<script>
  // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø£ÙŠØ§Ù… ÙˆØ§Ù„Ø´Ù‡ÙˆØ± ÙˆØ§Ù„Ø³Ù†ÙˆØ§Øª
  function fillDateSelects(dayId, monthId, yearId, startYear, endYear) {
    const daySelect = document.getElementById(dayId);
    const monthSelect = document.getElementById(monthId);
    const yearSelect = document.getElementById(yearId);

    for(let d=1; d<=30; d++) daySelect.appendChild(new Option(d,d));
    for(let m=1; m<=12; m++) monthSelect.appendChild(new Option(m,m));
    for(let y=startYear; y<=endYear; y++) yearSelect.appendChild(new Option(y,y));

    daySelect.value = 1;
    monthSelect.value = 1;
    yearSelect.value = Math.floor((startYear + endYear) / 2);
  }

  fillDateSelects('birthDay','birthMonth','birthYear',1370,1430);
  fillDateSelects('hireDay','hireMonth','hireYear',1410,1460);

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±ØªØ¨
  const ranksData = {
    "Ø¬Ù†Ø¯ÙŠ":        { base: 3220,  allowance: 125,  maxYears: 15, retireAge: 44 },
    "Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„":    { base: 3395,  allowance: 135,  maxYears: 15, retireAge: 44 },
    "Ø¹Ø±ÙŠÙ":        { base: 3765,  allowance: 150,  maxYears: 15, retireAge: 46 },
    "ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨":   { base: 4455,  allowance: 180,  maxYears: 15, retireAge: 46 },
    "Ø±Ù‚ÙŠØ¨":        { base: 5260,  allowance: 215,  maxYears: 15, retireAge: 48 },
    "Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„":    { base: 6180,  allowance: 260,  maxYears: 15, retireAge: 50 },
    "Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡":  { base: 7215,  allowance: 310,  maxYears: 15, retireAge: 52 },
    "Ù…Ù„Ø§Ø²Ù…":       { base: 7590,  allowance: 380,  maxYears: 15, retireAge: 48 },
    "Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„":   { base: 8365,  allowance: 395,  maxYears: 15, retireAge: 50 },
    "Ù†Ù‚ÙŠØ¨":        { base: 9215,  allowance: 230,  maxYears: 15, retireAge: 52 },
    "Ø±Ø§Ø¦Ø¯":        { base: 11705, allowance: 230,  maxYears: 15, retireAge: 54 },
    "Ù…Ù‚Ø¯Ù…":        { base: 12735, allowance: 230,  maxYears: 15, retireAge: 55 },
    "Ø¹Ù‚ÙŠØ¯":        { base: 14365, allowance: 230,  maxYears: 15, retireAge: 56 },
    "Ø¹Ù…ÙŠØ¯":        { base: 16350, allowance: 210,  maxYears: 15, retireAge: 57 },
    "Ù„ÙˆØ§Ø¡":        { base: 18600, allowance: 200,  maxYears: 15, retireAge: 58 }
  };

  // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ø¥Ù„Ù‰ Ø£ÙŠØ§Ù… ØªÙ‚Ø±ÙŠØ¨ÙŠØ©
  function hijriToDays(y,m,d) {
    return y * 354 + (m - 1) * 29.5 + d;
  }

  // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† ØªØ§Ø±ÙŠØ®ÙŠÙ† Ù‡Ø¬Ø±ÙŠÙŠÙ†
  function diffHijriDates(y1,m1,d1, y2,m2,d2) {
    let diff = Math.floor(hijriToDays(y2,m2,d2) - hijriToDays(y1,m1,d1));
    if(diff < 0) diff = 0;
    const years = Math.floor(diff / 354);
    diff -= years * 354;
    const months = Math.floor(diff / 29.5);
    diff -= months * 29.5;
    const days = Math.floor(diff);
    return { years, months, days };
  }

  // Ø­Ø³Ø§Ø¨ Ø¹Ù…Ø± Ø¹Ù†Ø¯ ØªØ§Ø±ÙŠØ® Ù…Ø¹ÙŠÙ† Ù‡Ø¬Ø±ÙŠØ§Ù‹
  function calculateAgeAtDate(birth, atDate) {
    let y = atDate.y - birth.y;
    let m = atDate.m - birth.m;
    let d = atDate.d - birth.d;
    if(d < 0) {
      d += 30;
      m--;
    }
    if(m < 0) {
      m += 12;
      y--;
    }
    return { years: y, months: m, days: d };
  }

  // Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ ÙƒØ¨Ø¯Ø§ÙŠØ© Ø£ÙˆÙ„ Ø´Ù‡Ø± Ø¨Ø¹Ø¯ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¹Ù…Ø±
  function addMonthsHijriStartNextMonth(date, months) {
    let y = date.y;
    let m = date.m + months + 1;
    let d = 1;
    while(m > 12) {
      m -= 12;
      y++;
    }
    return { y, m, d };
  }

  // ØªØ­ÙˆÙŠÙ„ Ø±Ù‚Ù… Ù„ÙØ§ØµÙ„ Ø¹Ø±Ø¨ÙŠ
  function numberToArabicText(num) {
    return num.toLocaleString('ar-EG');
  }

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙˆØªØ± Ù…Ø¹ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
  function updateFooter() {
    const now = new Date();
    const miladi = now.toLocaleDateString('ar-SA', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    const time = now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
    const hijri = new Intl.DateTimeFormat('ar-SA-u-ca-islamic', { day: 'numeric', month: 'long', year: 'numeric' }).format(now);
    document.getElementById('footer').innerHTML = `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ: ${miladi} <br> ğŸ“† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: ${hijri} <br> ğŸ•’ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¢Ù†: ${time}`;
  }
  updateFooter();

  // Ø§Ù„Ø­Ø¯Ø« Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø­Ø³Ø§Ø¨
  document.getElementById('calculateBtn').onclick = function() {
    const rank = document.getElementById('rank').value;
    const birth = {
      y: parseInt(document.getElementById('birthYear').value),
      m: parseInt(document.getElementById('birthMonth').value),
      d: parseInt(document.getElementById('birthDay').value)
    };
    const hire = {
      y: parseInt(document.getElementById('hireYear').value),
      m: parseInt(document.getElementById('hireMonth').value),
      d: parseInt(document.getElementById('hireDay').value)
    };

    if(!rank) return alert("Ø§Ø®ØªØ± Ø±ØªØ¨Ø© ØµØ­ÙŠØ­Ø©");
    if(hire.y < birth.y || (hire.y === birth.y && hire.m < birth.m) || (hire.y === birth.y && hire.m === birth.m && hire.d < birth.d)) {
      return alert("ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚Ø¨Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯");
    }

    const serviceDuration = diffHijriDates(hire.y, hire.m, hire.d, new Intl.DateTimeFormat('ar-SA-u-ca-islamic', { year: 'numeric', month: 'numeric', day: 'numeric' }).formatToParts(new Date()).reduce((acc, part) => {
      if(part.type === 'year') acc.y = parseInt(part.value);
      else if(part.type === 'month') acc.m = parseInt(part.value);
      else if(part.type === 'day') acc.d = parseInt(part.value);
      return acc;
    }, {}));

    const serviceYearsDecimal = serviceDuration.years + serviceDuration.months / 12 + serviceDuration.days / 365;

    const maxAllowanceYears = ranksData[rank].maxYears;
    const allowanceYears = Math.min(serviceDuration.years, maxAllowanceYears);

    const baseSalary = ranksData[rank].base + allowanceYears * ranksData[rank].allowance;
    const pension = Math.round((baseSalary * serviceYearsDecimal * 0.55) / 40);

    const retireAge = ranksData[rank].retireAge;
    const retireDate = addMonthsHijriStartNextMonth(birth, retireAge * 12);

    const nowHijri = new Intl.DateTimeFormat('ar-SA-u-ca-islamic', { year: 'numeric', month: 'numeric', day: 'numeric' }).formatToParts(new Date()).reduce((acc, part) => {
      if(part.type === 'year') acc.y = parseInt(part.value);
      else if(part.type === 'month') acc.m = parseInt(part.value);
      else if(part.type === 'day') acc.d = parseInt(part.value);
      return acc;
    }, {});

    const timeToRetire = diffHijriDates(nowHijri.y, nowHijri.m, nowHijri.d, retireDate.y, retireDate.m, retireDate.d);
    const ageAtRetire = calculateAgeAtDate(birth, retireDate);

    document.getElementById('result').innerHTML = `
      <p>ğŸ–ï¸ <strong>Ø§Ù„Ø±ØªØ¨Ø©:</strong> ${rank}</p>
      <p>ğŸ“† <strong>Ù…Ø¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø­ØªÙ‰ Ø§Ù„ÙŠÙˆÙ…:</strong> ${serviceDuration.years} Ø³Ù†Ø©ØŒ ${serviceDuration.months} Ø´Ù‡Ø±ØŒ ${serviceDuration.days} ÙŠÙˆÙ…</p>
      <p>ğŸ’¼ <strong>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> ${numberToArabicText(baseSalary)} Ø±ÙŠØ§Ù„</p>
      <p>ğŸ’° <strong>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ÙŠ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</strong> ${numberToArabicText(pension)} Ø±ÙŠØ§Ù„</p>
      <hr>
      <p>â³ <strong>Ø¨Ø§Ù‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯:</strong> ${timeToRetire.years} Ø³Ù†Ø©ØŒ ${timeToRetire.months} Ø´Ù‡Ø±ØŒ ${timeToRetire.days} ÙŠÙˆÙ…</p>
      <p>ğŸ“… <strong>Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (Ù‡Ø¬Ø±ÙŠ):</strong> ${retireDate.y} / ${retireDate.m} / ${retireDate.d}</p>
      <p>ğŸ‘´ <strong>Ø¹Ù…Ø± Ø§Ù„Ù…ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</strong> ${ageAtRetire.years} Ø³Ù†Ø©ØŒ ${ageAtRetire.months} Ø´Ù‡Ø±ØŒ ${ageAtRetire.days} ÙŠÙˆÙ…</p>
      <hr>
      <p><em>Ù…Ù„Ø§Ø­Ø¸Ø©: Ø³ÙŠØªÙ… ØµØ±Ù Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ÙŠ Ø¨Ø¹Ø¯ Ø´Ù‡Ø±ÙŠÙ† Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯.</em></p>
    `;
  };
</script>

</body>
</html>