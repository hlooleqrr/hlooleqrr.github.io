<div class="container">
  <h2>حاسبة التمويل التقاعدي (الممتد)</h2>

  <!-- 📅 تاريخ اليوم (هجري) -->
  <label>📅 تاريخ اليوم (هجري):</label><br>
  <input type="number" id="todayYear" placeholder="السنة" style="width:30%;">
  <input type="number" id="todayMonth" placeholder="الشهر" style="width:30%;">
  <input type="number" id="todayDay" placeholder="اليوم" style="width:30%;"><br><br>

  <!-- 🎖️ الرتبة العسكرية -->
  <label>🎖️ اختر الرتبة العسكرية:</label><br>
  <select id="rank" style="width:95%;">
    <option value="جندي">جندي</option>
    <option value="عريف">عريف</option>
    <option value="رقيب">رقيب</option>
    <option value="رقيب أول">رقيب أول</option>
    <option value="رئيس رقباء">رئيس رقباء</option>
    <option value="ملازم">ملازم</option>
    <option value="ملازم أول">ملازم أول</option>
    <option value="نقيب">نقيب</option>
    <option value="رائد">رائد</option>
    <option value="مقدم">مقدم</option>
    <option value="عقيد">عقيد</option>
    <option value="عميد">عميد</option>
    <option value="لواء">لواء</option>
  </select><br><br>

  <!-- 📆 تاريخ التعيين -->
  <label>📆 تاريخ التعيين (هجري):</label><br>
  <input type="number" id="appointYear" placeholder="السنة" style="width:30%;">
  <input type="number" id="appointMonth" placeholder="الشهر" style="width:30%;">
  <input type="number" id="appointDay" placeholder="اليوم" style="width:30%;"><br><br>

  <!-- 🎂 تاريخ الميلاد -->
  <label>🎂 تاريخ الميلاد (هجري):</label><br>
  <input type="number" id="birthYear" placeholder="السنة" style="width:30%;">
  <input type="number" id="birthMonth" placeholder="الشهر" style="width:30%;">
  <input type="number" id="birthDay" placeholder="اليوم" style="width:30%;"><br><br>

  <!-- 💸 التمويل الصافي قبل التقاعد -->
  <label>💼 كم التمويل الصافي قبل التقاعد؟</label><br>
  <input type="number" id="preRetirementNet" placeholder="أدخل المبلغ" style="width:95%;"><br><br>

  <!-- 📈 هامش الربح -->
  <label>📈 أدخل هامش الربح المتوقع (٪):</label><br>
  <input type="number" id="profitMargin" placeholder="مثال: 4.5" style="width:95%;"><br><br>

  <button onclick="calculateRetirement()">🔍 احسب التمويل</button>

  <div id="result" style="margin-top: 30px; font-size: 26px;"></div>
</div>

<script>
function calculateRetirement() {
  const todayY = parseInt(document.getElementById("todayYear").value);
  const birthY = parseInt(document.getElementById("birthYear").value);
  const appointY = parseInt(document.getElementById("appointYear").value);
  const rank = document.getElementById("rank").value;
  const profitMargin = parseFloat(document.getElementById("profitMargin").value);
  const preRetirementNet = parseFloat(document.getElementById("preRetirementNet").value);

  const ranks = {
    "جندي":        { retireAge: 44, base: 3220, step: 125 },
    "عريف":        { retireAge: 46, base: 3765, step: 150 },
    "رقيب":        { retireAge: 48, base: 5260, step: 265 },
    "رقيب أول":    { retireAge: 50, base: 6180, step: 310 },
    "رئيس رقباء":  { retireAge: 52, base: 7215, step: 360 },
    "ملازم":       { retireAge: 48, base: 7590, step: 380 },
    "ملازم أول":   { retireAge: 50, base: 8970, step: 440 },
    "نقيب":        { retireAge: 52, base: 10600, step: 495 },
    "رائد":        { retireAge: 54, base: 13535, step: 265 },
    "مقدم":        { retireAge: 56, base: 14645, step: 470 },
    "عقيد":        { retireAge: 58, base: 15980, step: 510 },
    "عميد":        { retireAge: 60, base: 17420, step: 555 },
    "لواء":        { retireAge: 60, base: 18600, step: 580 }
  };

  if (!ranks[rank] || isNaN(profitMargin)) {
    alert("الرجاء إدخال جميع البيانات بشكل صحيح");
    return;
  }

  const retireAge = ranks[rank].retireAge;
  const base = ranks[rank].base;
  const step = ranks[rank].step;

  const retireY = birthY + retireAge;
  const serviceYears = retireY - appointY;
  const baseAtRetire = base + (step * serviceYears);
  const retirementSalary = (baseAtRetire * serviceYears / 40) * 0.55;
  const monthsAvailable = (60 - retireAge) * 12;
  const years = monthsAvailable / 12;

  const totalRequested = 100000; // افتراضي، يمكن تغييره لاحقًا
  const profitFactor = (years * profitMargin / 100) + 1;
  const netFinance = totalRequested / profitFactor;
  const profit = totalRequested - netFinance;

  const totalNetWithPre = isNaN(preRetirementNet) ? Math.round(netFinance) : Math.round(netFinance + preRetirementNet);

  document.getElementById("result").innerHTML =
    `<strong>📌 تاريخ التقاعد:</strong> ${retireY}<br>` +
    `<strong>📌 سنوات الخدمة:</strong> ${serviceYears} سنة<br>` +
    `<strong>📌 الراتب عند التقاعد:</strong> ${Math.round(baseAtRetire)} ريال<br>` +
    `<strong>📌 الراتب التقاعدي:</strong> ${Math.round(retirementSalary)} ريال<br>` +
    `<strong>📌 عدد أشهر التمويل بعد التقاعد:</strong> ${monthsAvailable} شهر<br>` +
    `<strong>📌 التمويل الصافي بعد التقاعد:</strong> ${Math.round(netFinance)} ريال<br>` +
    `<strong>📌 التمويل الصافي قبل التقاعد (المدخل):</strong> ${isNaN(preRetirementNet) ? "—" : preRetirementNet} ريال<br>` +
    `<strong>📌 المجموع الكلي للتمويل:</strong> ${totalNetWithPre} ريال<br>` +
    `<strong>📌 الربح المتوقع:</strong> ${Math.round(profit)} ريال`;
}
</script>