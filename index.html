<!-- ✅ [الجزء الأول: رأس الصفحة + التصميم + البداية] -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>حاسبة التمويل</title>
  <style>
    body { font-family: 'Tajawal', sans-serif; background: #f4f6f8; margin: 0; text-align: center; font-size: 32px; }
    header { background: #005c48; color: #fff; padding: 25px; font-size: 34px; }
    .container {
      max-width: 650px;
      margin: 25px auto;
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,.1);
    }
    input, select, button {
      width: 92%;
      padding: 20px;
      margin: 18px 0;
      font-size: 32px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    select option { font-size: 30px; }
    button {
      background: #00796b;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:hover { background: #004d40; }
    .small-reset {
      font-size: 28px;
      padding: 12px 20px;
      margin-top: 22px;
      background: #e3f2fd;
      color: #1565c0;
      border: none;
      cursor: pointer;
      border-radius: 15px;
    }
    .small-reset:hover { background: #bbdefb; }
    footer {
      font-size: 26px;
      color: #666;
      margin-top: 40px;
      padding: 15px;
    }
    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInMove .6s forwards;
    }
    @keyframes fadeInMove {
      to { opacity: 1; transform: translateY(0); }
    }
    .result p {
      margin: 12px 0;
      font-size: 30px;
      line-height: 1.6;
    }
    .result h2, .result h3 {
      font-size: 34px;
    }
    .highlight {
      font-size: 36px;
      font-weight: bold;
      color: #004d40;
    }
  </style>
</head>
<body>
<header>
  <h1>سرعة تملك العقار والحلول التمويلية</h1>
  <p>حاسبة التمويل التقريبية</p>
</header>
<div class="container" id="form-container">
  <div id="question"></div>
  <button id="mainButton" onclick="handleStartOrReset()">ابدأ الحسبة</button>
  <div id="nextContainer" style="display:none">
    <button onclick="nextQuestion()">التالي</button>
  </div>
  <div id="resetButtonContainer" style="display:none">
    <button class="small-reset" onclick="resetCalc()">🔁 إعادة الحسبة</button>
  </div>
</div><!-- ✅ [الجزء الثاني: صندوق النتيجة + الفوتر والتاريخ] -->
<div class="container" id="resultContainer" style="display:none">
  <div id="resultBox"></div>
</div>

<footer>
  <p id="datetimeFooter">جميع الحقوق محفوظة - سرعة تملك العقار - التاريخ:</p>
</footer>

<script>
function updateDateTime() {
  const now = new Date();
  const gYear = now.getFullYear();
  const gMonth = (now.getMonth() + 1).toString().padStart(2, '0');
  const gDay = now.getDate().toString().padStart(2, '0');
  const gHours = now.getHours().toString().padStart(2, '0');
  const gMinutes = now.getMinutes().toString().padStart(2, '0');

  const hijri = new Intl.DateTimeFormat('ar-TN-u-ca-islamic', {
    day: '2-digit', month: '2-digit', year: 'numeric'
  }).format(now).replace(/(\d+)\/(\d+)\/(\d+)/, (_, d, m, y) => `${y}/${m.padStart(2,'0')}/${d.padStart(2,'0')}`);

  document.getElementById('datetimeFooter').innerText =
    `جميع الحقوق محفوظة - سرعة تملك العقار - التاريخ الهجري: ${hijri} - الميلادي: ${gYear}/${gMonth}/${gDay} - الوقت: ${gHours}:${gMinutes}`;
}
setInterval(updateDateTime, 1000);
updateDateTime();
</script><!-- ✅ [الجزء الثالث: المتغيرات العامة والدوال الأساسية للتنقل] -->
<script>
let step = 0;
let commitmentStep = 0;
let currentCommitment = {};
let hasStarted = false;
let answers = {
  commitments: []
};

function handleStartOrReset() {
  if (!hasStarted) {
    hasStarted = true;
    document.getElementById('mainButton').style.display = 'none';
    document.getElementById('resetButtonContainer').style.display = 'block';
    showQuestion();
  } else {
    resetCalc();
  }
}

function resetCalc() {
  answers = { commitments: [] };
  step = 0;
  commitmentStep = 0;
  currentCommitment = {};
  hasStarted = true;
  document.getElementById('mainButton').style.display = 'none';
  document.getElementById('resetButtonContainer').style.display = 'block';
  document.getElementById('resultContainer').style.display = 'none';
  document.getElementById('resultBox').innerHTML = '';
  showQuestion();
}

function showQuestion() {
  const cont = document.getElementById('question');
  cont.innerHTML = '';
  document.getElementById('nextContainer').style.display = 'block';
  let q;
  if (step < generalQuestions.length) {
    q = generalQuestions[step];
    if (q.show && !q.show(answers)) {
      step++;
      showQuestion();
      return;
    }
  } else if (answers.hasCommitments === 'نعم') {
    q = commitmentQuestions[commitmentStep];
    if (q && q.show && !q.show(answers)) {
      commitmentStep++;
      showQuestion();
      return;
    }
  }

  if (q) {
    const label = document.createElement('label');
    label.textContent = q.question;
    label.className = 'fade-in';
    cont.appendChild(label);
    const input = q.render();
    input.className = 'fade-in';
    cont.appendChild(input);
  } else {
    calculate();
  }
}

function nextQuestion() {
  const q = (step < generalQuestions.length)
    ? generalQuestions[step]
    : commitmentQuestions[commitmentStep];

  if (!q) {
    calculate();
    return;
  }

  const input = document.querySelector('#question input, #question select');
  if (!input) return;

  const value = input.type === 'checkbox' ? input.checked : input.value;
  if (step < generalQuestions.length) {
    answers[q.name] = value;
    step++;
  } else {
    currentCommitment[q.name] = value;
    commitmentStep++;
    if (commitmentStep >= commitmentQuestions.length) {
      answers.commitments.push(currentCommitment);
      currentCommitment = {};
      commitmentStep = 0;
      if (value === 'لا') step++;
    }
  }
  showQuestion();
}
</script><!-- ✅ [الجزء الرابع: الأسئلة العامة مثل الاسم، نوع التمويل، الوظيفة، الميلاد، الرتبة] -->
<script>
const generalQuestions = [
  {
    name: 'fullName',
    question: 'اسمك الكريم:',
    render: () => {
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'مثال: محمد بن عبدالعزيز';
      return input;
    }
  },
  {
    name: 'financeType',
    question: 'اختر نوع التمويل تريد حسبته:',
    render: () => {
      const select = document.createElement('select');
      ['تمويل شخصي أو تمويل استهلاكي', 'تمويل عقاري'].forEach(val => {
        const option = document.createElement('option');
        option.value = val;
        option.textContent = val;
        select.appendChild(option);
      });
      return select;
    }
  },
  {
    name: 'jobType',
    question: 'ما نوع وظيفتك؟',
    render: () => {
      const select = document.createElement('select');
      ['عسكري', 'مدني', 'خاص شبه حكومي', 'خاص معتمد', 'خاص غير معتمد'].forEach(val => {
        const option = document.createElement('option');
        option.value = val;
        option.textContent = val;
        select.appendChild(option);
      });
      return select;
    }
  },
  {
    name: 'birthHijriYear',
    question: 'اختر سنة ميلادك (هجري):',
    render: () => {
      const select = document.createElement('select');
      for (let y = 1370; y <= 1430; y++) {
        const option = document.createElement('option');
        option.value = y;
        option.textContent = y;
        if (y === 1412) option.selected = true;
        select.appendChild(option);
      }
      return select;
    }
  },
  {
    name: 'birthHijriMonth',
    question: 'اختر شهر ميلادك (هجري):',
    render: () => {
      const select = document.createElement('select');
      for (let m = 1; m <= 12; m++) {
        const option = document.createElement('option');
        option.value = m.toString().padStart(2, '0');
        option.textContent = m;
        select.appendChild(option);
      }
      return select;
    }
  },
  {
    name: 'birthHijriDay',
    question: 'اختر يوم ميلادك (هجري):',
    render: () => {
      const select = document.createElement('select');
      for (let d = 1; d <= 30; d++) {
        const option = document.createElement('option');
        option.value = d.toString().padStart(2, '0');
        option.textContent = d;
        select.appendChild(option);
      }
      return select;
    }
  },
  {
    name: 'rank',
    question: 'ما هي رتبتك العسكرية؟',
    show: (answers) => answers.jobType === 'عسكري',
    render: () => {
      const select = document.createElement('select');
      ['جندي', 'جندي أول', 'عريف', 'وكيل رقيب', 'رقيب', 'رقيب أول', 'رئيس رقباء',
       'ملازم', 'ملازم أول', 'نقيب', 'رائد', 'مقدم', 'عقيد', 'عميد', 'لواء'].forEach(val => {
        const option = document.createElement('option');
        option.value = val;
        option.textContent = val;
        select.appendChild(option);
      });
      return select;
    }
  }
];
</script><!-- ✅ [الجزء الخامس: منطق التقاعد الممتد للعسكريين بعد الرتبة وتاريخ الميلاد] -->
<script>
generalQuestions.push({
  name: 'wantExtendedRetirement',
  question: 'أنت تتقاعد خلال أقل من 25 سنة، هل تريد الحسبة ممتدة بعد التقاعد؟',
  show: (a) => {
    if (a.jobType !== 'عسكري' || !a.birthHijriYear || !a.rank) return false;

    const currentHijriYear = 1446;
    const ranksRetireAge = {
      "جندي": 44, "جندي أول": 44, "عريف": 46, "وكيل رقيب": 46,
      "رقيب": 48, "رقيب أول": 50, "رئيس رقباء": 52,
      "ملازم": 48, "ملازم أول": 50, "نقيب": 52, "رائد": 54,
      "مقدم": 56, "عقيد": 58, "عميد": 60, "لواء": 60
    };

    const retireAge = ranksRetireAge[a.rank] || 44;
    const userAge = currentHijriYear - parseInt(a.birthHijriYear);
    const yearsLeft = retireAge - userAge;
    return yearsLeft < 25;
  },
  render: () => {
    const select = document.createElement('select');
    ['نعم', 'لا'].forEach(val => {
      const option = document.createElement('option');
      option.value = val;
      option.textContent = val;
      select.appendChild(option);
    });
    return select;
  }
});

generalQuestions.push({
  name: 'hireHijriYear',
  question: 'اختر سنة التعيين (هجري):',
  show: (a) => a.wantExtendedRetirement === 'نعم',
  render: () => {
    const select = document.createElement('select');
    for (let y = 1400; y <= 1447; y++) {
      const option = document.createElement('option');
      option.value = y;
      option.textContent = y;
      select.appendChild(option);
    }
    return select;
  }
});

generalQuestions.push({
  name: 'hireHijriMonth',
  question: 'اختر شهر التعيين (هجري):',
  show: (a) => a.wantExtendedRetirement === 'نعم',
  render: () => {
    const select = document.createElement('select');
    for (let m = 1; m <= 12; m++) {
      const option = document.createElement('option');
      option.value = m.toString().padStart(2, '0');
      option.textContent = m;
      select.appendChild(option);
    }
    return select;
  }
});

generalQuestions.push({
  name: 'hireHijriDay',
  question: 'اختر يوم التعيين (هجري):',
  show: (a) => a.wantExtendedRetirement === 'نعم',
  render: () => {
    const select = document.createElement('select');
    for (let d = 1; d <= 30; d++) {
      const option = document.createElement('option');
      option.value = d.toString().padStart(2, '0');
      option.textContent = d;
      select.appendChild(option);
    }
    return select;
  }
});
</script>// ✅ الجزء السادس: التقاعد الممتد للعسكريين

// 🔹 الأسئلة المتعلقة بالحسبة الممتدة
{
  name: "wantsExtendedRetirement",
  question: "هل ترغب بالحسبة بعد التقاعد؟",
  type: "select",
  options: ["نعم", "لا"],
  show: (a) => a.financeType === "تمويل عقاري" && a.jobType === "عسكري" && a.retirementYearsLeft < 25
},
{
  name: "hireHijriDay",
  question: "اختر يوم التعيين (هجري)",
  type: "select",
  options: Array.from({ length: 30 }, (_, i) => `${i + 1}`),
  show: (a) => a.wantsExtendedRetirement === "نعم"
},
{
  name: "hireHijriMonth",
  question: "اختر شهر التعيين (هجري)",
  type: "select",
  options: Array.from({ length: 12 }, (_, i) => `${i + 1}`),
  show: (a) => a.wantsExtendedRetirement === "نعم"
},
{
  name: "hireHijriYear",
  question: "اختر سنة التعيين (هجري)",
  type: "select",
  options: Array.from({ length: 40 }, (_, i) => `${1410 + i}`),
  show: (a) => a.wantsExtendedRetirement === "نعم"
}

// 🔹 دوال تحويل التاريخ وحساب التقاعد
function hijriToGregorian(hYear, hMonth, hDay) {
  const approxDate = new Date(hYear * 354 + hMonth * 29.5 + hDay);
  const offset = (hYear - 1400) * 11;
  approxDate.setFullYear(approxDate.getFullYear() + offset);
  return approxDate;
}

function calculateMilitaryRetirement(rank, hijriYear, hijriMonth, hijriDay) {
  const hireDate = hijriToGregorian(hijriYear, hijriMonth, hijriDay);
  const today = new Date();
  const yearsOfService = Math.floor((today - hireDate) / (1000 * 60 * 60 * 24 * 365.25));
  const maxDegree = Math.min(yearsOfService, 15);

  const baseSalaries = {
    "جندي": 3220, "جندي أول": 3395, "عريف": 3765, "وكيل رقيب": 4455, "رقيب": 5260,
    "رقيب أول": 6180, "رئيس رقباء": 7215, "ملازم": 7590, "ملازم أول": 8835,
    "نقيب": 10600, "رائد": 13515, "مقدم": 14645, "عقيد": 16520,
    "عميد": 18600, "لواء": 21390
  };

  const increments = {
    "جندي": 125, "جندي أول": 145, "عريف": 155, "وكيل رقيب": 180, "رقيب": 210,
    "رقيب أول": 240, "رئيس رقباء": 280, "ملازم": 380, "ملازم أول": 415,
    "نقيب": 495, "رائد": 265, "مقدم": 470, "عقيد": 510,
    "عميد": 570, "لواء": 665
  };

  const basic = baseSalaries[rank] + increments[rank] * (maxDegree - 1);
  const retirement = Math.round((basic * yearsOfService / 40) * 0.55);

  return {
    سنوات_الخدمة: yearsOfService,
    الدرجة: maxDegree,
    الراتب_الأساسي: basic,
    الراتب_التقاعدي: retirement
  };
}

// 🔹 تشغيل الحساب بعد إدخال البيانات
if (answers.wantsExtendedRetirement === "نعم") {
  const result = calculateMilitaryRetirement(
    answers.rank,
    parseInt(answers.hireHijriYear),
    parseInt(answers.hireHijriMonth),
    parseInt(answers.hireHijriDay)
  );

  answers.serviceYears = result.سنوات_الخدمة;
  answers.finalBasicSalary = result.الراتب_الأساسي;
  answers.estimatedRetirement = result.الراتب_التقاعدي;
}// ✅ الجزء السابع: حساب الأقساط قبل وبعد التقاعد (الممتد)

function hijriToGregorian(hYear, hMonth, hDay) {
  const hijriDate = new HijriDate(hYear, hMonth - 1, hDay);
  const gDate = hijriDate.toGregorian();
  return new Date(gDate.getFullYear(), gDate.getMonth(), gDate.getDate());
}

function getRetirementAgeByRank(rank) {
  const ranks = {
    "جندي": 44, "جندي أول": 44, "عريف": 46, "وكيل رقيب": 46,
    "رقيب": 48, "رقيب أول": 50, "رئيس رقباء": 52,
    "ملازم": 48, "ملازم أول": 50, "نقيب": 52,
    "رائد": 54, "مقدم": 56, "عقيد": 58, "عميد": 60, "لواء": 60
  };
  return ranks[rank] || 60;
}

function calculateExtendedRetirementInstallments(retirementAge, birthHijriYear, birthHijriMonth, birthHijriDay, totalMonths, currentNetSalary, retirementSalary) {
  const birthHijriDate = hijriToGregorian(parseInt(birthHijriYear), parseInt(birthHijriMonth), parseInt(birthHijriDay));
  const retirementDate = new Date(birthHijriDate);
  retirementDate.setFullYear(retirementDate.getFullYear() + retirementAge);

  const today = new Date();
  const monthsToRetirement = Math.floor((retirementDate - today) / (1000 * 60 * 60 * 24 * 30.4375));
  const monthsBefore = Math.max(0, Math.min(totalMonths, monthsToRetirement));
  const monthsAfter = totalMonths - monthsBefore;

  const installmentBefore = Math.floor(currentNetSalary * 0.55);
  const installmentAfter = Math.floor(retirementSalary * 0.55);

  const installments = [];
  if (monthsBefore > 0) {
    installments.push({
      from: 1,
      to: monthsBefore,
      amount: installmentBefore
    });
  }
  if (monthsAfter > 0) {
    installments.push({
      from: monthsBefore + 1,
      to: totalMonths,
      amount: installmentAfter
    });
  }

  return installments;
}

// ✅ يتم تنفيذ هذا الجزء بعد الإجابة بـ "نعم" على سؤال الممتد
if (
  answers.financeType === "تمويل عقاري" &&
  answers.jobType === "عسكري" &&
  answers.wantsExtendedRetirement === "نعم"
) {
  const retirementAge = getRetirementAgeByRank(answers.rank);
  const birthYear = parseInt(answers.birthHijriYear);
  const birthMonth = parseInt(answers.birthHijriMonth);
  const birthDay = parseInt(answers.birthHijriDay);
  const months = parseInt(answers.months);
  const currentSalary = parseInt(answers.salary);
  const retirementSalary = parseInt(answers.estimatedRetirement);

  const result = calculateExtendedRetirementInstallments(
    retirementAge, birthYear, birthMonth, birthDay,
    months, currentSalary, retirementSalary
  );

  answers.extendedInstallments = result;
}// ✅ الجزء الثامن: أسئلة الالتزامات المتعددة

{
  name: "hasCommitments",
  question: "هل لديك التزامات مالية حالية؟",
  type: "select",
  options: ["نعم", "لا"],
  show: () => true
},
// إذا أجاب "نعم" نبدأ تكرار مجموعة الأسئلة التالية:
{
  name: "commitmentType",
  question: "ما نوع الالتزام؟",
  type: "select",
  options: ["قرض سيارة", "قرض استهلاكي", "أخرى"],
  show: (a) => a.hasCommitments === "نعم"
},
{
  name: "commitmentAmount",
  question: "كم القسط الشهري لهذا الالتزام؟",
  type: "number",
  show: (a) => a.hasCommitments === "نعم"
},
{
  name: "commitmentMonthsLeft",
  question: "كم عدد الأشهر المتبقية لهذا الالتزام؟",
  type: "select",
  options: Array.from({ length: 60 }, (_, i) => `${i + 1}`),
  show: (a) => a.hasCommitments === "نعم"
},
{
  name: "hasBalloonPayment",
  question: "هل يوجد دفعة أخيرة؟",
  type: "select",
  options: ["نعم", "لا"],
  show: (a) => a.hasCommitments === "نعم" && a.commitmentType === "قرض سيارة"
},
{
  name: "balloonAmount",
  question: "كم مبلغ الدفعة الأخيرة؟",
  type: "number",
  show: (a) => a.hasBalloonPayment === "نعم"
},
{
  name: "anotherCommitment",
  question: "هل لديك التزام آخر؟",
  type: "select",
  options: ["نعم", "لا"],
  show: (a) => a.hasCommitments === "نعم"
}// ✅ الجزء التاسع: حساب الأقساط المتدرجة بناءً على الالتزامات

function buildCommitmentSchedule(commitments, maxMonths) {
  const schedule = Array(maxMonths).fill(0);

  commitments.forEach((c) => {
    const months = parseInt(c.months);
    const monthly = parseInt(c.amount);
    for (let i = 0; i < months && i < maxMonths; i++) {
      schedule[i] += monthly;
    }

    // إذا كانت دفعة أخيرة لسيارة
    if (c.balloon) {
      const balloon = parseInt(c.balloon);
      const start = months;
      const end = Math.min(start + 24, maxMonths);
      const balloonMonthly = Math.ceil(balloon / (end - start));
      for (let i = start; i < end; i++) {
        schedule[i] += balloonMonthly;
      }
    }
  });

  return schedule;
}

function buildFinalInstallmentsWithCommitments(
  maxMonths,
  installments,
  commitmentSchedule
) {
  const result = [];
  let current = null;

  for (let i = 0; i < maxMonths; i++) {
    let base = 0;
    for (const segment of installments) {
      if (i + 1 >= segment.from && i + 1 <= segment.to) {
        base = segment.amount;
        break;
      }
    }

    const available = base - (commitmentSchedule[i] || 0);
    const amount = Math.max(0, available);

    if (!current || current.amount !== amount) {
      if (current) current.to = i;
      current = { from: i + 1, to: i + 1, amount };
      result.push(current);
    } else {
      current.to = i + 1;
    }
  }

  return result;
}

// ✅ تنفيذ هذا الجزء بعد معرفة answers.commitments + answers.extendedInstallments

if (Array.isArray(answers.commitments) && Array.isArray(answers.extendedInstallments)) {
  const months = parseInt(answers.months);
  const schedule = buildCommitmentSchedule(answers.commitments, months);
  answers.installments = buildFinalInstallmentsWithCommitments(
    months,
    answers.extendedInstallments,
    schedule
  );
}function getDurationText(months) {
  const years = Math.floor(months / 12);
  const extra = months % 12;
  let parts = [];
  if (years > 0) parts.push(`${years} ${years === 1 ? "سنة" : "سنوات"}`);
  if (extra > 0) parts.push(`${extra} ${extra === 1 ? "شهر" : "أشهر"}`);
  return parts.join(" و ");
}

function showInstallmentsTable(container) {
  const installments = answers.installments;
  if (!Array.isArray(installments)) return;

  const div = document.createElement("div");
  div.style.textAlign = "right";
  div.style.marginTop = "25px";
  div.innerHTML = `<h3 style="color:#005c48;">تفاصيل الأقساط الشهرية:</h3>`;

  installments.forEach(inst => {
    const duration = inst.to - inst.from + 1;
    const text = getDurationText(duration);
    const row = document.createElement("p");
    row.textContent = `من ${inst.from} إلى ${inst.to} (${text}) = ${inst.amount.toLocaleString()} ريال`;
    row.style.fontSize = "28px";
    div.appendChild(row);
  });

  container.appendChild(div);
}

// ✅ داخل دالة showFinalResult() أضف هذا السطر في النهاية:
showInstallmentsTable(document.getElementById("resultContainer"));
function getArabicDurationText(months) {
  const years = Math.floor(months / 12);
  const monthsLeft = months % 12;

  const yearText = years > 0 ? `${years} ${years === 1 ? "سنة" : (years === 2 ? "سنتين" : (years < 11 ? "سنوات" : "سنة"))}` : "";
  const monthText = monthsLeft > 0 ? `${monthsLeft} ${monthsLeft === 1 ? "شهر" : (monthsLeft === 2 ? "شهرين" : (monthsLeft < 11 ? "أشهر" : "شهراً"))}` : "";

  if (yearText && monthText) return `${yearText} و${monthText}`;
  return yearText || monthText || "0 شهر";
}

function showDuration(container) {
  const duration = parseInt(answers.months || "0");
  const text = getArabicDurationText(duration);

  const div = document.createElement("div");
  div.style.textAlign = "right";
  div.style.marginTop = "20px";
  div.innerHTML = `
    <h3 style="color:#005c48;">مدة التمويل:</h3>
    <p style="font-size: 28px;">${duration} شهر (${text})</p>
  `;

  container.appendChild(div);
}

// ✅ داخل دالة showFinalResult() بعد الأقساط:
showDuration(document.getElementById("resultContainer"));
function formatCurrency(num) {
  return parseInt(num || 0).toLocaleString("ar-EG") + " ريال";
}

function showSummary(container) {
  const {
    netFinance,
    netFinanceWithSupport,
    profitOnly,
    profitWithFees,
    totalWithProfit,
    fees,
    supportUsed
  } = answers;

  const p1 = document.createElement("p");
  p1.innerHTML = `التمويل الصافي بعد خصم الرسوم: <strong style="color:green;">${formatCurrency(netFinance)}</strong>`;
  container.appendChild(p1);

  if (supportUsed === 'نعم') {
    const p2 = document.createElement("p");
    p2.innerHTML = `التمويل الصافي مع الدعم: <strong style="color:green;">${formatCurrency(netFinanceWithSupport)}</strong>`;
    container.appendChild(p2);
  }

  const p3 = document.createElement("p");
  p3.innerHTML = `الربح دون الرسوم: <strong style="color:red;">${formatCurrency(profitOnly)}</strong>`;
  container.appendChild(p3);

  const p4 = document.createElement("p");
  p4.innerHTML = `الربح مع الرسوم: <strong style="color:red;">${formatCurrency(profitWithFees)}</strong>`;
  container.appendChild(p4);

  const p5 = document.createElement("p");
  p5.innerHTML = `التمويل الإجمالي شامل الأرباح: <strong>${formatCurrency(totalWithProfit)}</strong>`;
  container.appendChild(p5);

  const p6 = document.createElement("p");
  p6.innerHTML = `الرسوم الإدارية + الضريبة: <strong>${formatCurrency(fees)}</strong>`;
  container.appendChild(p6);

  const advice = document.createElement("p");
  advice.style.marginTop = "40px";
  advice.innerHTML = "📸 خذ لقطة شاشة لنتيجتك أو تواصل معنا لأي استفسار.";
  container.appendChild(advice);
}

// 📌 يجب أن تضيف هذا داخل showFinalResult():
showSummary(document.getElementById("resultContainer"));
// الترحيب بالاسم الكريم في أعلى النتيجة
const greeting = document.createElement("h2");
greeting.textContent = `مرحباً ومسهلاً يا ${answers.clientName}`;
document.getElementById("resultContainer").prepend(greeting);
<footer>
  <p id="datetimeFooter">جميع الحقوق محفوظة - سرعة تملك العقار</p>
</footer>

<script>
function updateDateTimeFooter() {
  const today = new Date();
  const gregorian = today.toLocaleDateString("ar-EG");
  const hijri = today.toLocaleDateString("ar-SA-u-ca-islamic", {
    year: "numeric", month: "2-digit", day: "2-digit"
  });
  document.getElementById("datetimeFooter").innerText =
    `جميع الحقوق محفوظة - سرعة تملك العقار - التاريخ الهجري: ${hijri} - الميلادي: ${gregorian}`;
}
setInterval(updateDateTimeFooter, 1000);
updateDateTimeFooter();
</script>
// ✅ الجزء الخامس عشر: زر إعادة الحسبة من أسفل صفحة النتيجة

const resetContainer = document.createElement("div");
resetContainer.style.marginTop = "30px";

const resetButton = document.createElement("button");
resetButton.textContent = "🔁 إعادة الحسبة";
resetButton.style.backgroundColor = "#e0f0ff";
resetButton.style.border = "1px solid #007bff";
resetButton.style.color = "#007bff";
resetButton.style.padding = "15px 25px";
resetButton.style.fontSize = "28px";
resetButton.style.borderRadius = "8px";
resetButton.style.cursor = "pointer";

resetButton.onclick = () => {
  location.reload(); // يرجعك للبداية
};

resetContainer.appendChild(resetButton);
document.getElementById("resultContainer").appendChild(resetContainer);
// ✅ الجزء السابع عشر: عرض الأرقام بفاصلة وكتابة عربية

function numberToArabicWords(num) {
  const ones = ["", "واحد", "اثنان", "ثلاثة", "أربعة", "خمسة", "ستة", "سبعة", "ثمانية", "تسعة"];
  const tens = ["", "عشرة", "عشرون", "ثلاثون", "أربعون", "خمسون", "ستون", "سبعون", "ثمانون", "تسعون"];
  const hundreds = ["", "مئة", "مئتان", "ثلاث مئة", "أربع مئة", "خمس مئة", "ست مئة", "سبع مئة", "ثمان مئة", "تسع مئة"];

  let result = "";

  const thousands = Math.floor(num / 1000);
  const hundredsPart = Math.floor((num % 1000) / 100);
  const tensPart = Math.floor((num % 100) / 10);
  const onesPart = num % 10;

  if (thousands > 0) {
    result += ones[thousands] + " آلاف ";
  }

  if (hundredsPart > 0) {
    result += hundreds[hundredsPart] + " ";
  }

  if (tensPart > 0) {
    result += tens[tensPart] + " ";
  }

  if (onesPart > 0 && tensPart === 0) {
    result += ones[onesPart] + " ";
  }

  return result.trim() + " ريال";
}

// عند عرض التمويل الصافي والربح
const netFinance = Math.round(result.netFinance || 0);
const profit = Math.round(result.profit || 0);

// إنشاء العناصر
const netFinanceText = document.createElement("div");
netFinanceText.innerHTML = `<strong>التمويل الصافي بعد خصم الرسوم:</strong> ${netFinance.toLocaleString()} ريال (${numberToArabicWords(netFinance)})`;

const profitText = document.createElement("div");
profitText.innerHTML = `<strong>الربح دون الرسوم:</strong> ${profit.toLocaleString()} ريال (${numberToArabicWords(profit)})`;

// إضافتها للنتيجة
document.getElementById("resultContainer").appendChild(netFinanceText);
document.getElementById("resultContainer").appendChild(profitText);
// ✅ الجزء الثامن عشر: عرض مدة التمويل بصيغة عدد وكتابة

function formatDurationArabic(months) {
  const years = Math.floor(months / 12);
  const extraMonths = months % 12;

  let result = `${months} شهر (`;

  if (years > 0) {
    result += convertNumberToWords(years) + (years === 1 ? " سنة" : " سنوات");
  }

  if (years > 0 && extraMonths > 0) {
    result += " و";
  }

  if (extraMonths > 0) {
    result += convertNumberToWords(extraMonths) + (extraMonths === 1 ? " شهر" : " أشهر");
  }

  result += ")";

  return result;
}

function convertNumberToWords(n) {
  const words = [
    "", "واحد", "اثنان", "ثلاثة", "أربعة", "خمسة", "ستة",
    "سبعة", "ثمانية", "تسعة", "عشرة", "أحد عشر", "اثنا عشر"
  ];
  return n <= 12 ? words[n] : n + "";
}

// مثال الاستخدام:
const durationDiv = document.createElement("div");
durationDiv.style.marginTop = "25px";
durationDiv.style.fontSize = "30px";
durationDiv.innerHTML = `<strong>مدة التمويل:</strong> ${formatDurationArabic(result.months || 0)}`;

document.getElementById("resultContainer").appendChild(durationDiv);
<!-- ✅ الجزء العشرون: زر إعادة الحسبة -->
<div id="resetButtonContainer" style="display: block; margin-top: 40px;">
  <button onclick="resetCalc()" style="background-color: #d0eaff; border: none; padding: 15px 30px; font-size: 28px; border-radius: 8px; cursor: pointer;">
    🔁 إعادة الحسبة
  </button>
</div>
function resetCalc(){
  answers = { commitments: [] };
  step = commitmentStep = 0;
  currentCommitment = {};
  hasStarted = false;

  document.getElementById('question').innerHTML = '';
  document.getElementById('resultContainer').innerHTML = '';
  document.getElementById('resetButtonContainer').style.display = 'none';
  document.getElementById('mainButton').style.display = 'block';
}