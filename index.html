<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>حاسبة التمويل</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: #f4f6f8;
      margin: 0;
      text-align: center;
      font-size: 32px;
    }
    header {
      background: #005c48;
      color: #fff;
      padding: 25px;
      font-size: 34px;
    }
    .container {
      max-width: 650px;
      margin: 25px auto;
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,.1);
    }
    input, select, button {
      width: 92%;
      padding: 20px;
      margin: 18px 0;
      font-size: 32px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    #mainButton {
      background: #00796b;
      color: white;
      font-size: 36px;
      cursor: pointer;
      border: none;
      padding: 20px 40px;
      border-radius: 8px;
      margin-top: 30px;
    }
    #resetButtonContainer {
      display: none;
      margin-top: 20px;
    }
    #resetButton {
      background: #ccc;
      color: #333;
      font-size: 28px;
      border: none;
      padding: 14px 30px;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>حاسبة التمويل العقاري أو الشخصي</header>
  <div class="container">
    <div id="question"></div>
    <div id="nextContainer" style="display: none;">
      <button onclick="nextQuestion()">التالي</button>
    </div>
    <button id="mainButton" onclick="handleStartOrReset()">ابدأ الحسبة</button>
    <div id="resetButtonContainer">
      <button id="resetButton" onclick="handleStartOrReset()">🔁 إعادة الحسبة</button>
    </div>
  </div>
  <script>
    let answers = { commitments: [] }, step = 0, commitmentStep = 0, currentCommitment = {};
    let hasStarted = false;

    const generalQuestions = [
      {
        key: 'financeType',
        question: 'اختر نوع التمويل تريد حسبته:',
        type: 'select',
        options: ['تمويل شخصي أو تمويل استهلاكي', 'تمويل عقاري']
      },
      {
        key: 'username',
        question: 'ادخل اسمك الكريم:',
        type: 'text'
      },
      {
        key: 'jobType',
        question: 'ما نوع وظيفتك؟',
        type: 'select',
        options: ['عسكري', 'مدني', 'خاص شبه حكومي', 'خاص معتمد', 'خاص غير معتمد']
      },
      {
        key: 'birthHijriDay',
        question: 'اختر يوم ميلادك (هجري):',
        type: 'select',
        options: Array.from({ length: 30 }, (_, i) => `${i + 1}`)
      },
      {
        key: 'birthHijriMonth',
        question: 'اختر شهر ميلادك (هجري):',
        type: 'select',
        options: Array.from({ length: 12 }, (_, i) => `${i + 1}`)
      },
      {
        key: 'birthHijriYear',
        question: 'اختر سنة الميلاد (هجري):',
        type: 'select',
        options: Array.from({ length: 61 }, (_, i) => `${1370 + i}`).reverse()
      }
    ];

    function handleStartOrReset() {
      if (!hasStarted) {
        hasStarted = true;
        document.getElementById('mainButton').style.display = 'none';
        document.getElementById('resetButtonContainer').style.display = 'block';
        showQuestion();
      } else {
        resetCalc();
      }
    }

    function resetCalc() {
      answers = { commitments: [] };
      step = commitmentStep = 0;
      currentCommitment = {};
      hasStarted = true;
      document.getElementById('mainButton').style.display = 'none';
      document.getElementById('resetButtonContainer').style.display = 'block';
      showQuestion();
    }

    function showQuestion() {
      const cont = document.getElementById('question');
      cont.innerHTML = '';
      document.getElementById('nextContainer').style.display = 'block';

      let q = generalQuestions[step];
      if (!q) return;

      const label = document.createElement('label');
      label.textContent = q.question;
      cont.appendChild(label);

      let input;
      if (q.type === 'select') {
        input = document.createElement('select');
        input.innerHTML = q.options.map(opt => `<option value="${opt}">${opt}</option>`).join('');
      } else {
        input = document.createElement('input');
        input.type = q.type;
      }
      input.id = 'input';
      if (answers[q.key]) input.value = answers[q.key];
      cont.appendChild(input);
    }

    function nextQuestion() {
      const q = generalQuestions[step];
      const input = document.getElementById('input');
      if (input && input.value) {
        answers[q.key] = input.value;
        step++;
        showQuestion();
      }
    }
  </script><script>
let answers = { commitments: [] }, step = 0, commitmentStep = 0, currentCommitment = {};
let hasStarted = false;

// ✅ جدول الرواتب العسكرية
const militaryRanksData = {
  "جندي": { base: 3220, increment: 125, maxGrade: 15 },
  "عريف": { base: 3765, increment: 155, maxGrade: 15 },
  "وكيل رقيب": { base: 4455, increment: 180, maxGrade: 15 },
  "رقيب": { base: 5260, increment: 210, maxGrade: 15 },
  "رقيب أول": { base: 6180, increment: 240, maxGrade: 15 },
  "رئيس رقباء": { base: 7215, increment: 280, maxGrade: 15 },
  "ملازم": { base: 7590, increment: 380, maxGrade: 15 },
  "ملازم أول": { base: 8835, increment: 415, maxGrade: 15 },
  "نقيب": { base: 10600, increment: 495, maxGrade: 15 },
  "رائد": { base: 13515, increment: 265, maxGrade: 15 },
  "مقدم": { base: 14645, increment: 470, maxGrade: 15 },
  "عقيد": { base: 16520, increment: 510, maxGrade: 15 },
  "عميد": { base: 18600, increment: 570, maxGrade: 15 },
  "لواء": { base: 21390, increment: 665, maxGrade: 15 }
};

// ✅ تحويل هجري إلى ميلادي تقريبي
function hijriToGregorianApprox(hYear, hMonth, hDay) {
  const hijriDays = (hYear - 1) * 354 + (hMonth - 1) * 29.5 + hDay;
  const gregorianDate = new Date(622, 6, 16);
  gregorianDate.setDate(gregorianDate.getDate() + Math.floor(hijriDays));
  return gregorianDate;
}

// ✅ حساب سنوات الخدمة
function calculateServiceYears(hireHijriYear, hireHijriMonth, hireHijriDay) {
  const hireDate = hijriToGregorianApprox(hireHijriYear, hireHijriMonth, hireHijriDay);
  const today = new Date();
  const years = (today - hireDate) / (1000 * 60 * 60 * 24 * 365.25);
  return Math.floor(years);
}

// ✅ الراتب الأساسي النهائي
function getFinalBasicSalary(rank, serviceYears) {
  const data = militaryRanksData[rank];
  if (!data) return 0;
  const grade = Math.min(serviceYears, data.maxGrade);
  return data.base + data.increment * (grade - 1);
}

// ✅ احتساب الراتب التقاعدي تلقائيًا
function calculateRetirementSalary(rank, hireHijriYear, hireHijriMonth, hireHijriDay) {
  const serviceYears = calculateServiceYears(hireHijriYear, hireHijriMonth, hireHijriDay);
  const finalBasic = getFinalBasicSalary(rank, serviceYears);
  const retirement = Math.round((finalBasic * serviceYears / 40) * 0.55);
  return {
    serviceYears: serviceYears,
    finalBasicSalary: finalBasic,
    retirementSalary: retirement
  };
}
</script><script>
// ✅ أسئلة الحاسبة العامة بالتسلسل
const generalQuestions = [
  {
    key: 'clientName',
    text: 'اكتب اسمك الكريم:',
    type: 'input',
    placeholder: ': ',
    show: () => true
  },
  {
    key: 'financeType',
    text: 'اختر نوع التمويل تريد حسبته:',
    type: 'select',
    options: ['تمويل شخصي أو تمويل استهلاكي', 'تمويل عقاري'],
    show: () => true
  },
  {
    key: 'jobType',
    text: 'ما نوع وظيفتك؟',
    type: 'select',
    options: ['عسكري', 'مدني', 'خاص شبه حكومي', 'خاص معتمد', 'خاص غير معتمد'],
    show: () => true
  },
  {
    key: 'birthHijriYear',
    text: 'اختر سنة ميلادك (هجري):',
    type: 'select',
    options: Array.from({ length: 61 }, (_, i) => `${1370 + i}`),
    show: () => true
  },
  {
    key: 'birthHijriMonth',
    text: 'اختر شهر ميلادك (هجري):',
    type: 'select',
    options: Array.from({ length: 12 }, (_, i) => `${i + 1}`),
    show: () => true
  },
  {
    key: 'birthHijriDay',
    text: 'اختر يوم ميلادك (هجري):',
    type: 'select',
    options: Array.from({ length: 30 }, (_, i) => `${i + 1}`),
    show: () => true
  },
  {
    key: 'rank',
    text: 'اختر رتبتك العسكرية:',
    type: 'select',
    options: Object.keys(militaryRanksData),
    show: (a) => a.jobType === 'عسكري'
  },
  {
    key: 'retireExtended',
    text: 'مدة تقاعدك أقل من 25 سنة، هل ترغب بالحسبة بعد التقاعد؟',
    type: 'select',
    options: ['نعم', 'لا'],
    show: (a) => {
      if (a.jobType !== 'عسكري') return false;
      const year = parseInt(a.birthHijriYear);
      const ageNow = 1446 - year;
      const rankAge = getRetireAgeByRank(a.rank);
      return rankAge - ageNow < 25;
    }
  },
  {
    key: 'hireHijriYear',
    text: 'اختر سنة التعيين (هجري):',
    type: 'select',
    options: Array.from({ length: 35 }, (_, i) => `${1412 - i}`),
    show: (a) => a.retireExtended === 'نعم'
  },
  {
    key: 'hireHijriMonth',
    text: 'اختر شهر التعيين (هجري):',
    type: 'select',
    options: Array.from({ length: 12 }, (_, i) => `${i + 1}`),
    show: (a) => a.retireExtended === 'نعم'
  },
  {
    key: 'hireHijriDay',
    text: 'اختر يوم التعيين (هجري):',
    type: 'select',
    options: Array.from({ length: 30 }, (_, i) => `${i + 1}`),
    show: (a) => a.retireExtended === 'نعم'
  }
];

// ✅ سن التقاعد حسب الرتبة العسكرية
function getRetireAgeByRank(rank) {
  const map = {
    "جندي": 44, "جندي أول": 44, "عريف": 46, "وكيل رقيب": 46,
    "رقيب": 48, "رقيب أول": 50, "رئيس رقباء": 52,
    "ملازم": 48, "ملازم أول": 50, "نقيب": 52, "رائد": 54,
    "مقدم": 56, "عقيد": 58, "عميد": 60, "لواء": 60
  };
  return map[rank] || 60;
}
</script><script>
// ✅ أسئلة الالتزامات المتكررة
const commitmentQuestions = [
  {
    key: 'type',
    text: 'ما نوع الالتزام؟',
    type: 'select',
    options: ['قرض سيارة', 'قرض استهلاكي', 'بطاقة ائتمانية', 'أخرى'],
    show: () => true
  },
  {
    key: 'monthly',
    text: 'كم قيمة القسط الشهري؟',
    type: 'input',
    placeholder: 'مثال: 1500',
    show: () => true
  },
  {
    key: 'months',
    text: 'كم عدد الأشهر المتبقية؟',
    type: 'select',
    options: Array.from({ length: 60 }, (_, i) => `${i + 1}`),
    show: () => true
  },
  {
    key: 'hasFinal',
    text: 'هل لديك دفعة أخيرة؟',
    type: 'select',
    options: ['نعم', 'لا'],
    show: (a) => a.type === 'قرض سيارة'
  },
  {
    key: 'finalAmount',
    text: 'كم مبلغ الدفعة الأخيرة؟',
    type: 'input',
    placeholder: 'مثال: 45000',
    show: (a) => a.type === 'قرض سيارة' && a.hasFinal === 'نعم'
  },
  {
    key: 'another',
    text: 'هل لديك التزام آخر؟',
    type: 'select',
    options: ['نعم', 'لا'],
    show: () => true
  }
];
</script><!-- ✅ الجزء الخامس: النتيجة النهائية النهائية بالشكل الكامل والتنسيق المطابق للصورة -->
<div id="resultContainer" style="display:none; text-align:center; direction:rtl; margin-top:30px; font-size:32px;">
  <h3 style="margin-bottom: 0;">نتيجة الحسبة <span style="color:#666;">(التقريبية):</span></h3>
  <div id="greeting" style="color:#007bff; font-weight:bold;">مرحباً ومسهلاً يا <span id="clientNameResult"></span></div>
  <div style="margin: 20px 0;">
    <span id="financeDuration"></span>
  </div>
  <div id="retirementSalaryLine" style="margin-bottom: 20px; display:none;">
    <strong>الراتب التقاعدي المحتسب هو:</strong> <span id="retirementSalaryAmount" style="color:#000;">--</span> ريال
  </div>
  <div id="installmentsDetails" style="margin-bottom: 25px;"></div>

  <div style="color:green; font-weight:bold;">
    التمويل الصافي بعد خصم الرسوم النهائية:
    <span id="netFinanceAfterFees" style="font-size:36px;"></span> ريال
  </div>

  <div style="margin: 15px 0;">
    دعم حكومي مضاف:
    <span id="govSupport" style="color:#000; font-weight:600;"></span> ريال
  </div>

  <div style="color:green; margin-bottom: 20px;">
    التمويل الصافي قبل خصم الرسوم:
    <span id="netFinanceBeforeFees"></span> ريال
  </div>

  <div style="color:red; margin-bottom: 8px;">
    الربح دون الرسوم:
    <span id="profitWithoutFees"></span> ريال
  </div>

  <div style="color:red; margin-bottom: 15px;">
    الربح مع الرسوم:
    <span id="profitWithFees" style="font-size:28px;"></span> ريال
  </div>

  <div style="text-align:right; padding: 0 30px; font-size:28px;">
    <div>معامل الربح: <span id="profitRate"></span></div>
    <div>الرسوم الإدارية: <span id="adminFees"></span> ريال</div>
    <div>ضريبة الرسوم: <span id="vatFees"></span> ريال</div>
    <div>إجمالي التمويل مع الأرباح: <span id="totalWithProfit"></span> ريال</div>
    <div>بالأرقام: <span id="netFinanceAfterFeesText" style="font-weight:600;"></span></div>
  </div>

  <div style="margin:30px 0; font-size:28px;">
    خذ لقطة شاشة وتواصل معنا: <br/>
    <strong>📞 0506214458</strong><br/>
    زوروا موقعنا: <strong>hlooleqrr.com</strong>
  </div>

  <div id="resetButtonContainer" style="display:block; margin-bottom: 20px;">
    <button onclick="resetCalc()" style="background:#e8f1fd; color:#007bff; border:none; padding:10px 20px; font-size:28px; border-radius:8px; cursor:pointer;">
      🔁 إعادة الحسبة
    </button>
  </div>

  <footer style="font-size:24px; margin-top: 30px; color:#444;">
    <div id="datetimeFooter">جميع الحقوق محفوظة - سرعة تملك العقار والحلول التمويلية</div>
  </footer>
</div>

<script>
function updateDateTime() {
  const now = new Date();
  const h = String(now.getHours()).padStart(2, '0');
  const m = String(now.getMinutes()).padStart(2, '0');
  const s = String(now.getSeconds()).padStart(2, '0');
  const d = String(now.getDate()).padStart(2, '0');
  const mo = String(now.getMonth() + 1).padStart(2, '0');
  const y = now.getFullYear();
  const hijri = new Intl.DateTimeFormat('ar-TN-u-ca-islamic', { year: 'numeric', month: '2-digit', day: '2-digit' }).format(now);
  document.getElementById("datetimeFooter").innerText =
    `جميع الحقوق محفوظة - سرعة تملك العقار والحلول التمويلية - التاريخ الهجري: ${hijri} - الميلادي: ${y}-${mo}-${d} - الوقت: ${h}:${m}:${s}`;
}
setInterval(updateDateTime, 1000); updateDateTime();
</script><script>
function handleStartOrReset() {
  if (!hasStarted) {
    hasStarted = true;
    document.getElementById('mainButton').style.display = 'none';
    document.getElementById('resetButtonContainer').style.display = 'block';
    showQuestion();
  } else {
    resetCalc();
  }
}

function resetCalc() {
  answers = { commitments: [] };
  step = commitmentStep = 0;
  currentCommitment = {};
  hasStarted = true;
  document.getElementById('mainButton').style.display = 'none';
  document.getElementById('resetButtonContainer').style.display = 'block';
  document.getElementById('resultContainer').style.display = 'none';
  showQuestion();
}

function showQuestion() {
  const container = document.getElementById('question');
  container.innerHTML = '';
  document.getElementById('nextContainer').style.display = 'block';
  let q;
  if (step < generalQuestions.length) {
    q = generalQuestions[step];
    if (q.show && !q.show(answers)) {
      step++;
      showQuestion();
      return;
    }
  } else if (answers.hasCommitments === 'نعم') {
    q = commitmentQuestions[commitmentStep];
    if (q.show && !q.show(currentCommitment)) {
      commitmentStep++;
      showQuestion();
      return;
    }
  } else {
    calculateResult();
    return;
  }

  const label = document.createElement('label');
  label.innerText = q.text;
  container.appendChild(label);

  if (q.type === 'input') {
    const input = document.createElement('input');
    input.placeholder = q.placeholder || '';
    input.type = 'text';
    input.oninput = (e) => {
      if (step < generalQuestions.length) answers[q.key] = e.target.value;
      else currentCommitment[q.key] = e.target.value;
    };
    container.appendChild(input);
  } else if (q.type === 'select') {
    const select = document.createElement('select');
    q.options.forEach(opt => {
      const option = document.createElement('option');
      option.value = opt;
      option.innerText = opt;
      select.appendChild(option);
    });
    select.onchange = (e) => {
      if (step < generalQuestions.length) answers[q.key] = e.target.value;
      else currentCommitment[q.key] = e.target.value;
    };
    container.appendChild(select);
  }
}

function nextQuestion() {
  if (step < generalQuestions.length) {
    step++;
  } else if (answers.hasCommitments === 'نعم') {
    const current = commitmentQuestions[commitmentStep];
    if (current.key === 'another' && currentCommitment.another === 'لا') {
      answers.commitments.push(currentCommitment);
      answers.hasCommitments = 'لا';
      calculateResult();
      return;
    } else if (current.key === 'another' && currentCommitment.another === 'نعم') {
      answers.commitments.push(currentCommitment);
      currentCommitment = {};
      commitmentStep = 0;
      showQuestion();
      return;
    }
    commitmentStep++;
  }
  showQuestion();
}
</script>