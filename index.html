<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</title>
  <style>
    body { font-family: 'Tajawal', sans-serif; background: #f4f6f8; margin: 0; text-align: center; font-size: 32px; }
    header { background: #005c48; color: #fff; padding: 25px; font-size: 34px; }
    .container { max-width: 650px; margin: 25px auto; background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,.1); }
    input, select, button { width: 92%; padding: 20px; margin: 18px 0; font-size: 32px; border-radius: 5px; border: 1px solid #ccc; }
    #resultContainer { display:none; text-align: center; margin-top: 30px; font-size: 32px; }
    #resetButton { display:none; margin-top:20px; }
    .sliderValue { font-weight:bold; }
  </style>
</head>
<body>
  <header>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</header>
  <div class="container" id="formContainer">
    <button id="startButton">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø¨Ø©</button>
    <div id="question" style="display:none;"></div>
    <div id="nextContainer" style="display:none;">
      <button id="nextButton">Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>
  </div>

  <div class="container" id="resultContainer">
    <h3>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø¨Ø©:</h3>
    <div id="greeting"></div>
    <div id="retirementInfo"></div>
    <div id="financeInfo"></div>
    <div id="breakdown"></div>
    <button id="resetButton">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø©</button>
  </div>

  <script>
    const basicSalaryMap = {
      "Ø¬Ù†Ø¯ÙŠ": 3220, "Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„": 3395, "Ø¹Ø±ÙŠÙ": 3765, "ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨": 4455,
      "Ø±Ù‚ÙŠØ¨": 5260, "Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„": 6180, "Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡": 7215,
      "Ù…Ù„Ø§Ø²Ù…": 7590, "Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„": 8835, "Ù†Ù‚ÙŠØ¨": 10600, "Ø±Ø§Ø¦Ø¯": 13515,
      "Ù…Ù‚Ø¯Ù…": 14645, "Ø¹Ù‚ÙŠØ¯": 16500, "Ø¹Ù…ÙŠØ¯": 18805, "Ù„ÙˆØ§Ø¡": 21000, "ÙØ±ÙŠÙ‚": 22000
    };
    const allowanceMap = {
      "Ø¬Ù†Ø¯ÙŠ": 130, "Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„": 145, "Ø¹Ø±ÙŠÙ": 175, "ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨": 200,
      "Ø±Ù‚ÙŠØ¨": 250, "Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„": 280, "Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡": 330,
      "Ù…Ù„Ø§Ø²Ù…": 380, "Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„": 440, "Ù†Ù‚ÙŠØ¨": 490, "Ø±Ø§Ø¦Ø¯": 540,
      "Ù…Ù‚Ø¯Ù…": 615, "Ø¹Ù‚ÙŠØ¯": 670, "Ø¹Ù…ÙŠØ¯": 725, "Ù„ÙˆØ§Ø¡": 780, "ÙØ±ÙŠÙ‚": 830
    };
    const retireAgeMap = {
      "Ø¬Ù†Ø¯ÙŠ":44,"Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„":44,"Ø¹Ø±ÙŠÙ":46,"ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨":48,
      "Ø±Ù‚ÙŠØ¨":50,"Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„":50,"Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡":52,
      "Ù…Ù„Ø§Ø²Ù…":44,"Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„":44,"Ù†Ù‚ÙŠØ¨":48,"Ø±Ø§Ø¦Ø¯":50,
      "Ù…Ù‚Ø¯Ù…":52,"Ø¹Ù‚ÙŠØ¯":54,"Ø¹Ù…ÙŠØ¯":56,"Ù„ÙˆØ§Ø¡":58,"ÙØ±ÙŠÙ‚":60
    };

    let step = 0, answers = {};

    document.getElementById('startButton').onclick = startCalc;
    document.getElementById('nextButton').onclick  = nextStep;
    document.getElementById('resetButton').onclick = resetCalc;

    function startCalc() {
      document.getElementById('startButton').style.display = 'none';
      document.getElementById('question').style.display  = 'block';
      document.getElementById('nextContainer').style.display = 'block';
      showStep();
    }

    function nextStep() {
      switch(step) {
        case 0: answers.name = document.getElementById('inputName').value.trim(); break;
        case 1:
          answers.today = {
            y:+document.getElementById('todayYear').value,
            m:+document.getElementById('todayMonth').value,
            d:+document.getElementById('todayDay').value
          }; break;
        case 2: answers.financeType = document.getElementById('financeType').value; break;
        case 3: answers.rank        = document.getElementById('rank').value; break;
        case 4:
          answers.appoint = {
            y:+document.getElementById('appointYear').value,
            m:+document.getElementById('appointMonth').value,
            d:+document.getElementById('appointDay').value
          }; break;
        case 5:
          answers.birth = {
            y:+document.getElementById('birthYear').value,
            m:+document.getElementById('birthMonth').value,
            d:+document.getElementById('birthDay').value
          }; break;
        case 6: answers.margin  = parseFloat(document.getElementById('profitMargin').value); break;
        case 7: answers.payment = parseFloat(document.getElementById('paymentAmount').value); break;
        case 8: answers.duration= +document.getElementById('duration').value; break;
      }
      step++;
      if (step <= 8) showStep();
      else showResult();
    }

    function showStep() {
      const q = document.getElementById('question');
      q.innerHTML = '';
      document.getElementById('nextButton').style.display = 'inline-block';
      switch(step) {
        case 0:
          q.innerHTML = `<input type="text" id="inputName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…">`;
          break;
        case 1:
          q.innerHTML = `
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… (Ù‡Ø¬Ø±ÙŠ):</label><br>
            <select id="todayDay">${[...Array(30)].map((_,i)=>`<option>${i+1}</option>`).join('')}</select>
            <select id="todayMonth">${[...Array(12)].map((_,i)=>`<option>${i+1}</option>`).join('')}</select>
            <select id="todayYear">${[...Array(80)].map((_,i)=>`<option>${1370+i}</option>`).join('')}</select>`;
          break;
        case 2:
          q.innerHTML = `
            <select id="financeType">
              <option value="Ø¹Ù‚Ø§Ø±ÙŠ">ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option>
              <option value="Ø´Ø®ØµÙŠ">ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ</option>
            </select>`;
          break;
        case 3:
          q.innerHTML = `
            <select id="rank">
              ${Object.keys(basicSalaryMap).map(r=>`<option>${r}</option>`).join('')}
            </select>`;
          break;
        case 4:
          q.innerHTML = `
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† (Ù‡Ø¬Ø±ÙŠ):</label><br>
            <select id="appointDay">${[...Array(30)].map((_,i)=>`<option>${i+1}</option>`).join('')}</select>
            <select id="appointMonth">${[...Array(12)].map((_,i)=>`<option>${i+1}</option>`).join('')}</select>
            <select id="appointYear">${[...Array(80)].map((_,i)=>`<option>${1370+i}</option>`).join('')}</select>`;
          break;
        case 5:
          q.innerHTML = `
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (Ù‡Ø¬Ø±ÙŠ):</label><br>
            <select id="birthDay">${[...Array(30)].map((_,i)=>`<option>${i+1}</option>`).join('')}</select>
            <select id="birthMonth">${[...Array(12)].map((_,i)=>`<option>${i+1}</option>`).join('')}</select>
            <select id="birthYear">${[...Array(80)].map((_,i)=>`<option>${1370+i}</option>`).join('')}</select>`;
          break;
        case 6:
          q.innerHTML = `<input type="number" id="profitMargin" placeholder="Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ (%)">`;
          break;
        case 7:
          q.innerHTML = `<input type="number" id="paymentAmount" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø©">`;
          break;
        case 8:
          const retireAge   = retireAgeMap[answers.rank];
          const availMonths = Math.max((60 - retireAge) * 12, 0);
          q.innerHTML = `
            <label>Ø§Ø®ØªØ± Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (Ø¨Ø§Ù„Ø´Ù‡ÙˆØ± Ø­ØªÙ‰ ${availMonths}):</label><br>
            <input type="range" id="duration" min="1" max="${availMonths}" value="${availMonths}" oninput="this.nextElementSibling.textContent=this.value">
            <span class="sliderValue">${availMonths}</span>`;
          break;
      }
      document.getElementById('nextButton').textContent = step < 8 ? 'Ø§Ù„ØªØ§Ù„ÙŠ' : 'Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©';
    }

    function showResult() {
      document.getElementById('formContainer').style.display = 'none';

      // Ø­Ø³Ø§Ø¨ Ù…Ø¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯
      const retireAge   = retireAgeMap[answers.rank];
      const retireYear  = answers.birth.y + retireAge;
      const retireMonth = answers.birth.m;
      const serviceMonths = (retireYear - answers.appoint.y) * 12 +
                            (retireMonth - answers.appoint.m);

      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ÙŠ
      const sal       = basicSalaryMap[answers.rank];
      const allowance = allowanceMap[answers.rank] || 0;
      const gross     = sal + allowance;
      const pension   = gross * serviceMonths / 420;

      // Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„ØªÙ…ÙˆÙŠÙ„ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø­ØªÙ‰ 60 Ø³Ù†Ø©
      const availMonths = Math.max((60 - retireAge) * 12, 0);

      // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ…ÙˆÙŠÙ„
      const ratio           = answers.financeType === 'Ø¹Ù‚Ø§Ø±ÙŠ' ? 0.55 : 0.25;
      const monthlyCap      = pension * ratio;
      const totalWithProfit = monthlyCap * answers.duration;
      const factor          = (answers.duration/12) * (answers.margin/100) + 1;
      const net             = totalWithProfit / factor;
      const profit          = totalWithProfit - net;
      const netWithPay      = net + answers.payment;

      // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      document.getElementById('greeting').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙˆÙ…Ø³Ù‡Ù„Ø§Ù‹ ÙŠØ§ ${answers.name}`;
      document.getElementById('retirementInfo').innerHTML = `
        <strong>Ø§Ù„Ø¹Ù„Ø§ÙˆØ© Ø§Ù„Ø¯ÙˆØ±ÙŠØ©:</strong> ${allowance} Ø±ÙŠØ§Ù„<br>
        <strong>Ù…Ø¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø­ØªÙ‰ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ (${retireAge} Ø³Ù†Ø©):</strong> ${serviceMonths} Ø´Ù‡Ø±Ø§Ù‹<br>
        <strong>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ÙŠ Ø§Ù„Ù…Ø­ØªØ³Ø¨:</strong> ${pension.toFixed(2)} Ø±ÙŠØ§Ù„`;
      document.getElementById('financeInfo').innerHTML = `
        <strong>Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯:</strong> ${availMonths} Ø´Ù‡Ø±Ø§Ù‹<br>
        <strong>Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„:</strong> ${answers.financeType}<br>
        <strong>Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</strong> ${answers.duration} Ø´Ù‡Ø±Ø§Ù‹<br>
        <strong>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù‚Ø³Ø· (${ratio*100}%):</strong> ${monthlyCap.toFixed(2)} Ø±ÙŠØ§Ù„`;
      document.getElementById('breakdown').innerHTML = `
        <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</strong> ${totalWithProfit.toFixed(2)} Ø±ÙŠØ§Ù„<br>
        <strong>Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­:</strong> ${factor.toFixed(3)}<br>
        <strong>Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Ø³Ù…Ø©:</strong> ${net.toFixed(2)} Ø±ÙŠØ§Ù„<br>
        <strong>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</strong> ${profit.toFixed(2)} Ø±ÙŠØ§Ù„<br>
        <strong>Ø§Ù„ØµØ§ÙÙŠ Ù…Ø¹ Ø§Ù„Ø¯ÙØ¹Ø©:</strong> ${netWithPay.toFixed(2)} Ø±ÙŠØ§Ù„`;
      document.getElementById('resultContainer').style.display = 'block';
      document.getElementById('resetButton').style.display   = 'inline-block';
    }

    function resetCalc() {
      step = 0; answers = {};
      document.getElementById('resultContainer').style.display = 'none';
      document.getElementById('formContainer').style.display   = 'block';
      document.getElementById('startButton').style.display     = 'inline-block';
      document.getElementById('question').style.display        = 'none';
      document.getElementById('nextContainer').style.display   = 'none';
    }
  </script>
</body>
</html>