<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <title>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: #eef2f5;
      margin: 0;
      text-align: center;
      font-size: 32px;
      color: #333;
    }
    header {
      background: #005c48;
      color: #fff;
      padding: 25px;
      font-size: 36px;
    }
    .container {
      max-width: 700px;
      margin: 30px auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
    input, select, button {
      font-family: inherit;
      font-size: 32px;
      margin: 20px 0;
    }
    .modern-input {
      width: 100%;
      padding: 18px;
      border: 2px solid #ccc;
      border-radius: 8px;
      transition: border-color .3s;
    }
    .modern-input:focus {
      border-color: #005c48;
      outline: none;
    }
    #startButton, #nextButton, #resetButton {
      background: #005c48;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 18px 30px;
      cursor: pointer;
      transition: background .3s;
    }
    #startButton:hover, #nextButton:hover, #resetButton:hover {
      background: #007b5a;
    }
    /* duration picker */
    #durationPicker {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 30px;
      margin: 30px 0;
    }
    #durationPicker button {
      width: 60px;
      height: 60px;
      font-size: 36px;
      border: none;
      border-radius: 50%;
      background: #005c48;
      color: #fff;
      cursor: pointer;
      transition: background .3s;
    }
    #durationPicker button:hover {
      background: #007b5a;
    }
    #durationValue {
      font-size: 48px;
      font-weight: bold;
      width: 140px;
    }
    /* result styling */
    #resultContainer {
      display: none;
      text-align: right;
    }
    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
      gap: 20px;
      margin-top: 30px;
    }
    .result-card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.05);
      text-align: right;
    }
    .result-card h4 {
      margin: 0 0 10px;
      color: #005c48;
    }
    .result-value {
      font-size: 36px;
      font-weight: bold;
      margin-top: 5px;
      color: #333;
    }
  </style>
</head>
<body>
  <header>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</header>

  <div class="container" id="formContainer">
    <button id="startButton">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø¨Ø©</button>
    <div id="question" style="display:none;"></div>
    <div id="nextContainer" style="display:none;">
      <button id="nextButton">Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>
  </div>

  <div class="container" id="resultContainer">
    <h3>Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø­Ø³Ø¨Ø©:</h3>
    <div id="greeting"></div>
    <div class="result-grid">
      <div class="result-card">
        <h4>Ù…Ø¯Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø­ØªÙ‰ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯</h4>
        <div id="serviceMonths" class="result-value"></div>
      </div>
      <div class="result-card">
        <h4>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ÙŠ</h4>
        <div id="pension" class="result-value"></div>
      </div>
      <div class="result-card">
        <h4>Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</h4>
        <div id="chosenDuration" class="result-value"></div>
      </div>
      <div class="result-card">
        <h4>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</h4>
        <div id="monthlyCap" class="result-value"></div>
      </div>
      <div class="result-card">
        <h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h4>
        <div id="totalWithProfit" class="result-value"></div>
      </div>
      <div class="result-card">
        <h4>Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Ø³Ù…Ø©</h4>
        <div id="net" class="result-value"></div>
      </div>
      <div class="result-card">
        <h4>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h4>
        <div id="profit" class="result-value"></div>
      </div>
      <div class="result-card">
        <h4>Ø§Ù„ØµØ§ÙÙŠ Ù…Ø¹ Ø§Ù„Ø¯ÙØ¹Ø©</h4>
        <div id="netWithPay" class="result-value"></div>
      </div>
    </div>
    <button id="resetButton">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø©</button>
  </div>

  <script>
    const basicSalaryMap = {
      "Ø¬Ù†Ø¯ÙŠ": 3220, "Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„": 3395, "Ø¹Ø±ÙŠÙ": 3765, "ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨": 4455,
      "Ø±Ù‚ÙŠØ¨": 5260, "Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„": 6180, "Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡": 7215,
      "Ù…Ù„Ø§Ø²Ù…": 7590, "Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„": 8835, "Ù†Ù‚ÙŠØ¨": 10600, "Ø±Ø§Ø¦Ø¯": 13515,
      "Ù…Ù‚Ø¯Ù…": 14645, "Ø¹Ù‚ÙŠØ¯": 16500, "Ø¹Ù…ÙŠØ¯": 18805, "Ù„ÙˆØ§Ø¡": 21000, "ÙØ±ÙŠÙ‚": 22000
    };
    const allowanceMap = {
      "Ø¬Ù†Ø¯ÙŠ": 130, "Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„": 145, "Ø¹Ø±ÙŠÙ": 175, "ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨": 200,
      "Ø±Ù‚ÙŠØ¨": 250, "Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„": 280, "Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡": 330,
      "Ù…Ù„Ø§Ø²Ù…": 380, "Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„": 440, "Ù†Ù‚ÙŠØ¨": 490, "Ø±Ø§Ø¦Ø¯": 540,
      "Ù…Ù‚Ø¯Ù…": 615, "Ø¹Ù‚ÙŠØ¯": 670, "Ø¹Ù…ÙŠØ¯": 725, "Ù„ÙˆØ§Ø¡": 780, "ÙØ±ÙŠÙ‚": 830
    };
    const retireAgeMap = {
      "Ø¬Ù†Ø¯ÙŠ":44,"Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„":44,"Ø¹Ø±ÙŠÙ":46,"ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨":48,
      "Ø±Ù‚ÙŠØ¨":50,"Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„":50,"Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡":52,
      "Ù…Ù„Ø§Ø²Ù…":44,"Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„":44,"Ù†Ù‚ÙŠØ¨":48,"Ø±Ø§Ø¦Ø¯":50,
      "Ù…Ù‚Ø¯Ù…":52,"Ø¹Ù‚ÙŠØ¯":54,"Ø¹Ù…ÙŠØ¯":56,"Ù„ÙˆØ§Ø¡":58,"ÙØ±ÙŠÙ‚":60
    };
    let step = 0, answers = {}, maxDuration = 0;

    const startBtn = document.getElementById('startButton');
    const nextBtn  = document.getElementById('nextButton');
    const resetBtn = document.getElementById('resetButton');

    startBtn.onclick = startCalc;
    nextBtn.onclick  = nextStep;
    resetBtn.onclick = resetCalc;

    function startCalc() {
      startBtn.style.display = 'none';
      document.getElementById('question').style.display = 'block';
      document.getElementById('nextContainer').style.display = 'block';
      showStep();
    }

    function nextStep() {
      switch(step) {
        case 0: answers.name    = document.getElementById('inputName').value.trim();              break;
        case 1:
          answers.today        = { y:+d('todayYear'), m:+d('todayMonth'), d:+d('todayDay') };    break;
        case 2: answers.financeType= d('financeType');                                            break;
        case 3: answers.rank    = d('rank');                                                      break;
        case 4:
          answers.appoint      = { y:+d('appointYear'), m:+d('appointMonth'), d:+d('appointDay') }; break;
        case 5:
          answers.birth        = { y:+d('birthYear'), m:+d('birthMonth'), d:+d('birthDay') };     break;
        case 6: answers.margin  = parseFloat(d('profitMargin'));                                   break;
        case 7: answers.payment = parseFloat(d('paymentAmount'));                                  break;
        case 8: answers.duration= +document.getElementById('durationValue').textContent;           break;
      }
      step++;
      if (step <= 8) showStep();
      else showResult();
    }

    function showStep() {
      const q = document.getElementById('question');
      q.innerHTML = '';
      nextBtn.style.display = 'inline-block';
      switch(step) {
        case 0:
          q.innerHTML = `<input class="modern-input" type="text" id="inputName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…">`;
          break;
        case 1:
          q.innerHTML = `
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… (Ù‡Ø¬Ø±ÙŠ):</label><br>
            <select class="modern-input" id="todayDay">${opts(1,30)}</select>
            <select class="modern-input" id="todayMonth">${opts(1,12)}</select>
            <select class="modern-input" id="todayYear">${opts(1430,1460)}</select>`;
          break;
        case 2:
          q.innerHTML = `
            <select class="modern-input" id="financeType">
              <option value="Ø¹Ù‚Ø§Ø±ÙŠ">ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ</option>
              <option value="Ø´Ø®ØµÙŠ">ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ</option>
            </select>`;
          break;
        case 3:
          q.innerHTML = `
            <select class="modern-input" id="rank">
              ${Object.keys(basicSalaryMap).map(r=>`<option>${r}</option>`).join('')}
            </select>`;
          break;
        case 4:
          q.innerHTML = `
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† (Ù‡Ø¬Ø±ÙŠ):</label><br>
            <select class="modern-input" id="appointDay">${opts(1,30)}</select>
            <select class="modern-input" id="appointMonth">${opts(1,12)}</select>
            <select class="modern-input" id="appointYear">${opts(1370,1430)}</select>`;
          break;
        case 5:
          q.innerHTML = `
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (Ù‡Ø¬Ø±ÙŠ):</label><br>
            <select class="modern-input" id="birthDay">${opts(1,30)}</select>
            <select class="modern-input" id="birthMonth">${opts(1,12)}</select>
            <select class="modern-input" id="birthYear">${opts(1370,1430)}</select>`;
          break;
        case 6:
          q.innerHTML = `<input class="modern-input" type="number" id="profitMargin" placeholder="Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ (%)">`;
          break;
        case 7:
          q.innerHTML = `<input class="modern-input" type="number" id="paymentAmount" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø©">`;
          break;
        case 8:
          const retireAge = retireAgeMap[answers.rank];
          maxDuration = Math.max((60 - retireAge) * 12, 0);
          q.innerHTML = `
            <label>Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (Ø¨Ø§Ù„Ø´Ù‡ÙˆØ± Ø­ØªÙ‰ ${maxDuration}):</label>
            <div id="durationPicker">
              <button id="durationMinus">âˆ’</button>
              <div id="durationValue">${maxDuration}</div>
              <button id="durationPlus">+</button>
            </div>`;
          document.getElementById('durationMinus').onclick = ()=>{
            let v=+document.getElementById('durationValue').textContent;
            if(v>1) document.getElementById('durationValue').textContent= v-1;
          };
          document.getElementById('durationPlus').onclick = ()=>{
            let v=+document.getElementById('durationValue').textContent;
            if(v<maxDuration) document.getElementById('durationValue').textContent= v+1;
          };
          break;
      }
      nextBtn.textContent = step < 8 ? 'Ø§Ù„ØªØ§Ù„ÙŠ' : 'Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©';
    }

    function showResult() {
      document.getElementById('formContainer').style.display   = 'none';
      const retireAge = retireAgeMap[answers.rank];
      const retireYear= answers.birth.y + retireAge;
      const retireMonth= answers.birth.m;
      const serviceMonths = (retireYear - answers.appoint.y) * 12 + (retireMonth - answers.appoint.m);

      const sal       = basicSalaryMap[answers.rank];
      const allowance = allowanceMap[answers.rank] || 0;
      const gross     = sal + allowance;
      const pension   = gross * serviceMonths / 420;

      const ratio          = answers.financeType==='Ø¹Ù‚Ø§Ø±ÙŠ'? 0.55 : 0.25;
      const monthlyCap     = pension * ratio;
      const totalWithProfit= monthlyCap * answers.duration;
      const factor         = (answers.duration/12)*(answers.margin/100) + 1;
      const net            = totalWithProfit / factor;
      const profit         = totalWithProfit - net;
      const netWithPay     = net + answers.payment;

      document.getElementById('greeting').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙˆÙ…Ø³Ù‡Ù„Ø§Ù‹ ÙŠØ§ ${answers.name}`;
      document.getElementById('serviceMonths').textContent    = serviceMonths + ' Ø´Ù‡Ø±';
      document.getElementById('pension').textContent          = pension.toFixed(2) + ' Ø±ÙŠØ§Ù„';
      document.getElementById('chosenDuration').textContent   = answers.duration + ' Ø´Ù‡Ø±';
      document.getElementById('monthlyCap').textContent       = monthlyCap.toFixed(2) + ' Ø±ÙŠØ§Ù„';
      document.getElementById('totalWithProfit').textContent  = totalWithProfit.toFixed(2) + ' Ø±ÙŠØ§Ù„';
      document.getElementById('net').textContent              = net.toFixed(2) + ' Ø±ÙŠØ§Ù„';
      document.getElementById('profit').textContent           = profit.toFixed(2) + ' Ø±ÙŠØ§Ù„';
      document.getElementById('netWithPay').textContent       = netWithPay.toFixed(2) + ' Ø±ÙŠØ§Ù„';

      document.getElementById('resultContainer').style.display = 'block';
      resetBtn.style.display = 'inline-block';
    }

    function resetCalc() {
      step = 0; answers = {};
      document.getElementById('resultContainer').style.display = 'none';
      document.getElementById('formContainer')  .style.display = 'block';
      document.getElementById('startButton')    .style.display = 'inline-block';
      document.getElementById('question')       .style.display = 'none';
      document.getElementById('nextContainer')  .style.display = 'none';
    }

    function d(id){ return document.getElementById(id).value; }
    function opts(start, end){
      let html = '';
      for(let v = start; v <= end; v++){
        html += `<option>${v.toString().padStart(2,'0')}</option>`;
      }
      return html;
    }
  </script>
</body>
</html>