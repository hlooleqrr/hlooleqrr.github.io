<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>حاسبة التمويل بعد التقاعد</title>
  <style>
    body { font-family: 'Tajawal', sans-serif; background: #f4f6f8; padding: 20px; text-align: center; font-size: 20px; }
    .box { max-width: 650px; margin: auto; background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    input, select, button { width: 90%; padding: 15px; margin: 12px 0; font-size: 20px; border-radius: 6px; }
    .result { background: #e1f5fe; border: 2px solid #29b6f6; padding: 20px; margin-top: 20px; border-radius: 10px; }
    .error { background: #ffebee; color: #b71c1c; padding: 20px; margin-top: 20px; border-radius: 10px; border: 2px solid #ef5350; }
  </style>
</head>
<body>

<div class="box">
  <h2>حاسبة التمويل بعد التقاعد</h2>

  <input id="name" placeholder="الاسم الكريم">

  <h4>تاريخ اليوم (هجري)</h4>
  <select id="todayDay"></select><select id="todayMonth"></select><select id="todayYear"></select>

  <h4>تاريخ الميلاد (هجري)</h4>
  <select id="birthDay"></select><select id="birthMonth"></select><select id="birthYear"></select>

  <h4>تاريخ التعيين (هجري)</h4>
  <select id="hireDay"></select><select id="hireMonth"></select><select id="hireYear"></select>

  <h4>رتبتك العسكرية</h4>
  <select id="rank">
    <option disabled selected>اختر الرتبة</option>
    <option>جندي</option><option>جندي أول</option><option>عريف</option><option>وكيل رقيب</option>
    <option>رقيب</option><option>رقيب أول</option><option>رئيس رقباء</option>
    <option>ملازم</option><option>ملازم أول</option><option>نقيب</option><option>رائد</option>
    <option>مقدم</option><option>عقيد</option><option>عميد</option><option>لواء</option>
  </select>

  <h4>نوع التمويل</h4>
  <select id="financeType">
    <option disabled selected>اختر نوع التمويل</option>
    <option value="person">تمويل شخصي</option>
    <option value="realestate">تمويل عقاري</option>
  </select>

  <h4>نسبة هامش الربح (%)</h4>
  <input type="number" id="profit" placeholder="مثال: 5">

  <button onclick="calculate()">عرض النتيجة</button>

  <div id="result" style="display:none;"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hijri-date/lib/hijri-date.min.js"></script>
<script>
  function fill(id, start, end) {
    const el = document.getElementById(id);
    for (let i = start; i <= end; i++) {
      const op = document.createElement("option");
      op.value = i; op.text = i;
      el.appendChild(op);
    }
  }

  ['todayDay','birthDay','hireDay'].forEach(id => fill(id,1,30));
  ['todayMonth','birthMonth','hireMonth'].forEach(id => fill(id,1,12));
  ['todayYear','birthYear','hireYear'].forEach(id => fill(id,1370,1450));

  const retirementAges = {
    "جندي":44, "جندي أول":44, "عريف":46, "وكيل رقيب":46, "رقيب":48, "رقيب أول":50,
    "رئيس رقباء":52, "ملازم":48, "ملازم أول":50, "نقيب":52, "رائد":54, "مقدم":56,
    "عقيد":58, "عميد":60, "لواء":60
  };

  const baseSal = {
    "جندي":3220,"جندي أول":3395,"عريف":3765,"وكيل رقيب":4455,"رقيب":5260,"رقيب أول":6180,
    "رئيس رقباء":7215,"ملازم":7590,"ملازم أول":8365,"نقيب":9215,"رائد":11735,"مقدم":12735,
    "عقيد":14365,"عميد":16350,"لواء":18600
  };

  const raises = {
    "جندي":130,"جندي أول":145,"عريف":175,"وكيل رقيب":250,"رقيب":300,"رقيب أول":360,
    "رئيس رقباء":360,"ملازم":380,"ملازم أول":440,"نقيب":495,"رائد":265,"مقدم":470,
    "عقيد":590,"عميد":650,"لواء":730
  };

  function calculate(){
    const name = document.getElementById('name').value.trim();
    const rank = document.getElementById('rank').value;
    const financeType = document.getElementById('financeType').value;
    const profitRate = parseFloat(document.getElementById('profit').value) / 100;

    const tY = +document.getElementById('todayYear').value, tM = +document.getElementById('todayMonth').value -1, tD = +document.getElementById('todayDay').value;
    const bY = +document.getElementById('birthYear').value, bM = +document.getElementById('birthMonth').value -1, bD = +document.getElementById('birthDay').value;
    const hY = +document.getElementById('hireYear').value, hM = +document.getElementById('hireMonth').value -1, hD = +document.getElementById('hireDay').value;

    if (!name || !rank || !financeType || isNaN(profitRate)) return alert("يرجى تعبئة جميع الحقول");

    const today = new HijriDate(tY, tM, tD);
    const birth = new HijriDate(bY, bM, bD);
    const hire = new HijriDate(hY, hM, hD);

    let age = tY - bY;
    if (tM < bM || (tM === bM && tD < bD)) age--;

    const retireAge = retirementAges[rank] || 60;
    const retireYear = bY + retireAge;
    const monthsToRetire = (retireYear - tY) * 12;

    const maxMonths = (60 - retireAge) * 12;

    let service = tY - hY;
    if (tM < hM || (tM === hM && tD < hD)) service--;

    const base = baseSal[rank];
    const raise = raises[rank];
    const finalBase = base + (raise * service);

    const retirementSalary = (finalBase * service) / 40;

    let installment;
    if (financeType === 'person') {
      installment = retirementSalary * 0.25;
    } else {
      installment = retirementSalary < 15000 ? retirementSalary * 0.55 : retirementSalary * 0.65;
    }

    const totalPayment = installment * maxMonths;
    const profit = totalPayment * profitRate;
    const netFinance = totalPayment - profit;

    const f = n => parseFloat(n).toLocaleString('ar-EG');
    const res = document.getElementById('result');
    res.style.display = 'block';

    if (netFinance < 1000) {
      res.innerHTML = `<div class="error">❌ نعتذر، لا يمكن تمويلك بناءً على هذه المعطيات.</div>`;
    } else {
      res.innerHTML = `
        <div class="result">
        <strong>مرحباً يا ${name}</strong><br><br>
        عمرك الآن: ${age} سنة<br>
        سنوات الخدمة: ${service} سنة<br>
        التقاعد بعد: ${monthsToRetire} شهر<br>
        عدد أشهر التمويل بعد التقاعد: ${maxMonths} شهر<br><br>
        الراتب التقاعدي المحتسب: <strong>${f(retirementSalary.toFixed(0))} ريال</strong><br>
        القسط الشهري المسموح: ${f(installment.toFixed(0))} ريال<br><br>
        إجمالي التمويل مع الربح: ${f(totalPayment.toFixed(0))} ريال<br>
        الربح: ${f(profit.toFixed(0))} ريال<br>
        التمويل الصافي بعد التقاعد: <strong>${f(netFinance.toFixed(0))} ريال</strong>
        </div>
      `;
    }
  }
</script>

</body>
</html>