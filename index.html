<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>حاسبة التمويل</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: #f4f6f8;
      margin: 0;
      text-align: center;
      font-size: 32px;
    }
    header {
      background: #005c48;
      color: #fff;
      padding: 25px;
      font-size: 34px;
    }
    .container {
      max-width: 650px;
      margin: 25px auto;
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,.1);
    }
    input, select, button {
      width: 92%;
      padding: 20px;
      margin: 18px 0;
      font-size: 32px;
      border-radius: 5px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    #mainButton {
      margin: 30px 0;
    }
    #resetButtonContainer {
      display: none;
      margin: 20px 0;
    }
    #resetButtonContainer button {
      background-color: #b8d1cc;
      color: #00352c;
      border: none;
      padding: 15px 30px;
      font-size: 30px;
      border-radius: 8px;
      cursor: pointer;
    }
    footer {
      margin-top: 40px;
      font-size: 22px;
      color: #666;
    }
  </style>
</head>
<body>
  <div style="font-size: 26px; margin-top: 20px; color: #005c48; font-weight: bold;">
    سرعة تملك العقار والحلول التمويلية
  </div>

  <header>حاسبة التمويل العقاري والشخصي</header>

  <div class="container">
    <div id="mainButton">
      <button onclick="handleStartOrReset()">ابدأ الحسبة</button>
    </div>
    <div id="resetButtonContainer">
      <button onclick="handleStartOrReset()">🔁 إعادة الحسبة</button>
    </div>
    <div id="question"></div>
    <div id="nextContainer" style="display:none;">
      <button onclick="next()">التالي</button>
    </div>
    <div id="result" style="display:none;"></div>
  </div>

  <footer>
    <p id="datetimeFooter">جميع الحقوق محفوظة - سرعة تملك العقار</p>
  </footer>
  <script>
    function updateDateTime() {
      const now = new Date();
      const gYear = now.getFullYear();
      const gMonth = (now.getMonth() + 1).toString().padStart(2, '0');
      const gDate = now.getDate().toString().padStart(2, '0');
      const hYear = 1446;
      const hMonth = '12';
      const hDay = '23';
      document.getElementById('datetimeFooter').innerText =
        `جميع الحقوق محفوظة - سرعة تملك العقار - التاريخ الهجري: ${hYear}/${hMonth}/${hDay} - الميلادي: ${gYear}/${gMonth}/${gDate}`;
    }
    setInterval(updateDateTime, 1000); updateDateTime();
  </script>
</body>
</html><script>
let answers = { commitments: [] };
let step = 0;
let commitmentStep = 0;
let currentCommitment = {};
let hasStarted = false;

function handleStartOrReset(){
  if(!hasStarted){
    hasStarted = true;
    document.getElementById('mainButton').style.display = 'none';
    document.getElementById('resetButtonContainer').style.display = 'block';
    showQuestion();
  } else {
    resetCalc();
  }
}

function resetCalc(){
  answers = { commitments: [] };
  step = commitmentStep = 0;
  currentCommitment = {};
  hasStarted = true;
  document.getElementById('mainButton').style.display = 'none';
  document.getElementById('resetButtonContainer').style.display = 'block';
  document.getElementById('result').style.display = 'none';
  showQuestion();
}

function showQuestion(){
  const cont = document.getElementById('question');
  cont.innerHTML = '';
  document.getElementById('nextContainer').style.display = 'block';
  let q;

  if(step < generalQuestions.length){
    q = generalQuestions[step];
    if(q.show && !q.show(answers)){
      step++;
      showQuestion();
      return;
    }
    cont.innerHTML = `<label>${q.question}</label><br/>`;
    if(q.type === 'select'){
      const select = document.createElement('select');
      for(const option of q.options){
        const opt = document.createElement('option');
        opt.value = option;
        opt.textContent = option;
        select.appendChild(opt);
      }
      select.value = q.default || '';
      select.onchange = (e) => answers[q.name] = e.target.value;
      cont.appendChild(select);
      answers[q.name] = select.value;
    } else if(q.type === 'text'){
      const input = document.createElement('input');
      input.type = 'text';
      input.oninput = (e) => answers[q.name] = e.target.value;
      cont.appendChild(input);
    }
  }
}

const generalQuestions = [
  {
    name: "clientName",
    question: "اسمك الكريم:",
    type: "text"
  },
  {
    name: "financeType",
    question: "اختر نوع التمويل تريد حسبته:",
    type: "select",
    options: ["تمويل شخصي أو تمويل استهلاكي", "تمويل عقاري"]
  },
  {
    name: "jobType",
    question: "ما نوع وظيفتك؟",
    type: "select",
    options: ["عسكري", "مدني", "خاص - شبه حكومي", "خاص - معتمد", "خاص - غير معتمد"]
  },
  {
    name: "birthHijriDay",
    question: "اختر تاريخ ميلادك (يوم هجري):",
    type: "select",
    options: Array.from({length: 30}, (_, i) => (i+1).toString().padStart(2, '0'))
  },
  {
    name: "birthHijriMonth",
    question: "اختر شهر الميلاد (هجري):",
    type: "select",
    options: Array.from({length: 12}, (_, i) => (i+1).toString().padStart(2, '0'))
  },
  {
    name: "birthHijriYear",
    question: "اختر سنة الميلاد (هجري):",
    type: "select",
    options: Array.from({length: 61}, (_, i) => (1370 + i).toString()).reverse(),
    default: "1412"
  }
];
</script><script>
// تابع للأسئلة بعد الميلاد والوظيفة
generalQuestions.push(
  {
    name: "rank",
    question: "اختر رتبتك العسكرية:",
    type: "select",
    options: [
      "جندي", "جندي أول", "عريف", "وكيل رقيب", "رقيب", "رقيب أول", "رئيس رقباء",
      "ملازم", "ملازم أول", "نقيب", "رائد", "مقدم", "عقيد", "عميد", "لواء"
    ],
    show: (a) => a.jobType === "عسكري"
  },
  {
    name: "wantsExtended",
    question: "هل ترغب بالحسبة بعد التقاعد؟",
    type: "select",
    options: ["نعم", "لا"],
    show: (a) => {
      if(a.jobType !== "عسكري" || a.financeType !== "تمويل عقاري") return false;
      const birthYear = parseInt(a.birthHijriYear || "1412");
      const currentHijriYear = 1446;
      const age = currentHijriYear - birthYear;
      const retireAge = rankRetirementAge[a.rank] || 60;
      const yearsToRetire = retireAge - age;
      return yearsToRetire < 25;
    }
  },
  {
    name: "hireDay",
    question: "اختر يوم التعيين:",
    type: "select",
    options: Array.from({length: 30}, (_, i) => (i + 1).toString().padStart(2, '0')),
    show: (a) => a.wantsExtended === "نعم"
  },
  {
    name: "hireMonth",
    question: "اختر شهر التعيين:",
    type: "select",
    options: Array.from({length: 12}, (_, i) => (i + 1).toString().padStart(2, '0')),
    show: (a) => a.wantsExtended === "نعم"
  },
  {
    name: "hireYear",
    question: "اختر سنة التعيين:",
    type: "select",
    options: Array.from({length: 36}, (_, i) => (1412 - i).toString()).reverse(), // من 1377 إلى 1412 تقريبًا
    show: (a) => a.wantsExtended === "نعم"
  }
);

const rankRetirementAge = {
  "جندي": 44, "جندي أول": 44, "عريف": 46, "وكيل رقيب": 46,
  "رقيب": 48, "رقيب أول": 50, "رئيس رقباء": 52,
  "ملازم": 48, "ملازم أول": 50, "نقيب": 52, "رائد": 54,
  "مقدم": 56, "عقيد": 58, "عميد": 60, "لواء": 60
};
</script><script>
// دالة لحساب الراتب التقاعدي التلقائي
function getRetirementSalary(rank, hireYear, birthYear){
  // راتب أساسي أول مربوط لكل رتبة عند التعيين
  const baseSalaryByRank = {
    "جندي": 3220, "جندي أول": 3395, "عريف": 3765, "وكيل رقيب": 4455,
    "رقيب": 5260, "رقيب أول": 6180, "رئيس رقباء": 7215,
    "ملازم": 7590, "ملازم أول": 8835, "نقيب": 10600, "رائد": 13515,
    "مقدم": 14645, "عقيد": 16520, "عميد": 18600, "لواء": 21000
  };

  // عدد سنوات الخدمة = من سنة التعيين حتى سنة التقاعد
  const currentHijriYear = 1446;
  const retireAge = rankRetirementAge[rank] || 60;
  const age = currentHijriYear - birthYear;
  const retirementYear = birthYear + retireAge;

  const serviceYears = retirementYear - hireYear;
  const base = baseSalaryByRank[rank] || 0;

  const retirementSalary = Math.floor((base * serviceYears) / 40);
  return retirementSalary;
}
</script><script>
// إدخال الراتب الصافي فقط (بدون الأساسي)
generalQuestions.push({
  name: "salary",
  question: "كم هو راتبك الصافي الحالي (بالريال)؟",
  type: "number",
  show: (a) => true
});

// في صفحة النتيجة، نحسب الراتب التقاعدي إذا كان:
function getPrePostRetirementInstallments(answers){
  const salary = parseFloat(answers.salary || "0");
  const birthYear = parseInt(answers.birthHijriYear || "1412");
  const hireYear = parseInt(answers.hireYear || "1412");
  const rank = answers.rank;

  let retirementSalary = salary; // افتراضي إذا ما تم طلب حسبة ممتدة
  let result = {
    preRetirementInstallment: Math.floor(salary * 0.55),
    postRetirementInstallment: Math.floor(salary * 0.55)
  };

  if(answers.wantsExtended === "نعم"){
    // إذا تم طلب الحسبة بعد التقاعد، نستخدم الراتب التقاعدي الفعلي
    retirementSalary = getRetirementSalary(rank, hireYear, birthYear);
    result = {
      preRetirementInstallment: Math.floor(salary * 0.55),
      postRetirementInstallment: Math.floor(retirementSalary * 0.55),
      retirementSalary: retirementSalary
    };
  }

  return result;
}
</script><script>
generalQuestions.push({
  name: "hasCommitments",
  question: "هل لديك التزامات مالية حالية؟",
  type: "select",
  options: ["نعم", "لا"],
  show: () => true
});

const commitmentQuestions = [
  {
    name: "commitmentType",
    question: "ما نوع الالتزام؟",
    type: "select",
    options: ["قرض سيارة", "قرض استهلاكي", "بطاقة ائتمانية", "أخرى"]
  },
  {
    name: "commitmentValue",
    question: "كم قيمة القسط الشهري؟",
    type: "number"
  },
  {
    name: "commitmentMonths",
    question: "كم عدد الأشهر المتبقية؟",
    type: "select",
    options: Array.from({length: 60}, (_, i) => (i+1).toString())
  },
  {
    name: "hasFinalPayment",
    question: "هل لديك دفعة أخيرة؟",
    type: "select",
    options: ["نعم", "لا"],
    show: (a) => a.commitmentType === "قرض سيارة"
  },
  {
    name: "finalPaymentAmount",
    question: "ما مبلغ الدفعة الأخيرة؟",
    type: "number",
    show: (a) => a.hasFinalPayment === "نعم"
  },
  {
    name: "anotherCommitment",
    question: "هل لديك التزام آخر؟",
    type: "select",
    options: ["نعم", "لا"]
  }
];

let commitmentStep = 0;
let currentCommitment = {};

function handleCommitmentAnswer(value) {
  const q = commitmentQuestions[commitmentStep];
  currentCommitment[q.name] = value;

  if (q.name === "anotherCommitment" && value === "نعم") {
    answers.commitments.push(currentCommitment);
    currentCommitment = {};
    commitmentStep = 0;
    showQuestion();
  } else if (q.name === "anotherCommitment") {
    answers.commitments.push(currentCommitment);
    currentCommitment = {};
    commitmentStep = 0;
    step++;
    showQuestion();
  } else {
    commitmentStep++;
    showQuestion();
  }
}
</script>const name = answers.clientName || "العميل";
const duration = describeMonths(months);
const finalNetFixed = finalNet.toFixed(0);
let html = '<div class="result"><h2>نتيجة الحسبة (التقريبية):</h2>';
html += `<p style="color:#1565c0; font-size:36px;"><strong>مرحباً ومسهلا يا ${name}</strong></p>`;
html += `<p style="font-size:32px;">مدة التمويل: <strong>${duration}</strong></p>`;

if (finalPhases.every(p => p.inst <= 0)) {
  html += `<p style="color:red; font-size:38px; font-weight:bold;">نعتذر منك لا يمكن تمويلك</p>`;
}

finalPhases.forEach(p=>{
  html += `<p><strong>القسط من الشهر ${p.from} إلى ${p.to}:</strong> ${p.inst.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} ريال</p>`;
});

if (answers.retirementSalary){
  html += `<p style="font-size: 28px; margin-top: 30px; color: green;">
    💰 راتبك التقاعدي المحتسب: <strong>${answers.retirementSalary.toLocaleString()} ريال</strong>
  </p>`;
}

html += `
<p style="color: green; font-size: 44px; font-weight: bold;"> التمويل الصافي بعد خصم الرسوم النهائية: ${finalNetFixed.replace(/\B(?=(\d{3})+(?!\d))/g, ",")} ريال</p>
${supportText}
<p style="color: green; font-size: 36px;"><strong>التمويل الصافي قبل خصم الرسوم:</strong> ${netFinance.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} ريال</p>
<p style="color: red; font-size: 36px;"><strong>الربح دون الرسوم:</strong> ${(totalInst - netFinance).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} ريال</p>
<p style="color: red; font-size: 42px;"><strong>الربح مع الرسوم:</strong> ${totalProfitWithFees.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} ريال</p>
<p><strong>معامل الربح:</strong> ${profitFactor.toFixed(3)}</p>
<p><strong>الرسوم الإدارية:</strong> ${adminFee.toFixed(0)} ريال</p>
<p><strong>ضريبة الرسوم:</strong> ${vat.toFixed(0)} ريال</p>
${addCommodityFee ? `<p><strong>رسوم السلع:</strong> ${commodityFee.toFixed(0)} ريال</p>` : ''}
<p><strong>إجمالي التمويل مع الأرباح:</strong> ${totalInst.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",")} ريال</p>
<p><strong>بالأحرف:</strong> ${numberToArabicWords(parseInt(finalNetFixed))}</p>
<p style="margin-top:40px; font-size: 26px; color: gray;">📸 خذ لقطة شاشة للنتيجة أو تواصل معنا.</p>
<p style="font-size: 26px; color: gray;">💬 واتساب: 0506214458</p>
<p style="font-size: 26px; color: gray;">🌐 زورونا على موقعنا: <a href="https://hlooleqrr.com" target="_blank">hlooleqrr.com</a></p>
`;