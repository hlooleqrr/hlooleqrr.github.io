<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„</title>
  <style>
    body { font-family: 'Tajawal', sans-serif; background: #f4f6f8; margin: 0; text-align: center; font-size: 32px; }
    header { background: #005c48; color: #fff; padding: 25px; font-size: 34px; }
    .container { max-width: 650px; margin: 25px auto; background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,.1); }
    input, select, button { width: 92%; padding: 20px; margin: 18px 0; font-size: 32px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
    select option { font-size: 30px; }
    button { background: #00796b; color: #fff; border: none; cursor: pointer; }
    button:hover { background: #004d40; }
    .small-reset { font-size: 28px; padding: 12px 20px; margin-top: 22px; background: #e3f2fd; color: #1565c0; border: none; cursor: pointer; border-radius: 15px; }
    .small-reset:hover { background: #bbdefb; }
    footer { font-size: 26px; color: #666; margin-top: 40px; padding: 15px; }
    .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInMove .6s forwards; }
    @keyframes fadeInMove { to { opacity: 1; transform: translateY(0); } }
    .result p { margin: 12px 0; font-size: 30px; line-height: 1.6; }
    .result h2, .result h3 { font-size: 34px; }
    .highlight { font-size: 36px; font-weight: bold; color: #004d40; }
  </style>
</head>
<body>
<header>
  <h1>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</h1>
  <p>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©</p>
</header>
<div class="container" id="form-container">
  <div id="question"></div>
  <button id="mainButton" onclick="handleStartOrReset()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø¨Ø©</button>
  <div id="nextContainer" style="display:none">
    <button onclick="nextQuestion()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
  </div>
  <div id="resetButtonContainer" style="display:none">
    <button class="small-reset" onclick="resetCalc()">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø©</button>
  </div>
</div>
<script>
let answers = { commitments: [] }, step = 0, commitmentStep = 0, currentCommitment = {};
let hasStarted = false;<script>
const generalQuestions = [

  // âœ… 1. Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„
  { id:'clientName', label:'Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…', type:'text' },

  // âœ… 2. Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (ÙŠØ¸Ù‡Ø± Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø«Ø§Ù†ÙŠÙ‹Ø§ Ø­Ø³Ø¨ Ø§Ù„Ø§ØªÙØ§Ù‚)
  {
    id:'financeType',
    label:'Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ØªØ±ÙŠØ¯ Ø­Ø³Ø¨ØªÙ‡:',
    type:'select',
    options:['ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ Ø£Ùˆ ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ','ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ']
  },

  // âœ… 3. ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (ÙŠÙˆÙ…/Ø´Ù‡Ø±/Ø³Ù†Ø©)
  { id:'birthDay', label:'Ø§Ø®ØªØ± ÙŠÙˆÙ… Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:', type:'select', options:Array.from({length:30},(_,i)=>i+1), default:1 },
  { id:'birthMonth', label:'Ø§Ø®ØªØ± Ø´Ù‡Ø± Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:', type:'select', options:Array.from({length:12},(_,i)=>i+1), default:1 },
  { id:'birthYear', label:'Ø§Ø®ØªØ± Ø³Ù†Ø© Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:', type:'select', options:Array.from({length:61},(_,i)=>1370+i), default:1412 },

  // âœ… 4. Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ©
  {
    id:'jobType',
    label:'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ©',
    type:'select',
    options:[
      'Ø¹Ø³ÙƒØ±ÙŠ',
      'Ù…Ø¯Ù†ÙŠ (Ù‚Ø·Ø§Ø¹ Ø­ÙƒÙˆÙ…ÙŠ)',
      'Ø®Ø§Øµ (Ø´Ø¨Ù‡ Ø­ÙƒÙˆÙ…ÙŠ)',
      'Ø®Ø§Øµ (Ø´Ø±ÙƒØ© Ù…Ø¹ØªÙ…Ø¯Ø©)',
      'Ø®Ø§Øµ (Ø´Ø±ÙƒØ© ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯Ø©)'
    ]
  },

  // âœ… 5. Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ© (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ Ø§Ù„ÙˆØ¸ÙŠÙØ© = Ø¹Ø³ÙƒØ±ÙŠ)
  {
    id:'militaryRank',
    label:'Ø§Ø°ÙƒØ± Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©',
    type:'select',
    options:[
      'Ø¬Ù†Ø¯ÙŠ','Ø¹Ø±ÙŠÙ','Ø±Ù‚ÙŠØ¨','Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡','Ù†Ù‚ÙŠØ¨',
      'Ø±Ø§Ø¦Ø¯','Ù…Ù‚Ø¯Ù…','Ø¹Ù‚ÙŠØ¯','Ø¹Ù…ÙŠØ¯','Ù„ÙˆØ§Ø¡'
    ],
    show: a => a.jobType === 'Ø¹Ø³ÙƒØ±ÙŠ'
  },

  // âœ… 6. Ø¯Ø¹Ù… Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (Ø¥Ø°Ø§ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ)
  {
    id:'supported',
    label:'Ù‡Ù„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…ØŸ',
    type:'select',
    options:['Ù…Ø¯Ø¹ÙˆÙ…','ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…'],
    show: a => a.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ'
  },

  // âœ… 7. Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø³ÙƒÙ†ÙŠ (Ø¥Ø°Ø§ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ù…Ø¯Ø¹ÙˆÙ…)
  {
    id:'bundle',
    label:'Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø¯ÙØ¹Ø© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø³ÙƒÙ†ÙŠØŸ',
    type:'select',
    options:['Ù†Ø¹Ù…','Ù„Ø§'],
    show: a => a.supported === 'Ù…Ø¯Ø¹ÙˆÙ…'
  },

  // âœ… 8. Ø³Ø¤Ø§Ù„ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ù…Ù…ØªØ¯ (Ø¥Ø°Ø§ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ + Ø¹Ø³ÙƒØ±ÙŠ + Ù…ØªØ¨Ù‚ÙŠ Ø£Ù‚Ù„ Ù…Ù† 25 Ø³Ù†Ø©)
  {
    id:'extendedRetirement',
    label:'Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø§Ù„Ø­Ø³Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ù…Ù…ØªØ¯ØŸ',
    type:'select',
    options:['Ù†Ø¹Ù…','Ù„Ø§'],
    show: a => {
      if (a.financeType !== 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' || a.jobType !== 'Ø¹Ø³ÙƒØ±ÙŠ') return false;
      const age = 1446 - parseInt(a.birthYear);
      const retireAge = getRetirementAge(a.militaryRank || 'Ø¬Ù†Ø¯ÙŠ');
      return (retireAge - age) < 25;
    }
  },

  // âœ… 9. ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† (Ø¥Ø°Ø§ ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø¨Ø© Ø§Ù„Ù…Ù…ØªØ¯Ø©)
  {
    id:'hireDay',
    label:'Ø§Ø®ØªØ± ÙŠÙˆÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†:',
    type:'select',
    options: Array.from({length:30},(_,i)=>i+1),
    default:1,
    show: a => a.extendedRetirement === 'Ù†Ø¹Ù…'
  },
  {
    id:'hireMonth',
    label:'Ø§Ø®ØªØ± Ø´Ù‡Ø± Ø§Ù„ØªØ¹ÙŠÙŠÙ†:',
    type:'select',
    options: Array.from({length:12},(_,i)=>i+1),
    default:1,
    show: a => a.extendedRetirement === 'Ù†Ø¹Ù…'
  },
  {
    id:'hireYear',
    label:'Ø§Ø®ØªØ± Ø³Ù†Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†:',
    type:'select',
    options: Array.from({length:36},(_,i)=>1410+i),
    default:1420,
    show: a => a.extendedRetirement === 'Ù†Ø¹Ù…'
  },

  // âœ… 10. Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„ØµØ§ÙÙŠ
  { id:'salary', label:'ÙƒÙ… Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„ØµØ§ÙÙŠØŸ', type:'number' },

  // âœ… 11. Ø¹Ø¯Ø¯ Ø£Ø´Ù‡Ø± Ø§Ù„ØªÙ…ÙˆÙŠÙ„ (ÙŠÙØ­Ø³Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†/Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯)
  { id:'months', label:'Ø¹Ù„Ù‰ ÙƒÙ… Ø´Ù‡Ø± ØªØ±ÙŠØ¯ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ØŸ', type:'select', options:[], dynamic:true },

  // âœ… 12. Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ
  { id:'profitMargin', label:'Ù†Ø³Ø¨Ø© Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ (%)ØŸ', type:'number' },

  // âœ… 13. Ù‡Ù„ ØªÙˆØ¬Ø¯ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ
  { id:'hasCommitments', label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§ØªØŸ', type:'select', options:['Ù†Ø¹Ù…','Ù„Ø§'] }

];
</script><script>
// âš™ï¸ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª ØªØªÙƒØ±Ø± Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª
const commitmentQuestions = [
  {
    id:'commitmentType',
    label:'Ù…Ø§ Ù†ÙˆØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…ØŸ',
    type:'select',
    options:['Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©','Ù‚Ø±Ø¶ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ','Ù‚Ø±Ø¶ Ø¢Ø®Ø±']
  },
  {
    id:'commitmentValue',
    label:'ÙƒÙ… Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…ØŸ',
    type:'number'
  },
  {
    id:'commitmentMonths',
    label:'ÙƒÙ… Ø´Ù‡Ø± Ù…ØªØ¨Ù‚ÙŠ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…ØŸ',
    type:'select',
    options: Array.from({length:360},(_,i)=>i+1)
  },
  {
    id:'hasFinalPayment',
    label:'Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø¯ÙØ¹Ø© Ø£Ø®ÙŠØ±Ø©ØŸ',
    type:'select',
    options:['Ù†Ø¹Ù…','Ù„Ø§'],
    show: a => a.commitmentType === 'Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©'
  },
  {
    id:'finalPaymentValue',
    label:'ÙƒÙ… Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©ØŸ',
    type:'number',
    show: a => a.commitmentType === 'Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' && a.hasFinalPayment === 'Ù†Ø¹Ù…'
  },
  {
    id:'anotherCommitment',
    label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù… Ø¢Ø®Ø±ØŸ',
    type:'select',
    options:['Ù†Ø¹Ù…','Ù„Ø§']
  }
];

// ğŸ§  Ø¯Ø§Ù„Ø© Ø³Ù† Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©
function getRetirementAge(rank){
  return {
    'Ø¬Ù†Ø¯ÙŠ': 44, 'Ø¹Ø±ÙŠÙ': 46, 'Ø±Ù‚ÙŠØ¨': 48, 'Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡': 52,
    'Ù†Ù‚ÙŠØ¨': 52, 'Ø±Ø§Ø¦Ø¯': 54, 'Ù…Ù‚Ø¯Ù…': 56, 'Ø¹Ù‚ÙŠØ¯': 58,
    'Ø¹Ù…ÙŠØ¯': 60, 'Ù„ÙˆØ§Ø¡': 60
  }[rank] || 44;
}

// ğŸ’° Ø¯Ø§Ù„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø±ØªØ¨Ø©
function getBaseSalaryByRank(rank){
  return {
    'Ø¬Ù†Ø¯ÙŠ': 4500, 'Ø¹Ø±ÙŠÙ': 5000, 'Ø±Ù‚ÙŠØ¨': 6000, 'Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡': 7000,
    'Ù†Ù‚ÙŠØ¨': 8000, 'Ø±Ø§Ø¦Ø¯': 9000, 'Ù…Ù‚Ø¯Ù…': 10000, 'Ø¹Ù‚ÙŠØ¯': 11000,
    'Ø¹Ù…ÙŠØ¯': 12000, 'Ù„ÙˆØ§Ø¡': 13000
  }[rank] || 4500;
}

// âœ… Ù…ØªØºÙŠØ±Ø§Øª Ø¥Ø¯Ø§Ø±Ø© Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª
let commitmentStep = 0;
let currentCommitment = {};
</script><script>
function calculate() {
  const salary = parseFloat(answers.salary);
  const months = parseInt(answers.months);
  const years = months / 12;
  const profitMargin = parseFloat(answers.profitMargin);
  const financeType = answers.financeType;
  const supported = answers.supported;
  const bundle = answers.bundle;
  const jobType = answers.jobType;
  const birthYear = parseInt(answers.birthYear);
  const rank = answers.militaryRank;

  const hijriNow = 1446;
  const age = hijriNow - birthYear;

  // Ø³Ù† Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ø±ØªØ¨Ø©
  const retirementAge = jobType === 'Ø¹Ø³ÙƒØ±ÙŠ' ? getRetirementAge(rank) : 60;
  const retirementYear = birthYear + retirementAge;
  const retirementMonth = (retirementYear - hijriNow) * 12;

  // Ø±Ø§ØªØ¨ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ (ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ Ø§Ù„Ù…Ù…ØªØ¯ ÙÙ‚Ø·)
  let postRetirementInst = 0;
  if (answers.extendedRetirement === 'Ù†Ø¹Ù…') {
    const base = getBaseSalaryByRank(rank);
    const yearsWorked = hijriNow - parseInt(answers.hireYear);
    const pension = (base * yearsWorked) / 40;
    postRetirementInst = pension * 0.55;
  }

  // Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø·Ø§Ø¹
  let instPercent = 0.55;
  if (financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ') {
    if (salary >= 15000 || (supported === 'Ù…Ø¯Ø¹ÙˆÙ…' && bundle === 'Ù„Ø§')) instPercent = 0.65;
  } else if (financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ Ø£Ùˆ ØªÙ…ÙˆÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ') {
    instPercent = answers.hasCommitments === 'Ù†Ø¹Ù…' ? 0.45 : 0.33;
  }

  const maxInst = salary * instPercent;
  let monthlyInsts = Array(months).fill(maxInst);

  // Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª
  if (answers.hasCommitments === 'Ù†Ø¹Ù…') {
    let pointer = 0;
    for (const c of answers.commitments) {
      let value = parseFloat(c.commitmentValue);
      let duration = parseInt(c.commitmentMonths);
      if (c.commitmentType === 'Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©' && c.hasFinalPayment === 'Ù†Ø¹Ù…') {
        const finalPay = parseFloat(c.finalPaymentValue);
        value += finalPay / 24;
        duration = Math.max(duration, 60); // Ù„Ø¶Ù…Ø§Ù† ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø¹Ø§Ø¯ÙŠ
      }
      for (let i = pointer; i < pointer + duration && i < months; i++) {
        monthlyInsts[i] -= value;
      }
      pointer += duration;
    }
  }

  // Ø§Ù„Ø­Ø³Ø¨Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ Ø§Ù„Ù…Ù…ØªØ¯
  if (answers.extendedRetirement === 'Ù†Ø¹Ù…' && financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ') {
    for (let i = retirementMonth; i < months; i++) {
      monthlyInsts[i] = Math.min(monthlyInsts[i], postRetirementInst);
    }
  }

  // Ø­Ø°Ù Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø³Ø§Ù„Ø¨Ø©
  monthlyInsts = monthlyInsts.map(m => m < 0 ? 0 : m);

  // Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ù…ÙˆÙ„
  const totalPaid = monthlyInsts.reduce((a,b)=>a+b,0);
  const monthlyRate = profitMargin / 12 / 100;
  const financeAmount = totalPaid / ((monthlyRate * Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1));
  const adminFees = Math.min(5000, financeAmount * 0.01);
  const totalFees = adminFees * 1.15;
  const netAmount = financeAmount - totalFees;
  const totalProfit = totalPaid - financeAmount;
  const totalProfitWithFees = totalPaid - netAmount;

  // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
  showResult(monthlyInsts, netAmount, totalProfit, totalProfitWithFees, months);
}
</script><script>
function showResult(monthlyInsts, netAmount, profit, profitWithFees, months){
  const container = document.getElementById("resultContainer");
  const resultBox = document.getElementById("resultBox");
  const name = answers.clientName;
  const parts = describeMonths(months);
  const durationStr = `${months} Ø´Ù‡Ø± (${parts})`;

  // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØºÙŠØ±Ø©
  let ranges = [];
  let start = 0;
  for(let i = 1; i <= monthlyInsts.length; i++){
    if(i === monthlyInsts.length || monthlyInsts[i] !== monthlyInsts[start]){
      const from = start + 1;
      const to = i;
      const value = Math.round(monthlyInsts[start]);
      if(value > 0){
        ranges.push(`Ù…Ù† ${from} Ø¥Ù„Ù‰ ${to} = ${value.toLocaleString()} Ø±ÙŠØ§Ù„`);
      }
      start = i;
    }
  }

  // Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
  const formatNumber = num => Math.round(num).toLocaleString();
  const greeting = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙˆÙ…Ø³Ù‡Ù„Ø§ ÙŠØ§ ${name}`;
  const netText = `ØªÙ…ÙˆÙŠÙ„Ùƒ Ø§Ù„ØµØ§ÙÙŠ ÙŠØ§ ${name} Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø§Ù„Ø±Ø³ÙˆÙ…: ${formatNumber(netAmount)} Ø±ÙŠØ§Ù„`;
  const profitText = `Ø§Ù„Ø±Ø¨Ø­ Ø¯ÙˆÙ† Ø§Ù„Ø±Ø³ÙˆÙ…: ${formatNumber(profit)} Ø±ÙŠØ§Ù„`;
  const profitFeesText = `Ø§Ù„Ø±Ø¨Ø­ Ù…Ø¹ Ø§Ù„Ø±Ø³ÙˆÙ…: ${formatNumber(profitWithFees)} Ø±ÙŠØ§Ù„`;

  // Ø¯Ø¹Ù… Ø³ÙƒÙ†ÙŠ (Ø¥Ù† ÙˆÙØ¬Ø¯)
  let supportText = '';
  if (answers.financeType === 'ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ' && answers.supported === 'Ù…Ø¯Ø¹ÙˆÙ…') {
    supportText = `<div style="color:#007700;font-size:30px">Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØµØ§ÙÙŠ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…: ${formatNumber(answers.calculatedFinance)} Ø±ÙŠØ§Ù„</div><br>`;
  }

  // Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙ…ÙˆÙŠÙ„Ù‡
  if(monthlyInsts.every(v => v <= 0)){
    resultBox.innerHTML = `<div style="color:red;font-size:36px">Ù†Ø¹ØªØ°Ø± Ù…Ù†Ùƒ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªÙ…ÙˆÙŠÙ„Ùƒ</div>`;
  }else{
    resultBox.innerHTML = `
      <div style="color:#005c48;font-weight:bold;font-size:36px">${greeting}</div><br>
      <div style="color:#005c48;font-size:32px">${netText}</div><br>
      ${supportText}
      <div style="color:#b30000;font-size:30px">${profitText}</div>
      <div style="color:#b30000;font-size:30px">${profitFeesText}</div><br>
      ${ranges.map(r => `<div>${r}</div>`).join("")}
      <br><div style="font-size:28px">Ù…Ø¯Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„: ${durationStr}</div>
      <br><br>
      <span style="font-size:26px;color:gray">ğŸ’¡ Ø®Ø° Ù„Ù‚Ø·Ø© Ù„Ù„Ø´Ø§Ø´Ø© ÙˆØ±Ø§Ø³Ù„Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªÙ…Ù„Ùƒ</span><br>
      <span style="font-size:26px;color:#005c48">ğŸ“ Ù„Ù„ØªÙˆØ§ØµÙ„: 0530000000</span><br>
      <span style="font-size:26px;color:#005c48">ğŸŒ www.hlooleqrr.com</span>
    `;
  }

  container.style.display = 'block';
}
</script><script>
function handleStartOrReset() {
  if (!hasStarted) {
    hasStarted = true;
    document.getElementById('mainButton').style.display = 'none';
    document.getElementById('resetButtonContainer').style.display = 'block';
    showQuestion();
  } else {
    resetCalc();
  }
}

function resetCalc() {
  answers = { commitments: [] };
  step = 0;
  commitmentStep = 0;
  currentCommitment = {};
  hasStarted = true;
  document.getElementById('mainButton').style.display = 'none';
  document.getElementById('resetButtonContainer').style.display = 'block';
  document.getElementById('resultContainer').style.display = 'none';
  showQuestion();
}

function showQuestion() {
  const cont = document.getElementById('question');
  cont.innerHTML = '';
  document.getElementById('nextContainer').style.display = 'block';
  let q;

  if (step < generalQuestions.length) {
    q = generalQuestions[step];
    if (q.show && !q.show(answers)) {
      step++;
      showQuestion();
      return;
    }

    const label = document.createElement('label');
    label.innerText = q.label;
    cont.appendChild(label);

    let input;
    if (q.type === 'select') {
      input = document.createElement('select');
      q.options.forEach(opt => {
        const option = document.createElement('option');
        option.value = opt;
        option.innerText = opt;
        input.appendChild(option);
      });
      if (q.default) input.value = q.default;
    } else {
      input = document.createElement('input');
      input.type = q.type;
    }

    input.value = answers[q.id] || '';
    input.oninput = e => answers[q.id] = e.target.value;
    cont.appendChild(input);

  } else if (answers.hasCommitments === 'Ù†Ø¹Ù…') {
    q = commitmentQuestions[commitmentStep];
    if (q.show && !q.show(currentCommitment)) {
      commitmentStep++;
      showQuestion();
      return;
    }

    const label = document.createElement('label');
    label.innerText = q.label;
    cont.appendChild(label);

    let input;
    if (q.type === 'select') {
      input = document.createElement('select');
      q.options.forEach(opt => {
        const option = document.createElement('option');
        option.value = opt;
        option.innerText = opt;
        input.appendChild(option);
      });
    } else {
      input = document.createElement('input');
      input.type = q.type;
    }

    input.value = currentCommitment[q.id] || '';
    input.oninput = e => currentCommitment[q.id] = e.target.value;
    cont.appendChild(input);

  } else {
    calculate();
    document.getElementById('nextContainer').style.display = 'none';
  }
}

function nextQuestion() {
  if (step < generalQuestions.length) {
    step++;
    showQuestion();
  } else if (answers.hasCommitments === 'Ù†Ø¹Ù…') {
    const q = commitmentQuestions[commitmentStep];
    if (q.id === 'anotherCommitment') {
      if (currentCommitment[q.id] === 'Ù†Ø¹Ù…') {
        answers.commitments.push(currentCommitment);
        currentCommitment = {};
        commitmentStep = 0;
        showQuestion();
      } else {
        answers.commitments.push(currentCommitment);
        calculate();
        document.getElementById('nextContainer').style.display = 'none';
      }
    } else {
      commitmentStep++;
      showQuestion();
    }
  }
}
</script>