document.addEventListener('DOMContentLoaded', () => {
  // ملء القوائم بالسنة والشهر واليوم (الهجري)
  const birthYearSelect = document.getElementById('birthYear');
  const birthMonthSelect = document.getElementById('birthMonth');
  const birthDaySelect = document.getElementById('birthDay');
  const joinYearSelect = document.getElementById('joinYear');
  const joinMonthSelect = document.getElementById('joinMonth');
  const joinDaySelect = document.getElementById('joinDay');

  populateSelect(birthYearSelect, 1370, 1435);
  populateMonths(birthMonthSelect);
  populateDays(birthDaySelect);

  populateSelect(joinYearSelect, 1370, 1435);
  populateMonths(joinMonthSelect);
  populateDays(joinDaySelect);

  // عناصر الخطوات
  const steps = [...document.querySelectorAll('.step')];
  let currentStep = 0;

  const startBtn = document.getElementById('startBtn');
  const step2Next = document.getElementById('step2Next');
  const step2Prev = document.getElementById('step2Prev');
  const step3Next = document.getElementById('step3Next');
  const step3Prev = document.getElementById('step3Prev');
  const step4Next = document.getElementById('step4Next');
  const step4Prev = document.getElementById('step4Prev');
  const step5Next = document.getElementById('step5Next');
  const step5Prev = document.getElementById('step5Prev');
  const step6Next = document.getElementById('step6Next');
  const step6Prev = document.getElementById('step6Prev');
  const resetBtn = document.getElementById('resetBtn');

  // حقول الإدخال
  const clientNameInput = document.getElementById('clientName');
  const retirementTypeSelect = document.getElementById('retirementType');
  const rankSelect = document.getElementById('rank');

  // عرض الاسم في الخطوات
  function updateNameDisplays(name) {
    document.getElementById('clientNameDisplay3').textContent = name;
    document.getElementById('clientNameDisplay4').textContent = name;
    document.getElementById('clientNameDisplay5').textContent = name;
    document.getElementById('clientNameDisplay6').textContent = name;
  }

  // إظهار خطوة معينة وإخفاء البقية
  function showStep(index) {
    steps.forEach((step, i) => {
      step.classList.toggle('active', i === index);
    });
    currentStep = index;
  }

  // تفعيل أو تعطيل أزرار "التالي" حسب صحة المدخلات
  clientNameInput.addEventListener('input', () => {
    step2Next.disabled = clientNameInput.value.trim() === '';
  });

  retirementTypeSelect.addEventListener('change', () => {
    step3Next.disabled = retirementTypeSelect.value === '';
  });

  rankSelect.addEventListener('change', () => {
    step6Next.disabled = rankSelect.value === '';
  });

  // أزرار التنقل
  startBtn.addEventListener('click', () => {
    showStep(1);
  });

  step2Prev.addEventListener('click', () => {
    showStep(0);
  });
  step2Next.addEventListener('click', () => {
    updateNameDisplays(clientNameInput.value.trim());
    showStep(2);
  });

  step3Prev.addEventListener('click', () => {
    showStep(1);
  });
  step3Next.addEventListener('click', () => {
    // إذا نوع التقاعد عسكري أظهر الخطوة 6 للرتبة، إذا مدني تخطى للخطوة 5
    if (retirementTypeSelect.value === 'military') {
      showStep(5);
      step6Next.disabled = true; // عطل زر التالي حتى يختار الرتبة
      rankSelect.value = '';
    } else {
      showStep(4);
    }
  });

  step4Prev.addEventListener('click', () => {
    // إذا كانت الخطوة السابقة عسكري انتقل للخطوة 3 مباشرة
    if (retirementTypeSelect.value === 'military') {
      showStep(5);
    } else {
      showStep(2);
    }
  });
  step4Next.addEventListener('click', () => {
    showStep(4);
  });

  step5Prev.addEventListener('click', () => {
    if (retirementTypeSelect.value === 'military') {
      showStep(5);
    } else {
      showStep(3);
    }
  });
  step5Next.addEventListener('click', () => {
    calculateAndShowResult();
    showStep(6);
  });

  step6Prev.addEventListener('click', () => {
    showStep(2);
  });
  step6Next.addEventListener('click', () => {
    showStep(6);
    calculateAndShowResult();
  });

  resetBtn.addEventListener('click', () => {
    location.reload();
  });

  // تفعيل أزرار التالي في الخطوتين 4 و5 حسب اختيار القوائم
  function checkStep4Validity() {
    step4Next.disabled = !(
      birthYearSelect.value && birthMonthSelect.value && birthDaySelect.value
    );
  }
  birthYearSelect.addEventListener('change', checkStep4Validity);
  birthMonthSelect.addEventListener('change', checkStep4Validity);
  birthDaySelect.addEventListener('change', checkStep4Validity);

  function checkStep5Validity() {
    step5Next.disabled = !(
      joinYearSelect.value && joinMonthSelect.value && joinDaySelect.value
    );
  }
  joinYearSelect.addEventListener('change', checkStep5Validity);
  joinMonthSelect.addEventListener('change', checkStep5Validity);
  joinDaySelect.addEventListener('change', checkStep5Validity);

  // دالة حساب بسيطة (يمكنك تطويرها حسب المطلوب)
  function calculateAndShowResult() {
    const name = clientNameInput.value.trim();
    const retirementType = retirementTypeSelect.value;
    const birthYear = parseInt(birthYearSelect.value);
    const birthMonth = parseInt(birthMonthSelect.value);
    const birthDay = parseInt(birthDaySelect.value);
    const joinYear = parseInt(joinYearSelect.value);
    const joinMonth = parseInt(joinMonthSelect.value);
    const joinDay = parseInt(joinDaySelect.value);
    const rank = rankSelect.value;

    // هنا يمكنك وضع منطق حساب الراتب التقاعدي بناءً على المدخلات

    let resultText = `مرحباً يا <span class="highlight">${name}</span><br>نوع التقاعد: <span class="highlight">${retirementType === 'military' ? 'عسكري' : 'مدني'}</span><br>`;
    resultText += `تاريخ الميلاد: ${birthYear}/${birthMonth}/${birthDay}<br>`;
    resultText += `تاريخ التعيين: ${joinYear}/${joinMonth}/${joinDay}<br>`;
    if (retirementType === 'military') {
      resultText += `رتبتك العسكرية: <span class="highlight">${rank}</span><br>`;
      // يمكنك هنا حساب الراتب من الجداول حسب الرتبة وسنوات الخدمة
    }
    resultText += `<br><strong>النتيجة النهائية للحسبة ستكون هنا...</strong>`;

    document.getElementById('result').innerHTML = resultText;
  }
});