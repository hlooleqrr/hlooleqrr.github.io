<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>سرعة تملك العقار والحلول التمويلية</title>
  <style>
    body { font-family: 'Tajawal', sans-serif; background: #f4f6f8; margin: 0; text-align: center; font-size: 32px; }
    header { background: #005c48; color: #fff; padding: 25px; font-size: 34px; }
    .container { max-width: 650px; margin: 25px auto; background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,.1); }
    input, select, button { width: 92%; padding: 20px; margin: 18px 0; font-size: 32px; border-radius: 5px; border: 1px solid #ccc; }
    #resultContainer { display:none; text-align: center; margin-top: 30px; font-size: 32px; }
    #resetButton { display:none; margin-top:20px; }
    .sliderValue { font-weight:bold; }
  </style>
</head>
<body>
  <header>سرعة تملك العقار والحلول التمويلية</header>
  <div class="container" id="formContainer">
    <button id="startButton">ابدأ الحسبة</button>
    <div id="question" style="display:none;"></div>
    <div id="nextContainer" style="display:none;">
      <button id="nextButton">التالي</button>
    </div>
  </div>

  <div class="container" id="resultContainer">
    <h3>نتيجة الحسبة:</h3>
    <div id="greeting"></div>
    <div id="retirementInfo"></div>
    <div id="financeInfo"></div>
    <div id="breakdown"></div>
    <button id="resetButton">🔁 إعادة الحسبة</button>
  </div>

  <script>
    const basicSalaryMap = {
      "جندي": 3220, "جندي أول": 3395, "عريف": 3765, "وكيل رقيب": 4455,
      "رقيب": 5260, "رقيب أول": 6180, "رئيس رقباء": 7215,
      "ملازم": 7590, "ملازم أول": 8835, "نقيب": 10600, "رائد": 13515,
      "مقدم": 14645, "عقيد": 16500, "عميد": 18805, "لواء": 21000, "فريق": 22000
    };
    const allowanceMap = {
      "جندي": 130, "جندي أول": 145, "عريف": 175, "وكيل رقيب": 200,
      "رقيب": 250, "رقيب أول": 280, "رئيس رقباء": 330,
      "ملازم": 380, "ملازم أول": 440, "نقيب": 490, "رائد": 540,
      "مقدم": 615, "عقيد": 670, "عميد": 725, "لواء": 780, "فريق": 830
    };
    const retireAgeMap = {
      "جندي":44,"جندي أول":44,"عريف":46,"وكيل رقيب":48,
      "رقيب":50,"رقيب أول":50,"رئيس رقباء":52,
      "ملازم":44,"ملازم أول":44,"نقيب":48,"رائد":50,
      "مقدم":52,"عقيد":54,"عميد":56,"لواء":58,"فريق":60
    };

    let step = 0, answers = {};

    document.getElementById('startButton').onclick = startCalc;
    document.getElementById('nextButton').onclick  = nextStep;
    document.getElementById('resetButton').onclick = resetCalc;

    function startCalc() {
      document.getElementById('startButton').style.display = 'none';
      document.getElementById('question').style.display  = 'block';
      document.getElementById('nextContainer').style.display = 'block';
      showStep();
    }

    function nextStep() {
      switch(step) {
        case 0: answers.name = document.getElementById('inputName').value.trim(); break;
        case 1:
          answers.today = {
            y:+document.getElementById('todayYear').value,
            m:+document.getElementById('todayMonth').value,
            d:+document.getElementById('todayDay').value
          }; break;
        case 2: answers.financeType = document.getElementById('financeType').value; break;
        case 3: answers.rank        = document.getElementById('rank').value; break;
        case 4:
          answers.appoint = {
            y:+document.getElementById('appointYear').value,
            m:+document.getElementById('appointMonth').value,
            d:+document.getElementById('appointDay').value
          }; break;
        case 5:
          answers.birth = {
            y:+document.getElementById('birthYear').value,
            m:+document.getElementById('birthMonth').value,
            d:+document.getElementById('birthDay').value
          }; break;
        case 6: answers.margin  = parseFloat(document.getElementById('profitMargin').value); break;
        case 7: answers.payment = parseFloat(document.getElementById('paymentAmount').value); break;
        case 8: answers.duration= +document.getElementById('duration').value; break;
      }
      step++;
      if (step <= 8) showStep();
      else showResult();
    }

    function showStep() {
      const q = document.getElementById('question');
      q.innerHTML = '';
      document.getElementById('nextButton').style.display = 'inline-block';
      switch(step) {
        case 0:
          q.innerHTML = `<input type="text" id="inputName" placeholder="الاسم الكريم">`;
          break;
        case 1:
          q.innerHTML = `
            <label>تاريخ اليوم (هجري):</label><br>
            <select id="todayDay">${[...Array(30)].map((_,i)=>`<option>${i+1}</option>`).join('')}</select>
            <select id="todayMonth">${[...Array(12)].map((_,i)=>`<option>${i+1}</option>`).join('')}</select>
            <select id="todayYear">${[...Array(80)].map((_,i)=>`<option>${1370+i}</option>`).join('')}</select>`;
          break;
        case 2:
          q.innerHTML = `
            <select id="financeType">
              <option value="عقاري">تمويل عقاري</option>
              <option value="شخصي">تمويل شخصي</option>
            </select>`;
          break;
        case 3:
          q.innerHTML = `
            <select id="rank">
              ${Object.keys(basicSalaryMap).map(r=>`<option>${r}</option>`).join('')}
            </select>`;
          break;
        case 4:
          q.innerHTML = `
            <label>تاريخ التعيين (هجري):</label><br>
            <select id="appointDay">${[...Array(30)].map((_,i)=>`<option>${i+1}</option>`).join('')}</select>
            <select id="appointMonth">${[...Array(12)].map((_,i)=>`<option>${i+1}</option>`).join('')}</select>
            <select id="appointYear">${[...Array(80)].map((_,i)=>`<option>${1370+i}</option>`).join('')}</select>`;
          break;
        case 5:
          q.innerHTML = `
            <label>تاريخ الميلاد (هجري):</label><br>
            <select id="birthDay">${[...Array(30)].map((_,i)=>`<option>${i+1}</option>`).join('')}</select>
            <select id="birthMonth">${[...Array(12)].map((_,i)=>`<option>${i+1}</option>`).join('')}</select>
            <select id="birthYear">${[...Array(80)].map((_,i)=>`<option>${1370+i}</option>`).join('')}</select>`;
          break;
        case 6:
          q.innerHTML = `<input type="number" id="profitMargin" placeholder="نسبة هامش الربح (%)">`;
          break;
        case 7:
          q.innerHTML = `<input type="number" id="paymentAmount" placeholder="مبلغ الدفعة">`;
          break;
        case 8:
          const retireAge   = retireAgeMap[answers.rank];
          const availMonths = Math.max((60 - retireAge) * 12, 0);
          q.innerHTML = `
            <label>اختر مدة التمويل (بالشهور حتى ${availMonths}):</label><br>
            <input type="range" id="duration" min="1" max="${availMonths}" value="${availMonths}" oninput="this.nextElementSibling.textContent=this.value">
            <span class="sliderValue">${availMonths}</span>`;
          break;
      }
      document.getElementById('nextButton').textContent = step < 8 ? 'التالي' : 'عرض النتيجة';
    }

    function showResult() {
      document.getElementById('formContainer').style.display = 'none';

      // حساب مدة الخدمة من تاريخ التعيين إلى تاريخ التقاعد
      const retireAge   = retireAgeMap[answers.rank];
      const retireYear  = answers.birth.y + retireAge;
      const retireMonth = answers.birth.m;
      const serviceMonths = (retireYear - answers.appoint.y) * 12 +
                            (retireMonth - answers.appoint.m);

      // حساب الراتب التقاعدي
      const sal       = basicSalaryMap[answers.rank];
      const allowance = allowanceMap[answers.rank] || 0;
      const gross     = sal + allowance;
      const pension   = gross * serviceMonths / 420;

      // المدة المتاحة للتمويل بعد التقاعد حتى 60 سنة
      const availMonths = Math.max((60 - retireAge) * 12, 0);

      // حساب التمويل
      const ratio           = answers.financeType === 'عقاري' ? 0.55 : 0.25;
      const monthlyCap      = pension * ratio;
      const totalWithProfit = monthlyCap * answers.duration;
      const factor          = (answers.duration/12) * (answers.margin/100) + 1;
      const net             = totalWithProfit / factor;
      const profit          = totalWithProfit - net;
      const netWithPay      = net + answers.payment;

      // عرض النتائج
      document.getElementById('greeting').textContent = `مرحباً ومسهلاً يا ${answers.name}`;
      document.getElementById('retirementInfo').innerHTML = `
        <strong>العلاوة الدورية:</strong> ${allowance} ريال<br>
        <strong>مدة الخدمة حتى التقاعد (${retireAge} سنة):</strong> ${serviceMonths} شهراً<br>
        <strong>الراتب التقاعدي المحتسب:</strong> ${pension.toFixed(2)} ريال`;
      document.getElementById('financeInfo').innerHTML = `
        <strong>المدة المتاحة بعد التقاعد:</strong> ${availMonths} شهراً<br>
        <strong>نوع التمويل:</strong> ${answers.financeType}<br>
        <strong>مدة التمويل المختارة:</strong> ${answers.duration} شهراً<br>
        <strong>الحد الأقصى للقسط (${ratio*100}%):</strong> ${monthlyCap.toFixed(2)} ريال`;
      document.getElementById('breakdown').innerHTML = `
        <strong>إجمالي التمويل مع الأرباح:</strong> ${totalWithProfit.toFixed(2)} ريال<br>
        <strong>معامل الربح:</strong> ${factor.toFixed(3)}<br>
        <strong>الصافي بعد القسمة:</strong> ${net.toFixed(2)} ريال<br>
        <strong>الأرباح:</strong> ${profit.toFixed(2)} ريال<br>
        <strong>الصافي مع الدفعة:</strong> ${netWithPay.toFixed(2)} ريال`;
      document.getElementById('resultContainer').style.display = 'block';
      document.getElementById('resetButton').style.display   = 'inline-block';
    }

    function resetCalc() {
      step = 0; answers = {};
      document.getElementById('resultContainer').style.display = 'none';
      document.getElementById('formContainer').style.display   = 'block';
      document.getElementById('startButton').style.display     = 'inline-block';
      document.getElementById('question').style.display        = 'none';
      document.getElementById('nextContainer').style.display   = 'none';
    }
  </script>
</body>
</html>