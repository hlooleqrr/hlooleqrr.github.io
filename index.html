function calculateResult() {
  const financeType = answers.financeType;
  const supported = answers.supported;
  const bundle = answers.bundle;
  const salary = parseFloat(answers.salary) || 0;
  const years = parseFloat(answers.years) || 0;
  const profitMargin = parseFloat(answers.profitMargin) || 0;
  const hasCommitments = answers.hasCommitments;
  const commitmentPayment = parseFloat(answers.commitmentPayment) || 0;
  const commitmentMonths = parseFloat(answers.commitmentMonths) || 0;

  let deductionRate = 0.0;
  let extraSupport = 0;
  let addCommodityFee = false;

  if (financeType === "تمويل شخصي") {
    deductionRate = 33.33;
    addCommodityFee = true;
  } else if (financeType === "تمويل عقاري") {
    if (supported === "مدعوم") {
      if (bundle === "نعم") {
        if (salary < 10000) {
          extraSupport = 150000;
          deductionRate = 55;
        } else {
          extraSupport = 100000;
          deductionRate = salary < 15000 ? 55 : 65;
        }
      } else {
        deductionRate = salary < 15000 ? 55 : 65;
      }
    } else {
      deductionRate = salary < 15000 ? 55 : 65;
    }
  }

  const allowedInstallment = (salary * (deductionRate / 100));

  let availableInstallmentFirst = allowedInstallment;
  let availableInstallmentAfter = allowedInstallment;

  if (hasCommitments === "نعم") {
    availableInstallmentFirst -= commitmentPayment;
    availableInstallmentAfter = allowedInstallment; // بعد انتهاء الالتزام يرجع القسط الكامل
  }

  if (availableInstallmentFirst <= 0) {
    const result = document.getElementById("question");
    result.innerHTML = `
      <h2>عذرًا</h2>
      <p>لا يمكنك الحصول على تمويل حاليًا بسبب الالتزامات القائمة.</p>
      <h3>للتواصل مع شركة سرعة تملك العقار</h3>
      <p>زورونا على: hlooleqrr.com</p>
    `;
    result.classList.add('fade-in');
    document.querySelector('button').remove();
    return;
  }

  const totalMonths = years * 12;

  const monthsWithCommitment = Math.min(commitmentMonths, totalMonths);
  const monthsAfterCommitment = totalMonths - monthsWithCommitment;

  const totalAvailableFirst = availableInstallmentFirst * monthsWithCommitment;
  const totalAvailableAfter = availableInstallmentAfter * monthsAfterCommitment;

  const totalAvailableOverall = totalAvailableFirst + totalAvailableAfter;

  const profitFactor = (years * profitMargin / 100) + 1;
  const netFinance = totalAvailableOverall / profitFactor;

  const adminFee = netFinance * 0.01;
  const vatOnAdmin = adminFee * 0.15;
  const commodityFee = addCommodityFee ? netFinance * 0.01 : 0;
  const finalNetFinance = netFinance - (adminFee + vatOnAdmin + commodityFee);
  const totalFinalFinance = finalNetFinance + extraSupport;

  const result = document.getElementById("question");
  result.innerHTML = `
    <h2>نتيجة الحاسبة:</h2>
    <p><strong>في فترة الالتزام (${monthsWithCommitment} شهر):</strong> قسط متاح ${availableInstallmentFirst.toFixed(0)} ريال</p>
    <p><strong>بعد انتهاء الالتزام (${monthsAfterCommitment} شهر):</strong> قسط متاح ${availableInstallmentAfter.toFixed(0)} ريال</p>
    <p><strong>اجمالي التمويل مع الأرباح:</strong> ${totalAvailableOverall.toFixed(0)} ريال</p>
    <p><strong>معامل الربح:</strong> ${profitFactor.toFixed(3)}</p>
    <p><strong>التمويل الصافي قبل الرسوم:</strong> ${netFinance.toFixed(0)} ريال</p>
    <p><strong>الرسوم الإدارية:</strong> ${adminFee.toFixed(0)} ريال</p>
    <p><strong>الضريبة على الرسوم:</strong> ${vatOnAdmin.toFixed(0)} ريال</p>
    ${addCommodityFee ? `<p><strong>رسوم السلع:</strong> ${commodityFee.toFixed(0)} ريال</p>` : ''}
    <p><strong>التمويل الصافي النهائي:</strong> ${finalNetFinance.toFixed(0)} ريال</p>
    ${extraSupport > 0 ? `<p><strong>دعم حكومي مضاف:</strong> ${extraSupport.toLocaleString()} ريال</p>` : ''}
    <h3 style="margin-top:20px;">للتواصل مع شركة سرعة تملك العقار</h3>
    <p>زورونا على: hlooleqrr.com</p>
  `;
  result.classList.add('fade-in');
}