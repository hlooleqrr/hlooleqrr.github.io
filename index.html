<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</title>
  <style>
    body { font-family: 'Tajawal', sans-serif; background: #f4f6f8; margin:0; text-align:center; font-size:32px; }
    header { background:#005c48; color:#fff; padding:25px; font-size:40px; }
    h2 { font-size:32px; margin:10px 0 20px; }
    .container { max-width:650px; margin:0 auto 25px; background:#fff; padding:25px; border-radius:10px; box-shadow:0 0 15px rgba(0,0,0,.1); }
    input, select, button { width:92%; padding:20px; margin:18px 0; font-size:32px; border-radius:5px; border:1px solid #ccc; box-sizing:border-box; }
    .result p { margin:12px 0; text-align:right; }
    .highlight { color:#2e7d32; font-size:36px; }

    /* Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø© Ø¨Ø®Ù„ÙÙŠØ© Ø£Ø²Ø±Ù‚ Ø¨Ø§Ù‡Øª ÙˆØ­Ø¬Ù… ØµØºÙŠØ± */
    #resetButtonContainer {
      position:fixed; bottom:15px; left:50%; transform:translateX(-50%); z-index:1000;
      display:none; background:#e3f2fd; padding:4px 8px; border-radius:5px;
    }
    #resetButtonContainer button {
      background:transparent; border:none; color:#005c48; font-size:16px; cursor:pointer;
    }

    footer { margin-top:40px; font-size:24px; color:#555; }
  </style>
</head>
<body>
  <header>Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</header>
  <h2>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ØªÙ…ÙˆÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ©</h2>
  <div class="container">
    <div id="question"></div>
    <button id="mainButton" onclick="handleStart()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø­Ø³Ø¨Ø©</button>
    <div id="nextContainer" style="display:none;">
      <button onclick="nextQuestion()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>
  </div>
  <div id="resetButtonContainer">
    <button onclick="handleReset()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø³Ø¨Ø© ğŸ”</button>
  </div>

  <footer>
    <p id="datetimeFooter">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ÙŠØ©</p>
  </footer>

  <script>
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
    function updateDateTime() {
      document.getElementById('datetimeFooter').innerText =
        `Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - Ø³Ø±Ø¹Ø© ØªÙ…Ù„Ùƒ Ø§Ù„Ø¹Ù‚Ø§Ø± - Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: 1446/12/21 - Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ: 2025/06/27 - Ø§Ù„ÙˆÙ‚Øª: 12:44`;
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ù…Ù†Ø·Ù‚
    let hasStarted = false, step = 0, commitmentStep = 0;
    let answers = { commitments: [] }, currentCommitment = {};

    const generalQuestions = [
      { id:'financeType',   label:'Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ØªØ±ÙŠØ¯ Ø­Ø³Ø¨ØªÙ‡:',       type:'select', options:['ØªÙ…ÙˆÙŠÙ„ Ø¹Ù‚Ø§Ø±ÙŠ','ØªÙ…ÙˆÙŠÙ„ Ø´Ø®ØµÙŠ Ø£Ùˆ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ'] },
      { id:'clientName',    label:'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…:',                       type:'text' },
      { id:'birthHijri',    label:'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (Ù‡Ø¬Ø±ÙŠ):',              type:'dateHijri' },
      { id:'jobType',       label:'Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ©:',                       type:'select', options:['Ø¹Ø³ÙƒØ±ÙŠ','Ù…Ø¯Ù†ÙŠ','Ø®Ø§Øµ Ø´Ø¨Ù‡ Ø­ÙƒÙˆÙ…ÙŠ','Ø®Ø§Øµ Ù…Ø¹ØªÙ…Ø¯','Ø®Ø§Øµ ØºÙŠØ± Ù…Ø¹ØªÙ…Ø¯'] },
      { show:a=>a.jobType==='Ø¹Ø³ÙƒØ±ÙŠ',
        id:'rank',         label:'Ø­Ø¯Ø¯ Ø±ØªØ¨ØªÙƒ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©:',                 type:'select',
        options:['Ø¬Ù†Ø¯ÙŠ','Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„','Ø¹Ø±ÙŠÙ','ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨','Ø±Ù‚ÙŠØ¨','Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„','Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡','Ù…Ù„Ø§Ø²Ù…','Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„','Ù†Ù‚ÙŠØ¨','Ø±Ø§Ø¦Ø¯','Ù…Ù‚Ø¯Ù…','Ø¹Ù‚ÙŠØ¯','Ø¹Ù…ÙŠØ¯','Ù„ÙˆØ§Ø¡']
      },
      { show:()=>answers.jobType==='Ø¹Ø³ÙƒØ±ÙŠ' && getRetirementMonths()<25*12,
        id:'extended',     label:'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø­Ø³Ø¨Ø© Ù…Ù…ØªØ¯Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ‚Ø§Ø¹Ø¯ØŸ',  type:'select', options:['Ù†Ø¹Ù…','Ù„Ø§'] },
      { show:a=>a.extended==='Ù†Ø¹Ù…',
        id:'basicSalary',  label:'Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø¨Ø¯ÙˆÙ† Ø¨Ø¯Ù„Ø§ØªØŒ Ø±ÙŠØ§Ù„):',  type:'number' },
      { show:a=>a.extended==='Ù†Ø¹Ù…',
        id:'appointHijri', label:'ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ† (Ù‡Ø¬Ø±ÙŠ):',               type:'dateHijri' },
      { id:'salary',       label:'Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø±ÙŠØ§Ù„):',         type:'number' },
      { id:'profitMargin', label:'Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ (%):',                     type:'number', default:'4.5' },
      { id:'months',       label:'Ø¹Ø¯Ø¯ Ø£Ø´Ù‡Ø± Ø§Ù„ØªÙ…ÙˆÙŠÙ„:',                    type:'select', dynamic:true },
      { id:'hasCommitments', label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù…Ø§Øª Ù…Ø§Ù„ÙŠØ©ØŸ',           type:'select', options:['Ù†Ø¹Ù…','Ù„Ø§'] }
    ];

    const commitmentQuestions = [
      { id:'type',    label:'Ù†ÙˆØ¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…:',           type:'select', options:['Ù‚Ø±Ø¶ Ø³ÙŠØ§Ø±Ø©','Ù‚Ø±Ø¶ Ø´Ø®ØµÙŠ','Ù‚Ø±Ø¶ Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ'] },
      { id:'amount',  label:'Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø±ÙŠØ§Ù„):',     type:'number' },
      { id:'months',  label:'Ø£Ø´Ù‡Ø± Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:',  type:'select', dynamic:true },
      { id:'balloon', label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø¯ÙØ¹Ø© Ø£Ø®ÙŠØ±Ø©ØŸ',      type:'select', options:['Ù†Ø¹Ù…','Ù„Ø§'] },
      { show:c=>c.balloon==='Ù†Ø¹Ù…', id:'balloonAmount', label:'Ù…Ø¨Ù„Øº Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© (Ø±ÙŠØ§Ù„):', type:'number' },
      { id:'more',    label:'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØªØ²Ø§Ù… Ø¢Ø®Ø±ØŸ',      type:'select', options:['Ù†Ø¹Ù…','Ù„Ø§'] }
    ];

    function getRetirementMonths(){
      const cur=1446, birth=parseInt(answers.birthHijriYear)||cur, age=cur-birth;
      const ranks={Ø¬Ù†Ø¯ÙŠ:44,'Ø¬Ù†Ø¯ÙŠ Ø£ÙˆÙ„':44,Ø¹Ø±ÙŠÙ:46,'ÙˆÙƒÙŠÙ„ Ø±Ù‚ÙŠØ¨':46,Ø±Ù‚ÙŠØ¨:48,'Ø±Ù‚ÙŠØ¨ Ø£ÙˆÙ„':50,'Ø±Ø¦ÙŠØ³ Ø±Ù‚Ø¨Ø§Ø¡':52,
                   Ù…Ù„Ø§Ø²Ù…:48,'Ù…Ù„Ø§Ø²Ù… Ø£ÙˆÙ„':50,Ù†Ù‚ÙŠØ¨:52,Ø±Ø§Ø¦Ø¯:54,Ù…Ù‚Ø¯Ù…:56,Ø¹Ù‚ÙŠØ¯:58,Ø¹Ù…ÙŠØ¯:60,Ù„ÙˆØ§Ø¡:60};
      const retireAge = answers.jobType==='Ø¹Ø³ÙƒØ±ÙŠ' ? (ranks[answers.rank]||60) : 60;
      return Math.max(0, (retireAge - age) * 12);
    }

    function getMaxAllowedMonths(){
      const cur=1446, birth=parseInt(answers.birthHijriYear)||cur, age=cur-birth;
      const until60 = (60 - age) * 12;
      const baseLimit = (answers.financeType||'').includes('Ø´Ø®ØµÙŠ')|| (answers.financeType||'').includes('Ø§Ø³ØªÙ‡Ù„Ø§ÙƒÙŠ') ? 60 : 360;
      if(answers.extended==='Ù†Ø¹Ù…') return Math.min(until60, baseLimit);
      return Math.min(getRetirementMonths(), baseLimit);
    }

    function describeMonths(m){
      const y = Math.floor(m/12), mm = m % 12;
      let t = `${m} Ø´Ù‡Ø±`;
      if (y || mm) {
        t += ' (';
        if (y) {
          if      (y === 2) t += 'Ø³Ù†ØªØ§Ù†';
          else if (y === 3) t += 'Ø«Ù„Ø§Ø« Ø³Ù†ÙˆØ§Øª';
          else if (y === 4) t += 'Ø£Ø±Ø¨Ø¹ Ø³Ù†ÙˆØ§Øª';
          else if (y === 5) t += 'Ø®Ù…Ø³ Ø³Ù†ÙˆØ§Øª';
          else              t += `${y} Ø³Ù†ÙˆØ§Øª`;
        }
        if (y && mm) t += ' Ùˆ';
        if (mm) {
          if (mm === 1)      t += 'Ø´Ù‡Ø±';
          else if (mm === 2) t += 'Ø´Ù‡Ø±Ø§Ù†';
          else                t += `${mm} Ø£Ø´Ù‡Ø±`;
        }
        t += ')';
      }
      return t;
    }

    function handleStart(){
      hasStarted = true;
      document.getElementById('mainButton').style.display = 'none';
      document.getElementById('resetButtonContainer').style.display = 'block';
      showQuestion();
    }

    function handleReset(){
      answers = { commitments: [] };
      step = commitmentStep = 0;
      currentCommitment = {};
      hasStarted = true;
      document.getElementById('mainButton').style.display = 'none';
      document.getElementById('nextContainer').style.display = 'block';
      showQuestion();
    }

    function showQuestion(){
      const cont=document.getElementById('question');
      cont.innerHTML='';
      document.getElementById('nextContainer').style.display='block';
      let q;
      if(step<generalQuestions.length){
        q=generalQuestions[step];
        if(q.show && !q.show(answers)){ step++; return showQuestion(); }
      } else if(answers.hasCommitments==='Ù†Ø¹Ù…'){
        q=commitmentQuestions[commitmentStep];
        if(q.show && !q.show(currentCommitment)){ commitmentStep++; return showQuestion(); }
      } else {
        document.getElementById('nextContainer').style.display='none';
        return calculate();
      }

      if(q.type==='dateHijri'){
        const div=document.createElement('div'); div.classList.add('fade-in');
        div.innerHTML=`
          <label>${q.label}</label><br>
          <select id="${q.id}Day"><option value="">Ø§Ù„ÙŠÙˆÙ…</option>${
            Array.from({length:30},(_,i)=>`<option value="${i+1}">${i+1}</option>`).join('')
          }</select>
          <select id="${q.id}Month"><option value="">Ø§Ù„Ø´Ù‡Ø±</option>${
            Array.from({length:12},(_,i)=>`<option value="${i+1}">${i+1}</option>`).join('')
          }</select>
          <select id="${q.id}Year"><option value="">Ø§Ù„Ø³Ù†Ø©</option>${
            Array.from({length:(1447-1370+1)},(_,i)=>`<option value="${1370+i}">${1370+i}</option>`).join('')
          }</select>`;
        cont.appendChild(div);
        return;
      }

      const div=document.createElement('div'); div.classList.add('fade-in');
      div.innerHTML=`<label>${q.label}</label><br>`;
      if(q.type==='select'){
        const sel=document.createElement('select'); sel.id=q.id;
        sel.innerHTML='<option value="">Ø§Ø®ØªØ±...</option>';
        if(q.dynamic){
          for(let i=1;i<=getMaxAllowedMonths();i++){
            sel.innerHTML+=`<option value="${i}">${describeMonths(i)}</option>`;
          }
        } else {
          q.options.forEach(o=> sel.innerHTML+=`<option value="${o}">${o}</option>`);
        }
        div.appendChild(sel);
      } else {
        div.innerHTML+=`<input type="${q.type}" id="${q.id}" ${q.default?`value="${q.default}"`:''}>`;
      }
      cont.appendChild(div);
    }

    function nextQuestion(){
      let q = step<generalQuestions.length ? generalQuestions[step] : commitmentQuestions[commitmentStep];

      if(q.id==='hasCommitments'){
        const val=document.getElementById(q.id).value;
        answers[q.id]=val;
        if(val==='Ù„Ø§') return calculate();
        step++; return showQuestion();
      }

      if(q.type==='dateHijri'){
        const d=document.getElementById(q.id+'Day').value,
              m=document.getElementById(q.id+'Month').value,
              y=document.getElementById(q.id+'Year').value;
        if(!d||!m||!y){ alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® ÙƒØ§Ù…Ù„Ø§Ù‹'); return; }
        answers[q.id+'Day']=d;
        answers[q.id+'Month']=m;
        answers[q.id+'Year']=y;
        step++; return showQuestion();
      }

      const el=document.getElementById(q.id), val=el.value;
      if(!val){ alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©'); return; }

      if(step<generalQuestions.length){
        answers[q.id]=val;
        step++;
      } else {
        if(q.id==='months') currentCommitment.months=parseInt(val);
        else if(['amount','balloonAmount'].includes(q.id)) currentCommitment[q.id]=parseFloat(val);
        else currentCommitment[q.id]=val;

        if(q.id==='more'){
          if(val==='Ù„Ø§'){
            answers.commitments.push(currentCommitment);
            return calculate();
          }
          answers.commitments.push(currentCommitment);
          currentCommitment={};
          commitmentStep=0;
          return showQuestion();
        }
        commitmentStep++;
      }
      showQuestion();
    }

    // <!-- Ù‡Ù†Ø§ Ø£Ù„ØµÙ‚ Ø¯Ø§Ù„Ø© calculate() Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ø­Ø±ÙÙŠØ§Ù‹ -->
    function calculate(){
      // â€¦ Ø£Ø¯Ø±Ø¬ ÙƒÙˆØ¯ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙƒÙ…Ø§ ÙÙŠ Ù†Ø³Ø®ØªÙƒ Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¯ÙˆÙ† Ø£ÙŠ ØªØºÙŠÙŠØ± â€¦
    }
  </script>
</body>
</html>