function calculateResult() {
  // جلب قيم الرتبة والتواريخ
  const rank = document.getElementById('rank').value;

  const birthDay = parseInt(document.getElementById('birthDay').value);
  const birthMonth = parseInt(document.getElementById('birthMonth').value);
  const birthYear = parseInt(document.getElementById('birthYear').value);

  const hireDay = parseInt(document.getElementById('hireDay').value);
  const hireMonth = parseInt(document.getElementById('hireMonth').value);
  const hireYear = parseInt(document.getElementById('hireYear').value);

  if (!rank) {
    alert("يرجى اختيار الرتبة العسكرية");
    return;
  }

  // التحقق من صحة التاريخ (التعيين لا يقل عن الميلاد)
  if (
    hireYear < birthYear ||
    (hireYear === birthYear && hireMonth < birthMonth) ||
    (hireYear === birthYear && hireMonth === birthMonth && hireDay < birthDay)
  ) {
    alert("تاريخ التعيين لا يمكن أن يكون قبل تاريخ الميلاد");
    return;
  }

  // الحصول على التاريخ الهجري الحالي (بتنسيق أرقام)
  const now = new Date();
  const hijriFormatter = new Intl.DateTimeFormat('ar-SA-u-ca-islamic', {
    year: 'numeric',
    month: 'numeric',
    day: 'numeric'
  });
  const hijriParts = hijriFormatter.formatToParts(now);

  // تجميع الأجزاء في أرقام
  let todayHijri = { y: 0, m: 0, d: 0 };
  hijriParts.forEach(part => {
    if (part.type === 'year') todayHijri.y = parseInt(part.value);
    if (part.type === 'month') todayHijri.m = parseInt(part.value);
    if (part.type === 'day') todayHijri.d = parseInt(part.value);
  });

  // دوال مساعدة حسابية (تستخدم تقريبات بسيطة لأن التقويم الهجري غير ثابت 100%)
  function hijriToDays(y, m, d) {
    return y * 354 + (m - 1) * 29.5 + d;
  }

  function diffHijri(y1, m1, d1, y2, m2, d2) {
    let diff = Math.floor(hijriToDays(y2, m2, d2) - hijriToDays(y1, m1, d1));
    if (diff < 0) diff = 0;
    const years = Math.floor(diff / 354);
    diff -= years * 354;
    const months = Math.floor(diff / 29.5);
    diff -= months * 29.5;
    const days = Math.floor(diff);
    return { years, months, days };
  }

  // حساب مدة الخدمة
  const serviceDuration = diffHijri(hireYear, hireMonth, hireDay, todayHijri.y, todayHijri.m, todayHijri.d);
  const serviceYearsDecimal = serviceDuration.years + serviceDuration.months / 12 + serviceDuration.days / 365;

  // بيانات الرتب كما في الكود الأساسي
  const ranksData = {
    "جندي": { base: 3220, allowance: 125, maxYears: 15, retireAge: 44 },
    "جندي أول": { base: 3395, allowance: 135, maxYears: 15, retireAge: 44 },
    "عريف": { base: 3765, allowance: 150, maxYears: 15, retireAge: 46 },
    "وكيل رقيب": { base: 4455, allowance: 180, maxYears: 15, retireAge: 46 },
    "رقيب": { base: 5260, allowance: 215, maxYears: 15, retireAge: 48 },
    "رقيب أول": { base: 6180, allowance: 260, maxYears: 15, retireAge: 50 },
    "رئيس رقباء": { base: 7215, allowance: 310, maxYears: 15, retireAge: 52 },
    "ملازم": { base: 7590, allowance: 380, maxYears: 15, retireAge: 48 },
    "ملازم أول": { base: 8365, allowance: 395, maxYears: 15, retireAge: 50 },
    "نقيب": { base: 9215, allowance: 230, maxYears: 15, retireAge: 52 },
    "رائد": { base: 11705, allowance: 230, maxYears: 15, retireAge: 54 },
    "مقدم": { base: 12735, allowance: 230, maxYears: 15, retireAge: 55 },
    "عقيد": { base: 14365, allowance: 230, maxYears: 15, retireAge: 56 },
    "عميد": { base: 16350, allowance: 210, maxYears: 15, retireAge: 57 },
    "لواء": { base: 18600, allowance: 200, maxYears: 15, retireAge: 58 }
  };

  const maxAllowanceYears = ranksData[rank].maxYears;
  const allowanceYears = Math.min(serviceDuration.years, maxAllowanceYears);

  const baseSalary = ranksData[rank].base + allowanceYears * ranksData[rank].allowance;

  const pension = Math.round((baseSalary * serviceYearsDecimal * 0.55) / 40);

  // حساب موعد التقاعد: الميلاد + العمر التقاعدي
  function addMonthsHijri(y, m, d, monthsToAdd) {
    m += monthsToAdd;
    while (m > 12) {
      m -= 12;
      y++;
    }
    return { y, m, d };
  }
  const retireAge = ranksData[rank].retireAge;
  const retireDate = addMonthsHijri(birthYear, birthMonth, birthDay, retireAge * 12);

  // باقي الوقت حتى التقاعد
  const timeToRetire = diffHijri(todayHijri.y, todayHijri.m, todayHijri.d, retireDate.y, retireDate.m, retireDate.d);

  // عمر المتقاعد عند التقاعد
  function calculateAge(birthY, birthM, birthD, currentY, currentM, currentD) {
    let years = currentY - birthY;
    let months = currentM - birthM;
    let days = currentD - birthD;
    if (days < 0) {
      days += 30;
      months--;
    }
    if (months < 0) {
      months += 12;
      years--;
    }
    return { years, months, days };
  }
  const ageAtRetire = calculateAge(birthYear, birthMonth, birthDay, retireDate.y, retireDate.m, retireDate.d);

  // عرض النتائج النهائية
  const resultText = `
    <p>🎖️ <strong>الرتبة:</strong> ${rank}</p>
    <p>📆 <strong>مدة الخدمة حتى اليوم:</strong> ${serviceDuration.years} سنة، ${serviceDuration.months} شهر، و${serviceDuration.days} يوم</p>
    <p>💼 <strong>الراتب الأساسي الحالي (تقديري):</strong> ${baseSalary.toLocaleString('ar-EG')} ريال</p>
    <p>💰 <strong>الراتب التقاعدي المتوقع:</strong> ${pension.toLocaleString('ar-EG')} ريال</p>
    <hr>
    <p>⏳ <strong>باقي على التقاعد:</strong> ${timeToRetire.years} سنة، ${timeToRetire.months} شهر، و${timeToRetire.days} يوم</p>
    <p>📅 <strong>موعد التقاعد المتوقع (هجري):</strong> ${retireDate.y} / ${retireDate.m} / ${retireDate.d}</p>
    <p>👴 <strong>عمر المتقاعد المتوقع:</strong> ${ageAtRetire.years} سنة، ${ageAtRetire.months} شهر، و${ageAtRetire.days} يوم</p>
  `;

  const resultDiv = document.getElementById('result');
  resultDiv.innerHTML = resultText;
  resultDiv.style.display = 'block';

  prevBtn.style.display = 'none';
  nextBtn.style.display = 'none';
}