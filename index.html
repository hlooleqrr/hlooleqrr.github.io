<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <title>سرعة تملك العقار والحلول التمويلية</title>
  <style>
    body {
      font-family: 'Tajawal', sans-serif;
      background: #eef2f5;
      margin: 0;
      text-align: center;
      font-size: 32px;
      color: #333;
    }
    header {
      background: #005c48;
      color: #fff;
      padding: 25px;
      font-size: 36px;
    }
    .container {
      max-width: 700px;
      margin: 30px auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
    input, select, button {
      font-family: inherit;
      font-size: 32px;
      margin: 20px 0;
    }
    .modern-input {
      width: 100%;
      padding: 18px;
      border: 2px solid #ccc;
      border-radius: 8px;
      transition: border-color .3s;
    }
    .modern-input:focus {
      border-color: #005c48;
      outline: none;
    }
    #startButton, #nextButton, #resetButton {
      background: #005c48;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 18px 30px;
      cursor: pointer;
      transition: background .3s;
    }
    #startButton:hover, #nextButton:hover, #resetButton:hover {
      background: #007b5a;
    }
    /* duration picker */
    #durationPicker {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 30px;
      margin: 30px 0;
    }
    #durationPicker button {
      width: 60px;
      height: 60px;
      font-size: 36px;
      border: none;
      border-radius: 50%;
      background: #005c48;
      color: #fff;
      cursor: pointer;
      transition: background .3s;
    }
    #durationPicker button:hover {
      background: #007b5a;
    }
    #durationValue {
      font-size: 48px;
      font-weight: bold;
      width: 140px;
    }
    /* result styling */
    #resultContainer {
      display: none;
      text-align: right;
    }
    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
      gap: 20px;
      margin-top: 30px;
    }
    .result-card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.05);
      text-align: right;
    }
    .result-card h4 {
      margin: 0 0 10px;
      color: #005c48;
    }
    .result-value {
      font-size: 36px;
      font-weight: bold;
      margin-top: 5px;
      color: #333;
    }
  </style>
</head>
<body>
  <header>سرعة تملك العقار والحلول التمويلية</header>

  <div class="container" id="formContainer">
    <button id="startButton">ابدأ الحسبة</button>
    <div id="question" style="display:none;"></div>
    <div id="nextContainer" style="display:none;">
      <button id="nextButton">التالي</button>
    </div>
  </div>

  <div class="container" id="resultContainer">
    <h3>نتيجة الحسبة:</h3>
    <div id="greeting"></div>
    <div class="result-grid">
      <div class="result-card">
        <h4>مدة الخدمة حتى التقاعد</h4>
        <div id="serviceMonths" class="result-value"></div>
      </div>
      <div class="result-card">
        <h4>الراتب التقاعدي</h4>
        <div id="pension" class="result-value"></div>
      </div>
      <div class="result-card">
        <h4>مدة التمويل المختارة</h4>
        <div id="chosenDuration" class="result-value"></div>
      </div>
      <div class="result-card">
        <h4>الحد الأقصى للقسط الشهري</h4>
        <div id="monthlyCap" class="result-value"></div>
      </div>
      <div class="result-card">
        <h4>إجمالي التمويل مع الأرباح</h4>
        <div id="totalWithProfit" class="result-value"></div>
      </div>
      <div class="result-card">
        <h4>الصافي بعد القسمة</h4>
        <div id="net" class="result-value"></div>
      </div>
      <div class="result-card">
        <h4>الأرباح</h4>
        <div id="profit" class="result-value"></div>
      </div>
      <div class="result-card">
        <h4>الصافي مع الدفعة</h4>
        <div id="netWithPay" class="result-value"></div>
      </div>
    </div>
    <button id="resetButton">🔁 إعادة الحسبة</button>
  </div>

  <script>
    const basicSalaryMap = {
      "جندي": 3220, "جندي أول": 3395, "عريف": 3765, "وكيل رقيب": 4455,
      "رقيب": 5260, "رقيب أول": 6180, "رئيس رقباء": 7215,
      "ملازم": 7590, "ملازم أول": 8835, "نقيب": 10600, "رائد": 13515,
      "مقدم": 14645, "عقيد": 16500, "عميد": 18805, "لواء": 21000, "فريق": 22000
    };
    const allowanceMap = {
      "جندي": 130, "جندي أول": 145, "عريف": 175, "وكيل رقيب": 200,
      "رقيب": 250, "رقيب أول": 280, "رئيس رقباء": 330,
      "ملازم": 380, "ملازم أول": 440, "نقيب": 490, "رائد": 540,
      "مقدم": 615, "عقيد": 670, "عميد": 725, "لواء": 780, "فريق": 830
    };
    const retireAgeMap = {
      "جندي":44,"جندي أول":44,"عريف":46,"وكيل رقيب":48,
      "رقيب":50,"رقيب أول":50,"رئيس رقباء":52,
      "ملازم":44,"ملازم أول":44,"نقيب":48,"رائد":50,
      "مقدم":52,"عقيد":54,"عميد":56,"لواء":58,"فريق":60
    };
    let step = 0, answers = {}, maxDuration = 0;

    const startBtn = document.getElementById('startButton');
    const nextBtn  = document.getElementById('nextButton');
    const resetBtn = document.getElementById('resetButton');

    startBtn.onclick = startCalc;
    nextBtn.onclick  = nextStep;
    resetBtn.onclick = resetCalc;

    function startCalc() {
      startBtn.style.display = 'none';
      document.getElementById('question').style.display = 'block';
      document.getElementById('nextContainer').style.display = 'block';
      showStep();
    }

    function nextStep() {
      switch(step) {
        case 0: answers.name    = document.getElementById('inputName').value.trim();              break;
        case 1:
          answers.today        = { y:+d('todayYear'), m:+d('todayMonth'), d:+d('todayDay') };    break;
        case 2: answers.financeType= d('financeType');                                            break;
        case 3: answers.rank    = d('rank');                                                      break;
        case 4:
          answers.appoint      = { y:+d('appointYear'), m:+d('appointMonth'), d:+d('appointDay') }; break;
        case 5:
          answers.birth        = { y:+d('birthYear'), m:+d('birthMonth'), d:+d('birthDay') };     break;
        case 6: answers.margin  = parseFloat(d('profitMargin'));                                   break;
        case 7: answers.payment = parseFloat(d('paymentAmount'));                                  break;
        case 8: answers.duration= +document.getElementById('durationValue').textContent;           break;
      }
      step++;
      if (step <= 8) showStep();
      else showResult();
    }

    function showStep() {
      const q = document.getElementById('question');
      q.innerHTML = '';
      nextBtn.style.display = 'inline-block';
      switch(step) {
        case 0:
          q.innerHTML = `<input class="modern-input" type="text" id="inputName" placeholder="الاسم الكريم">`;
          break;
        case 1:
          q.innerHTML = `
            <label>تاريخ اليوم (هجري):</label><br>
            <select class="modern-input" id="todayDay">${opts(1,30)}</select>
            <select class="modern-input" id="todayMonth">${opts(1,12)}</select>
            <select class="modern-input" id="todayYear">${opts(1430,1460)}</select>`;
          break;
        case 2:
          q.innerHTML = `
            <select class="modern-input" id="financeType">
              <option value="عقاري">تمويل عقاري</option>
              <option value="شخصي">تمويل شخصي</option>
            </select>`;
          break;
        case 3:
          q.innerHTML = `
            <select class="modern-input" id="rank">
              ${Object.keys(basicSalaryMap).map(r=>`<option>${r}</option>`).join('')}
            </select>`;
          break;
        case 4:
          q.innerHTML = `
            <label>تاريخ التعيين (هجري):</label><br>
            <select class="modern-input" id="appointDay">${opts(1,30)}</select>
            <select class="modern-input" id="appointMonth">${opts(1,12)}</select>
            <select class="modern-input" id="appointYear">${opts(1370,1430)}</select>`;
          break;
        case 5:
          q.innerHTML = `
            <label>تاريخ الميلاد (هجري):</label><br>
            <select class="modern-input" id="birthDay">${opts(1,30)}</select>
            <select class="modern-input" id="birthMonth">${opts(1,12)}</select>
            <select class="modern-input" id="birthYear">${opts(1370,1430)}</select>`;
          break;
        case 6:
          q.innerHTML = `<input class="modern-input" type="number" id="profitMargin" placeholder="نسبة هامش الربح (%)">`;
          break;
        case 7:
          q.innerHTML = `<input class="modern-input" type="number" id="paymentAmount" placeholder="مبلغ الدفعة">`;
          break;
        case 8:
          const retireAge = retireAgeMap[answers.rank];
          maxDuration = Math.max((60 - retireAge) * 12, 0);
          q.innerHTML = `
            <label>مدة التمويل (بالشهور حتى ${maxDuration}):</label>
            <div id="durationPicker">
              <button id="durationMinus">−</button>
              <div id="durationValue">${maxDuration}</div>
              <button id="durationPlus">+</button>
            </div>`;
          document.getElementById('durationMinus').onclick = ()=>{
            let v=+document.getElementById('durationValue').textContent;
            if(v>1) document.getElementById('durationValue').textContent= v-1;
          };
          document.getElementById('durationPlus').onclick = ()=>{
            let v=+document.getElementById('durationValue').textContent;
            if(v<maxDuration) document.getElementById('durationValue').textContent= v+1;
          };
          break;
      }
      nextBtn.textContent = step < 8 ? 'التالي' : 'عرض النتيجة';
    }

    function showResult() {
      document.getElementById('formContainer').style.display   = 'none';
      const retireAge = retireAgeMap[answers.rank];
      const retireYear= answers.birth.y + retireAge;
      const retireMonth= answers.birth.m;
      const serviceMonths = (retireYear - answers.appoint.y) * 12 + (retireMonth - answers.appoint.m);

      const sal       = basicSalaryMap[answers.rank];
      const allowance = allowanceMap[answers.rank] || 0;
      const gross     = sal + allowance;
      const pension   = gross * serviceMonths / 420;

      const ratio          = answers.financeType==='عقاري'? 0.55 : 0.25;
      const monthlyCap     = pension * ratio;
      const totalWithProfit= monthlyCap * answers.duration;
      const factor         = (answers.duration/12)*(answers.margin/100) + 1;
      const net            = totalWithProfit / factor;
      const profit         = totalWithProfit - net;
      const netWithPay     = net + answers.payment;

      document.getElementById('greeting').textContent = `مرحباً ومسهلاً يا ${answers.name}`;
      document.getElementById('serviceMonths').textContent    = serviceMonths + ' شهر';
      document.getElementById('pension').textContent          = pension.toFixed(2) + ' ريال';
      document.getElementById('chosenDuration').textContent   = answers.duration + ' شهر';
      document.getElementById('monthlyCap').textContent       = monthlyCap.toFixed(2) + ' ريال';
      document.getElementById('totalWithProfit').textContent  = totalWithProfit.toFixed(2) + ' ريال';
      document.getElementById('net').textContent              = net.toFixed(2) + ' ريال';
      document.getElementById('profit').textContent           = profit.toFixed(2) + ' ريال';
      document.getElementById('netWithPay').textContent       = netWithPay.toFixed(2) + ' ريال';

      document.getElementById('resultContainer').style.display = 'block';
      resetBtn.style.display = 'inline-block';
    }

    function resetCalc() {
      step = 0; answers = {};
      document.getElementById('resultContainer').style.display = 'none';
      document.getElementById('formContainer')  .style.display = 'block';
      document.getElementById('startButton')    .style.display = 'inline-block';
      document.getElementById('question')       .style.display = 'none';
      document.getElementById('nextContainer')  .style.display = 'none';
    }

    function d(id){ return document.getElementById(id).value; }
    function opts(start, end){
      let html = '';
      for(let v = start; v <= end; v++){
        html += `<option>${v.toString().padStart(2,'0')}</option>`;
      }
      return html;
    }
  </script>
</body>
</html>